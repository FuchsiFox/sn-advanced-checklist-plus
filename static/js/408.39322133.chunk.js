/*! For license information please see 408.39322133.chunk.js.LICENSE.txt */
(self.webpackChunk_standardnotes_advanced_checklist_plus=self.webpackChunk_standardnotes_advanced_checklist_plus||[]).push([[408],{27:(e,t,n)=>{var r;self,e.exports=(r=n(2651),(()=>{var e,t,n={156:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};let n,r,i,a;var s;e.d(t,{default:()=>I}),function(e){e.SetSize="set-size",e.StreamItems="stream-items",e.StreamContextItem="stream-context-item",e.SaveItems="save-items",e.SelectItem="select-item",e.AssociateItem="associate-item",e.DeassociateItem="deassociate-item",e.ClearSelection="clear-selection",e.CreateItem="create-item",e.CreateItems="create-items",e.DeleteItems="delete-items",e.SetComponentData="set-component-data",e.InstallLocalComponent="install-local-component",e.ToggleActivateComponent="toggle-activate-component",e.RequestPermissions="request-permissions",e.PresentConflictResolution="present-conflict-resolution",e.DuplicateItem="duplicate-item",e.ComponentRegistered="component-registered",e.ActivateThemes="themes",e.Reply="reply",e.SaveSuccess="save-success",e.SaveError="save-error",e.ThemesActivated="themes-activated",e.KeyDown="key-down",e.KeyUp="key-up",e.Click="click"}(n||(n={})),function(e){e[e.Web=1]="Web",e[e.Desktop=2]="Desktop",e[e.Mobile=3]="Mobile"}(r||(r={})),function(e){e.Any="*",e.Item="SF|Item",e.RootKey="SN|RootKey|NoSync",e.ItemsKey="SN|ItemsKey",e.EncryptedStorage="SN|EncryptedStorage",e.Note="Note",e.Tag="Tag",e.SmartTag="SN|SmartTag",e.Component="SN|Component",e.Editor="SN|Editor",e.ActionsExtension="Extension",e.UserPrefs="SN|UserPreferences",e.HistorySession="SN|HistorySession",e.Theme="SN|Theme",e.Mfa="SF|MFA",e.ServerExtension="SF|Extension",e.FilesafeCredentials="SN|FileSafe|Credentials",e.FilesafeFileMetadata="SN|FileSafe|FileMetadata",e.FilesafeIntegration="SN|FileSafe|Integration",e.ExtensionRepo="SN|ExtensionRepo"}(i||(i={})),function(e){e.Pinned="pinned",e.Archived="archived",e.Locked="locked",e.UserModifiedDate="client_updated_at",e.DefaultEditor="defaultEditor",e.MobileRules="mobileRules",e.NotAvailableOnMobile="notAvailableOnMobile",e.MobileActive="mobileActive",e.LastSize="lastSize",e.PrefersPlainEditor="prefersPlainEditor",e.ComponentInstallError="installError"}(a||(a={}));var o=new Uint8Array(16);function u(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(o)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=function(e){return"string"==typeof e&&c.test(e)};for(var f=[],h=0;h<256;++h)f.push((h+256).toString(16).substr(1));const p=function(e,t,n){var r=(e=e||{}).random||(e.rng||u)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase();if(!l(n))throw TypeError("Stringified UUID is invalid");return n}(r)},d=e=>{var t;const n={[r.Web]:"web",[r.Desktop]:"desktop",[r.Mobile]:"mobile"};return null!==(t=n[e])&&void 0!==t?t:n[r.Web]},y=e=>null!=e,v=()=>{};class m{static get isSupported(){return!(!window.console&&!console)}static get info(){return m.isSupported&&this.enabled?console.log.bind(console):v}static get error(){return m.isSupported?console.error.bind(console):v}}var g,b,k,w;function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(b="enabled")in(g=m)?Object.defineProperty(g,b,{value:!1,enumerable:!0,configurable:!0,writable:!0}):g[b]=!1,function(e){e.Component="component"}(k||(k={})),function(e){e.Shift="Shift",e.Ctrl="Control",e.Meta="Meta"}(w||(w={}));class I{constructor(e){if(_(this,"contentWindow",void 0),_(this,"initialPermissions",void 0),_(this,"onReadyCallback",void 0),_(this,"component",{activeThemes:[],acceptsThemes:!0}),_(this,"sentMessages",[]),_(this,"messageQueue",[]),_(this,"lastStreamedItem",void 0),_(this,"pendingSaveItems",void 0),_(this,"pendingSaveTimeout",void 0),_(this,"pendingSaveParams",void 0),_(this,"coallesedSaving",!0),_(this,"coallesedSavingDelay",250),_(this,"messageHandler",void 0),_(this,"keyDownEventListener",void 0),_(this,"keyUpEventListener",void 0),_(this,"clickEventListener",void 0),_(this,"onThemesChangeCallback",void 0),_(this,"concernTimeouts",[]),!e||!e.targetWindow)throw new Error("contentWindow must be a valid Window object.");this.contentWindow=e.targetWindow,this.processParameters(e),this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}processParameters(e){var t;const{initialPermissions:n,options:r,onReady:i,onThemesChange:a}=e;var s;n&&n.length>0&&(this.initialPermissions=n),y(null==r?void 0:r.coallesedSaving)&&(this.coallesedSaving=r.coallesedSaving),y(null==r?void 0:r.coallesedSavingDelay)&&(this.coallesedSavingDelay=r.coallesedSavingDelay),y(null==r?void 0:r.acceptsThemes)&&(this.component.acceptsThemes=null===(s=null==r?void 0:r.acceptsThemes)||void 0===s||s),y(i)&&(this.onReadyCallback=i),y(a)&&(this.onThemesChangeCallback=a),m.enabled=null!==(t=null==r?void 0:r.debug)&&void 0!==t&&t}deinit(){this.onReadyCallback=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener("message",this.messageHandler),this.contentWindow.removeEventListener("message",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener("keydown",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener("keyup",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener("click",this.clickEventListener)}registerMessageHandler(){this.messageHandler=e=>{if(m.info("Components API Message received:",e.data),document.referrer&&new URL(document.referrer).origin!==new URL(e.origin).origin)return;const{data:t}=e,r=(e=>{if("string"!=typeof e)return!1;try{const t=JSON.parse(e),n=Object.prototype.toString.call(t);return"[object Object]"===n||"[object Array]"===n}catch(e){return!1}})(t)?JSON.parse(t):t;if(r){if(void 0===this.component.origin&&r.action===n.ComponentRegistered)this.component.origin=e.origin;else if(e.origin!==this.component.origin)return;this.handleMessage(r)}else m.error("Invalid data received. Skipping...")},this.contentWindow.document.addEventListener("message",this.messageHandler,!1),this.contentWindow.addEventListener("message",this.messageHandler,!1),m.info("Waiting for messages...")}registerKeyboardEventListeners(){this.keyDownEventListener=e=>{m.info("A key has been pressed: ".concat(e.key)),e.ctrlKey?this.keyDownEvent(w.Ctrl):e.shiftKey?this.keyDownEvent(w.Shift):(e.metaKey||"Meta"===e.key)&&this.keyDownEvent(w.Meta)},this.keyUpEventListener=e=>{m.info("A key has been released: ".concat(e.key)),"Control"===e.key?this.keyUpEvent(w.Ctrl):"Shift"===e.key?this.keyUpEvent(w.Shift):"Meta"===e.key&&this.keyUpEvent(w.Meta)},this.contentWindow.addEventListener("keydown",this.keyDownEventListener,!1),this.contentWindow.addEventListener("keyup",this.keyUpEventListener,!1)}registerMouseEventListeners(){this.clickEventListener=e=>{m.info("A click has been performed."),this.mouseClickEvent()},this.contentWindow.addEventListener("click",this.clickEventListener,!1)}handleMessage(e){switch(e.action){case n.ComponentRegistered:this.component.sessionKey=e.sessionKey,e.componentData&&(this.component.data=e.componentData),this.onReady(e.data),m.info("Component successfully registered with payload:",e);break;case n.ActivateThemes:this.activateThemes(e.data.themes);break;default:{var t,r;if(!e.original)return;const n=null===(t=this.sentMessages)||void 0===t?void 0:t.filter(t=>{var n;return t.messageId===(null===(n=e.original)||void 0===n?void 0:n.messageId)})[0];if(!n){const e=this.contentWindow.document.title,t=("The extension '".concat(e,"' is attempting to communicate with Standard Notes, ")+"but an error is preventing it from doing so. Please restart this extension and try again.").replace("  "," ");return void m.info(t)}null==n||null===(r=n.callback)||void 0===r||r.call(n,e.data);break}}}onReady(e){this.component.environment=e.environment,this.component.platform=e.platform,this.component.uuid=e.uuid,this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);for(const t of this.messageQueue)this.postMessage(t.action,t.data,t.callback);this.messageQueue=[],m.info("Data passed to onReady:",e),this.activateThemes(e.activeThemeUrls||[]),this.postMessage(n.ThemesActivated,{}),this.onReadyCallback&&this.onReadyCallback()}getSelfComponentUUID(){return this.component.uuid}isRunningInDesktopApplication(){return this.component.environment===d(r.Desktop)}isRunningInMobileApplication(){return this.component.environment===d(r.Mobile)}getComponentDataValueForKey(e){if(this.component.data)return this.component.data[e]}setComponentDataValueForKey(e,t){if(!this.component.data)throw new Error("The component has not been initialized.");if(!e||e&&0===e.length)throw new Error("The key for the data value should be a valid string.");this.component.data=S(S({},this.component.data),{},{[e]:t}),this.postMessage(n.SetComponentData,{componentData:this.component.data})}clearComponentData(){this.component.data={},this.postMessage(n.SetComponentData,{componentData:this.component.data})}postMessage(e,t,n){if(!this.component.sessionKey)return void this.messageQueue.push({action:e,data:t,api:k.Component,callback:n});const r={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:k.Component},i=JSON.parse(JSON.stringify(r));let a;i.callback=n,this.sentMessages.push(i),a=this.isRunningInMobileApplication()?JSON.stringify(r):r,m.info("Posting message:",a),this.contentWindow.parent.postMessage(a,this.component.origin)}requestPermissions(e,t){this.postMessage(n.RequestPermissions,{permissions:e},()=>{t&&t()})}activateThemes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.component.acceptsThemes)return;m.info("Incoming themes:",e);const{activeThemes:t}=this.component;if(t&&t.sort().toString()==e.sort().toString())return;let n=e;const r=[];for(const i of t)e.includes(i)?n=n.filter(e=>e!==i):r.push(i);m.info("Deactivating themes:",r),m.info("Activating themes:",n);for(const i of r)this.deactivateTheme(i);this.component.activeThemes=e;for(const i of n){if(!i)continue;const e=this.contentWindow.document.createElement("link");e.id=btoa(i),e.href=i,e.type="text/css",e.rel="stylesheet",e.media="screen,print",e.className="custom-theme",this.contentWindow.document.getElementsByTagName("head")[0].appendChild(e)}this.onThemesChangeCallback&&this.onThemesChangeCallback()}themeElementForUrl(e){return Array.from(this.contentWindow.document.getElementsByClassName("custom-theme")).slice().find(t=>t.id==btoa(e))}deactivateTheme(e){const t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute("disabled","true"),t.parentNode.removeChild(t))}generateUUID(){return p()}get platform(){return this.component.platform}get environment(){return this.component.environment}streamItems(e,t){this.postMessage(n.StreamItems,{content_types:e},e=>{t(e.items)})}streamContextItem(e){this.postMessage(n.StreamContextItem,{},t=>{const{item:n}=t;(!this.lastStreamedItem||this.lastStreamedItem.uuid!==n.uuid)&&this.pendingSaveTimeout&&(clearTimeout(this.pendingSaveTimeout),this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0),this.lastStreamedItem=n,e(this.lastStreamedItem)})}selectItem(e){this.postMessage(n.SelectItem,{item:this.jsonObjectForItem(e)})}clearSelection(){this.postMessage(n.ClearSelection,{content_type:i.Tag})}createItem(e,t){this.postMessage(n.CreateItem,{item:this.jsonObjectForItem(e)},e=>{let{item:n}=e;!n&&e.items&&e.items.length>0&&(n=e.items[0]),this.associateItem(n),t&&t(n)})}createItems(e,t){const r=e.map(e=>this.jsonObjectForItem(e));this.postMessage(n.CreateItems,{items:r},e=>{t&&t(e.items)})}associateItem(e){this.postMessage(n.AssociateItem,{item:this.jsonObjectForItem(e)})}deassociateItem(e){this.postMessage(n.DeassociateItem,{item:this.jsonObjectForItem(e)})}deleteItem(e,t){this.deleteItems([e],t)}deleteItems(e,t){const r={items:e.map(e=>this.jsonObjectForItem(e))};this.postMessage(n.DeleteItems,r,e=>{t&&t(e)})}sendCustomEvent(e,t,n){this.postMessage(e,t,e=>{n&&n(e)})}saveItem(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,n)}saveItemWithPresave(e,t,n){this.saveItemsWithPresave([e],t,n)}saveItemsWithPresave(e,t,n){this.saveItems(e,n,!1,t)}performSavingOfItems(e){let{items:t,presave:r,callback:i}=e;const a=setTimeout(()=>{this.concernTimeouts.forEach(e=>clearTimeout(e)),alert("This editor is unable to communicate with Standard Notes. Your changes may not be saved. Please backup your changes, then restart the application and try again.")},5e3);this.concernTimeouts.push(a),r&&r();const s=[];for(const n of t)s.push(this.jsonObjectForItem(n));this.postMessage(n.SaveItems,{items:s},()=>{this.concernTimeouts.forEach(e=>clearTimeout(e)),null==i||i()})}saveItems(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.coallesedSaving&&!n){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);const n=e.map(e=>e.uuid),i=this.pendingSaveItems.filter(e=>!n.includes(e.uuid));this.pendingSaveItems=i.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:r,callback:t},this.pendingSaveTimeout=setTimeout(()=>{this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveItems=[],this.pendingSaveTimeout=void 0,this.pendingSaveParams=null},this.coallesedSavingDelay)}else this.performSavingOfItems({items:e,presave:r,callback:t})}setSize(e,t){this.postMessage(n.SetSize,{type:"container",width:e,height:t})}keyDownEvent(e){this.postMessage(n.KeyDown,{keyboardModifier:e})}keyUpEvent(e){this.postMessage(n.KeyUp,{keyboardModifier:e})}mouseClickEvent(){this.postMessage(n.Click,{})}jsonObjectForItem(e){const t=Object.assign({},e);return t.children=null,t.parent=null,t}getItemAppDataValue(e,t){var n,r;return null==e||null===(n=e.content)||void 0===n||null===(r=n.appData)||void 0===r?void 0:r["org.standardnotes.sn"][t]}}return t.default})()},695:e=>{"use strict";e.exports=r}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);a.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>s[e]=()=>n[e]);return s.default=()=>n,a.d(i,s),i},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";a.d(s,{default:()=>p});var e=a(156),t=a.n(e);const n=async e=>{await new Promise(t=>setTimeout(t,1e3*e))};function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){this.options=e,r(this,"uuidToFileTempUrlAndTypeMapping",{}),r(this,"currentlyLoadingIds",[]),r(this,"statusElementMapping",{}),r(this,"fileTypeToElementType",{"image/png":"img","image/jpg":"img","image/jpeg":"img","image/gif":"img","image/tiff":"img","image/bmp":"img","video/mp4":"video","audio/mpeg":"audio","audio/mp3":"audio"})}fileTypeForElementType(e){return this.fileTypeToElementType[e.toLowerCase()]}loadFileSafeElements(){const e=this.options.getElementsBySelector("*[fsplaceholder]");for(const t of e)this.loadFileSafeElement(t)}async loadFileSafeElement(e){var t;const{fileSafeInstance:r}=this.options,i=e.getAttribute("fsid"),a=null!==(t=e.getAttribute("fsName"))&&void 0!==t?t:"",s=a&&"undefined"!=a?a:"file";if(!i)return!1;const o=this.uuidToFileTempUrlAndTypeMapping[i];if(o)return this.insertMediaElement({fsid:i,fsElement:e,url:o.url,fileType:o.fileType,fsName:o.fsName}),!1;if(this.currentlyLoadingIds.includes(i))return!1;const u=r.findFileDescriptor(i);if(!u)return this.setStatus({fsElement:e,fsid:i,status:"Unable to find ".concat(s," ").concat(i,"."),removable:!0}),!1;const c='[fsid="'.concat(u.uuid,'"][fscollapsable]');if(document.querySelectorAll("img".concat(c,", figure").concat(c,", video").concat(c,", audio").concat(c)).length>0)return!1;this.currentlyLoadingIds.push(i),this.setStatus({fsElement:e,fsid:i,status:"Downloading ".concat(s,"...")}),await n(.05);const l=await r.downloadFileFromDescriptor(u).catch(()=>{this.setStatus({fsElement:e,fsid:i,status:"Unable to download ".concat(s," ").concat(i,".")})});if(!l)return!1;this.setStatus({fsElement:e,fsid:i,status:"Decrypting ".concat(s,"...")}),await n(.05);const f=await r.decryptFile({fileDescriptor:u,fileItem:l}).catch(()=>{this.setStatus({fsElement:e,fsid:i,status:"Unable to decrypt ".concat(s," ").concat(i,".")})});if(!f)return!1;this.setStatus({fsElement:e,fsid:i}),await n(.05);const h=u.content.fileType,p=r.createTemporaryFileUrl({base64Data:f.decryptedData,dataType:h});return this.insertMediaElement({fsid:i,fileType:h,fsName:a,fsElement:e,url:p}),(()=>{this.currentlyLoadingIds.splice(this.currentlyLoadingIds.indexOf(i),1)})(),this.uuidToFileTempUrlAndTypeMapping[i]={fileType:h,url:p,fsName:a},!0}insertMediaElement(e){let t,{url:n,fsid:r,fsName:i,fileType:a,fsElement:s}=e;switch(this.fileTypeForElementType(a)){case"img":t=this.createImageElement({url:n,fsid:r,fsName:i,fsElement:s});break;case"video":t=this.createVideoElement({url:n,fsid:r,fileType:a,fsName:i,fsElement:s});break;case"audio":t=this.createAudioElement({url:n,fsid:r,fsName:i});break;default:t=this.createDownloadElement({url:n,fsid:r,fsName:i})}this.insertElementNearElement(t,s),s.remove()}wrapElementInTag(e){let{element:t,tagName:n,fsid:r,fsName:i}=e;const a=document.createElement(n);return a.setAttribute("fsid",r),a.setAttribute("fsName",i),a.setAttribute("fscollapsable","true"),a.setAttribute("contenteditable","true"),a.append(t),a}createImageElement(e){let{url:t,fsid:n,fsName:r,fsElement:i}=e;const a=document.createElement("img");a.setAttribute("src",t),a.setAttribute("srcset","".concat(t," 2x")),a.setAttribute("fsid",n),a.setAttribute("fsName",r),a.setAttribute("fscollapsable","true");const s=i.getAttribute("width");s&&a.setAttribute("width",s);const o=i.getAttribute("height");return o&&a.setAttribute("height",o),a}createVideoElement(e){let{url:t,fsid:n,fileType:r,fsName:i,fsElement:a}=e;const s=document.createElement("video");s.setAttribute("controls","true"),s.setAttribute("fsid",n),s.setAttribute("fsName",i),s.setAttribute("fscollapsable","true");const o=a.getAttribute("width");o&&s.setAttribute("width",o);const u=a.getAttribute("height");u&&s.setAttribute("height",u);const c=document.createElement("source");return c.setAttribute("src",t),c.setAttribute("type",r),s.append(c),this.wrapElementInTag({fsid:n,fsName:i,element:s,tagName:"p"})}createDownloadElement(e){let{url:t,fsid:n,fsName:r}=e;const i=document.createElement("a");return i.setAttribute("fsid",n),i.setAttribute("fsName",r),i.setAttribute("ghost","true"),i.setAttribute("fscollapsable","true"),i.setAttribute("href",t),i.textContent="".concat(r),i}createAudioElement(e){let{url:t,fsid:n,fsName:r}=e;const i=document.createElement("audio");return i.setAttribute("src",t),i.setAttribute("controls","true"),i.setAttribute("fsid",n),i.setAttribute("fsName",r),i.setAttribute("fscollapsable","true"),this.wrapElementInTag({fsid:n,fsName:r,element:i,tagName:"p"})}setStatus(e){let{status:t,fsElement:n,fsid:r,removable:i=!1}=e;if(r){const e=this.statusElementMapping[r];e&&(e.remove(),delete this.statusElementMapping[r])}if(t){let e=document.createElement("label");return e.setAttribute("id",r),e.setAttribute("ghost","true"),e.setAttribute("contenteditable","false"),e.style.fontWeight="bold",e.textContent=t,i&&(e.style.userSelect="all"),e=this.insertElementNearElement(e,n),r&&(this.statusElementMapping[r]=e),e}}insertStatusAtCursor(e){const t=Math.random().toString(36).substring(7);return this.setStatus({status:e,fsid:t,fsElement:null}),t}removeCursorStatus(e){const t=this.options.getElementsBySelector("#".concat(e));t.length>0&&t[0].remove()}insertElementNearElement(e,t){const n=this.options.preprocessElement(e);let r="child";if(t&&"figure"==n.tagName.toLowerCase()){const e=t.closest("p");e&&(t=e,r="afterend")}return this.options.insertElement(n,t,r),n}}class o{constructor(e){this.options=e}onKeyUp(e){let{isEnter:t,isPaste:n,isSpace:r}=e;(t||n||r)&&this.searchPatterns({searchPreviousLine:null!=t&&t})}searchPatterns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{searchPreviousLine:!1};const t=e.searchPreviousLine?this.options.getPreviousLineText():this.options.getCurrentLineText();for(const n of this.options.patterns){const r=n.regex.exec(t);if(!r)continue;const i=r[0];if(i){const t=n.callback(i);this.replaceSelection(n.regex,t,e.searchPreviousLine)}}}replaceSelection(e,t,n){var r,i,a;null!==(r=this.options)&&void 0!==r&&r.beforeExpand&&this.options.beforeExpand(),this.options.replaceText({regex:e,replacement:t,searchPreviousLine:n}),null!==(i=this.options)&&void 0!==i&&i.afterExpand&&(null===(a=this.options)||void 0===a||a.afterExpand())}}const u=/(<p>)?\[FileSafe[^\]]*\](<\/p>)?/g,c=e=>e.replace(u,e=>f(e)),l=e=>"[FileSafe:".concat(e.uuid,":").concat(e.content.fileName,"]"),f=e=>{const t=(e=(e=(e=e.replace("<p>","")).replace("</p>","")).replace("[","").replace("]","")).split(":"),n=t[1],r=t[2],i=t[3];let a="";if(i){const e=i.split("x");a="width=".concat(e[0]," height=").concat(e[1])}return"<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='".concat(n,"' fsname='").concat(r,"' ").concat(a,"></p>")};function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class p{constructor(e,t){this.delegate=e,this.options=t,h(this,"fileIdsPendingAssociation",[]),h(this,"componentRelay",void 0),h(this,"fileLoader",void 0),h(this,"textExpander",void 0),h(this,"fileSafeLoading",void 0),h(this,"fileSafeClass",void 0),h(this,"fileSafeInstance",void 0),h(this,"note",void 0),h(this,"ignoreNextTextChange",void 0),h(this,"needsFileSafeElementLoad",void 0),h(this,"previousText",void 0),this.connectToBridge(),this.options.supportsFileSafe&&(this.fileSafeLoading=this.importFileSafe())}connectToBridge(){const{coallesedSaving:e,coallesedSavingDelay:n,mode:r,supportsFileSafe:i}=this.options;this.componentRelay=new(t())({targetWindow:window,options:{coallesedSaving:e,coallesedSavingDelay:n},onReady:()=>{const{platform:e}=this.componentRelay;e&&document.documentElement.classList.add(e)},onThemesChange:this.delegate.onThemesChange}),this.componentRelay.streamContextItem(async e=>{let t=!0;this.note&&this.note.uuid==e.uuid&&(t=!1);const n=this.note;if(i){const t=this.fileSafeClass.getSFItemClass();this.note=new t(e),this.fileSafeInstance.setCurrentNote(this.note)}else this.note=e;if(e.isMetadataUpdate)return;let a=e.content.text;if("html"===r&&t&&(/<[a-z][\s\S]*>/i.test(a)||(this.ignoreNextTextChange=!0)),this.previousText=a,i&&(this.needsFileSafeElementLoad=!0,a=c(a)),this.delegate.onNoteValueChange&&await this.delegate.onNoteValueChange(e),this.delegate.setEditorRawText(a),this.delegate.onNoteLockToggle){var s,o;const e=null!==(s=this.componentRelay.getItemAppDataValue(n,"locked"))&&void 0!==s&&s,t=null!==(o=this.componentRelay.getItemAppDataValue(this.note,"locked"))&&void 0!==o&&o;e!==t&&this.delegate.onNoteLockToggle(t)}var u,l;t&&(null===(u=(l=this.delegate).clearUndoHistory)||void 0===u||u.call(l))})}async importFileSafe(){try{return Promise.resolve().then(a.t.bind(a,695,23)).then(e=>(this.fileSafeClass=e.default,this.configureFileSafe(),this.fileSafeInstance))}catch(e){console.warn("[EditorKit] Could not import filesafe-js")}}configureFileSafe(){const e=["getCurrentLineText","getPreviousLineText","replaceText","getElementsBySelector","insertElement","preprocessElement","insertRawText"];for(const t of e)if(!this.delegate[t])throw Error("Missing ".concat(t," delegate function."));this.fileSafeInstance=new this.fileSafeClass({componentManager:this.componentRelay}),this.fileSafeInstance.addDataChangeObserver(()=>{const e=this.fileSafeInstance.getAllFileDescriptors();if(this.note&&this.fileIdsPendingAssociation.length>0){let t=!1;for(const n of this.fileIdsPendingAssociation.slice()){const r=e.find(e=>e.uuid==n);if(!r)continue;t=!0,this.fileIdsPendingAssociation.splice(this.fileIdsPendingAssociation.indexOf(n),1);const i=l(r);this.delegate.insertRawText(i)}t&&this.textExpander.searchPatterns()}e.length>0&&this.fileLoader.loadFileSafeElements()}),this.fileSafeInstance.addNewFileDescriptorHandler(e=>{this.fileIdsPendingAssociation.push(e.uuid)}),this.fileLoader=new i({fileSafeInstance:this.fileSafeInstance,getElementsBySelector:this.delegate.getElementsBySelector,insertElement:this.delegate.insertElement,preprocessElement:this.delegate.preprocessElement}),this.textExpander=new o({afterExpand:()=>this.fileLoader.loadFileSafeElements(),getCurrentLineText:this.delegate.getCurrentLineText,getPreviousLineText:this.delegate.getPreviousLineText,replaceText:this.delegate.replaceText,patterns:[{regex:u,callback:e=>c(e)}]})}async getFileSafe(){return!this.fileSafeInstance&&this.fileSafeLoading?this.fileSafeLoading:this.importFileSafe()}onEditorKeyUp(e){let{isSpace:t,isEnter:n}=e;this.textExpander.onKeyUp({isSpace:t,isEnter:n})}onEditorPaste(){this.textExpander.onKeyUp({isPaste:!0})}onEditorValueChanged(e){const{mode:t,supportsFileSafe:n}=this.options;if(this.needsFileSafeElementLoad&&(this.needsFileSafeElementLoad=!1,this.fileLoader.loadFileSafeElements()),this.ignoreNextTextChange)return void(this.ignoreNextTextChange=!1);if(n&&(e=(e=>{const t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("*[fscollapsable]");for(const r of n){const e=r.getAttribute("fsid"),t=r.getAttribute("fsname"),n=r.getAttribute("width"),i=r.getAttribute("height"),a=["FileSafe",e,t];if(n&&i){const e="".concat(n,"x").concat(i);a.push(e)}const s="<p>[".concat(a.join(":"),"]</p>");r.insertAdjacentHTML("afterend",s),r.remove()}return t.querySelectorAll("*[ghost]").forEach(e=>e.remove()),t.body.innerHTML})(e),this.previousText==e))return;if(this.previousText=e,!this.note)return;const r=this.note;this.componentRelay.saveItemWithPresave(r,()=>{if(r.content.text=e,this.delegate.generateCustomPreview){var n;const t=this.delegate.generateCustomPreview(e);r.content.preview_plain=null!==(n=t.plain)&&void 0!==n?n:" ",r.content.preview_html=t.html}else{if("html"===t){let t=e.replace(u,e=>"");t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}((e=>{const t=document.implementation.createHTMLDocument().body;return t.innerHTML=e,t.textContent||t.innerText||""})(t)),r.content.preview_plain=t.length>0?t:" "}else r.content.preview_plain=e;r.content.preview_html=null}})}canUploadFiles(){const e=this.fileSafeInstance.getAllCredentials(),t=this.fileSafeInstance.getAllIntegrations();return e.length>0&&t.length>0}async uploadJSFileObject(e){const t=this.fileLoader.insertStatusAtCursor("Processing file...");return this.fileSafeInstance.encryptAndUploadJavaScriptFileObject(e).then(()=>{this.fileLoader.removeCursorStatus(t)})}saveItemWithPresave(e,t){this.componentRelay.saveItemWithPresave(e,t)}get platform(){return this.componentRelay.platform}get environment(){return this.componentRelay.environment}canUseFileSafe(){return this.fileSafeInstance.hasLegacyAccess()}getComponentDataValueForKey(e){return this.componentRelay.getComponentDataValueForKey(e)}setComponentDataValueForKey(e,t){this.componentRelay.setComponentDataValueForKey(e,t)}isRunningInMobileApplication(){return this.componentRelay.isRunningInMobileApplication()}}})(),s.default})())},579:(e,t,n)=>{var r=n(3738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,n)=>{var r=n(6993),i=n(1791);e.exports=function(e,t,n,a,s){return new i(r().w(e,t,n,a),s||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},1791:(e,t,n)=>{var r=n(5172),i=n(5546);e.exports=function e(t,n){function a(e,i,s,o){try{var u=t[e](i),c=u.value;return c instanceof r?n.resolve(c.v).then(function(e){a("next",e,s,o)},function(e){a("throw",e,s,o)}):n.resolve(c).then(function(e){u.value=e,s(u)},function(e){return a("throw",e,s,o)})}catch(t){o(t)}}var s;this.next||(i(e.prototype),i(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),i(this,"_invoke",function(e,t,r){function i(){return new n(function(t,n){a(e,r,t,n)})}return s=s?s.then(i,i):i()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},2651:(e,t,n)=>{var r=n(4756);e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){(function(t){e.exports=function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){return i(t[s][1][e]||e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var a=!1,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,n,i){(function(e){var t,n,a,s,o,u,c=c||function(e){var t={},n=t.lib={},r=function(){},i=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,o=i/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var u=0;u<t;u+=s)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=t.algo={};return t}(Math);function l(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){v(a,r,i,s,o,"next",e)}function o(e){v(a,r,i,s,o,"throw",e)}s(void 0)})}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}n=(t=c).lib.WordArray,t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;4>s&&i+.75*s<n;s++)e.push(r.charAt(a>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,r=this._map;(i=r.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],a=0,s=0;s<t;s++)if(s%4){var o=r.indexOf(e.charAt(s-1))<<s%4*2,u=r.indexOf(e.charAt(s))>>>6-s%4*2;i[a>>>2]|=(o|u)<<24-a%4*8,a++}return n.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,i,a,s){return((e=e+(t&n|~t&r)+i+s)<<a|e>>>32-a)+t}function n(e,t,n,r,i,a,s){return((e=e+(t&r|n&~r)+i+s)<<a|e>>>32-a)+t}function r(e,t,n,r,i,a,s){return((e=e+(t^n^r)+i+s)<<a|e>>>32-a)+t}function i(e,t,n,r,i,a,s){return((e=e+(n^(t|~r))+i+s)<<a|e>>>32-a)+t}for(var a=c,s=(u=a.lib).WordArray,o=u.Hasher,u=a.algo,l=[],f=0;64>f;f++)l[f]=4294967296*e.abs(e.sin(f+1))|0;u=u.MD5=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var s=0;16>s;s++){var o=e[u=a+s];e[u]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}s=this._hash.words;var u=e[a+0],c=(o=e[a+1],e[a+2]),f=e[a+3],h=e[a+4],p=e[a+5],d=e[a+6],y=e[a+7],v=e[a+8],m=e[a+9],g=e[a+10],b=e[a+11],k=e[a+12],w=e[a+13],x=e[a+14],S=e[a+15],_=t(_=s[0],C=s[1],A=s[2],I=s[3],u,7,l[0]),I=t(I,_,C,A,o,12,l[1]),A=t(A,I,_,C,c,17,l[2]),C=t(C,A,I,_,f,22,l[3]);_=t(_,C,A,I,h,7,l[4]),I=t(I,_,C,A,p,12,l[5]),A=t(A,I,_,C,d,17,l[6]),C=t(C,A,I,_,y,22,l[7]),_=t(_,C,A,I,v,7,l[8]),I=t(I,_,C,A,m,12,l[9]),A=t(A,I,_,C,g,17,l[10]),C=t(C,A,I,_,b,22,l[11]),_=t(_,C,A,I,k,7,l[12]),I=t(I,_,C,A,w,12,l[13]),A=t(A,I,_,C,x,17,l[14]),_=n(_,C=t(C,A,I,_,S,22,l[15]),A,I,o,5,l[16]),I=n(I,_,C,A,d,9,l[17]),A=n(A,I,_,C,b,14,l[18]),C=n(C,A,I,_,u,20,l[19]),_=n(_,C,A,I,p,5,l[20]),I=n(I,_,C,A,g,9,l[21]),A=n(A,I,_,C,S,14,l[22]),C=n(C,A,I,_,h,20,l[23]),_=n(_,C,A,I,m,5,l[24]),I=n(I,_,C,A,x,9,l[25]),A=n(A,I,_,C,f,14,l[26]),C=n(C,A,I,_,v,20,l[27]),_=n(_,C,A,I,w,5,l[28]),I=n(I,_,C,A,c,9,l[29]),A=n(A,I,_,C,y,14,l[30]),_=r(_,C=n(C,A,I,_,k,20,l[31]),A,I,p,4,l[32]),I=r(I,_,C,A,v,11,l[33]),A=r(A,I,_,C,b,16,l[34]),C=r(C,A,I,_,x,23,l[35]),_=r(_,C,A,I,o,4,l[36]),I=r(I,_,C,A,h,11,l[37]),A=r(A,I,_,C,y,16,l[38]),C=r(C,A,I,_,g,23,l[39]),_=r(_,C,A,I,w,4,l[40]),I=r(I,_,C,A,u,11,l[41]),A=r(A,I,_,C,f,16,l[42]),C=r(C,A,I,_,d,23,l[43]),_=r(_,C,A,I,m,4,l[44]),I=r(I,_,C,A,k,11,l[45]),A=r(A,I,_,C,S,16,l[46]),_=i(_,C=r(C,A,I,_,c,23,l[47]),A,I,u,6,l[48]),I=i(I,_,C,A,y,10,l[49]),A=i(A,I,_,C,x,15,l[50]),C=i(C,A,I,_,p,21,l[51]),_=i(_,C,A,I,k,6,l[52]),I=i(I,_,C,A,f,10,l[53]),A=i(A,I,_,C,g,15,l[54]),C=i(C,A,I,_,o,21,l[55]),_=i(_,C,A,I,v,6,l[56]),I=i(I,_,C,A,S,10,l[57]),A=i(A,I,_,C,d,15,l[58]),C=i(C,A,I,_,w,21,l[59]),_=i(_,C,A,I,h,6,l[60]),I=i(I,_,C,A,b,10,l[61]),A=i(A,I,_,C,c,15,l[62]),C=i(C,A,I,_,m,21,l[63]),s[0]=s[0]+_|0,s[1]=s[1]+C|0,s[2]=s[2]+A|0,s[3]=s[3]+I|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var a=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=o._createHelper(u),a.HmacMD5=o._createHmacHelper(u)}(Math),function(){var e,t=c,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(o=this.cfg).hasher.create(),i=r.create(),a=i.words,s=o.keySize,o=o.iterations;a.length<s;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<o;c++)u=n.finalize(u),n.reset();i.concat(u)}return i.sigBytes=4*s,i}});t.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),c.lib.Cipher||function(){var e=(p=c).lib,t=e.Base,n=e.WordArray,r=e.BufferedBlockAlgorithm,i=p.enc.Base64,a=p.algo.EvpKDF,s=e.Cipher=r.extend({cfg:t.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:h).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:h).decrypt(e,t,n,r)}}}});e.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var o=p.mode={},u=function(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},l=(e.BlockCipherMode=t.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;u.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),u.call(this,e,t,r),this._prevBlock=i}}),o=o.CBC=l,l=(p.pad={}).Pkcs7={pad:function(e,t){for(var r,i=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,a=[],s=0;s<r;s+=4)a.push(i);r=n.create(a,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},e.BlockCipher=s.extend({cfg:s.cfg.extend({mode:o,padding:l}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var f=e.CipherParams=t.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(o=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?n.create([1398893684,1701076831]).concat(e).concat(t):t).toString(i)},parse:function(e){var t=(e=i.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=n.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return f.create({ciphertext:e,salt:r})}},e.SerializableCipher=t.extend({cfg:t.extend({format:o}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,f.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,r,i){return i||(i=n.random(8)),e=a.create({keySize:t+r}).compute(e,i),r=n.create(e.words.slice(t),4*r),e.sigBytes=4*t,f.create({key:e,iv:r,salt:i})}},d=e.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:p}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=h.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,h.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=c,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],a=[],s=[],o=[],u=[],l=[],f=[],h=[],p=[],d=[],y=0;256>y;y++)d[y]=128>y?y<<1:y<<1^283;var v=0,m=0;for(y=0;256>y;y++){var g=(g=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&g^99;r[v]=g,i[g]=v;var b=d[v],k=d[b],w=d[k],x=257*d[g]^16843008*g;a[v]=x<<24|x>>>8,s[v]=x<<16|x>>>16,o[v]=x<<8|x>>>24,u[v]=x,x=16843009*w^65537*k^257*b^16843008*v,l[g]=x<<24|x>>>8,f[g]=x<<16|x>>>16,h[g]=x<<8|x>>>24,p[g]=x,v?(v=b^d[d[d[w^b]]],m^=d[d[m]]):v=m=1}var S=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],a=0;a<n;a++)if(a<t)i[a]=e[a];else{var s=i[a-1];a%t?6<t&&4==a%t&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=r[(s=s<<8|s>>>24)>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=S[a/t|0]<<24),i[a]=i[a-t]^s}for(e=this._invKeySchedule=[],t=0;t<n;t++)a=n-t,s=t%4?i[a]:i[a-4],e[t]=4>t||4>=a?s:l[r[s>>>24]]^f[r[s>>>16&255]]^h[r[s>>>8&255]]^p[r[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,o,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,h,p,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,a,s,o){for(var u=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],h=e[t+3]^n[3],p=4,d=1;d<u;d++){var y=r[c>>>24]^i[l>>>16&255]^a[f>>>8&255]^s[255&h]^n[p++],v=r[l>>>24]^i[f>>>16&255]^a[h>>>8&255]^s[255&c]^n[p++],m=r[f>>>24]^i[h>>>16&255]^a[c>>>8&255]^s[255&l]^n[p++];h=r[h>>>24]^i[c>>>16&255]^a[l>>>8&255]^s[255&f]^n[p++],c=y,l=v,f=m}y=(o[c>>>24]<<24|o[l>>>16&255]<<16|o[f>>>8&255]<<8|o[255&h])^n[p++],v=(o[l>>>24]<<24|o[f>>>16&255]<<16|o[h>>>8&255]<<8|o[255&c])^n[p++],m=(o[f>>>24]<<24|o[h>>>16&255]<<16|o[c>>>8&255]<<8|o[255&l])^n[p++],h=(o[h>>>24]<<24|o[c>>>16&255]<<16|o[l>>>8&255]<<8|o[255&f])^n[p++],e[t]=y,e[t+1]=v,e[t+2]=m,e[t+3]=h},keySize:8}),e.AES=t._createHelper(n)}(),c=c||function(e){var t={},n=t.lib={},r=function(){},i=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,o=i/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var u=0;u<t;u+=s)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=t.algo={};return t}(Math),function(e){for(var t=c,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,a=[],s=[],o=function(e){return 4294967296*(e-(0|e))|0},u=2,l=0;64>l;){var f;e:{f=u;for(var h=e.sqrt(f),p=2;p<=h;p++)if(!(f%p)){f=!1;break e}f=!0}f&&(8>l&&(a[l]=o(e.pow(u,.5))),s[l]=o(e.pow(u,1/3)),l++),u++}var d=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=0;64>h;h++){if(16>h)d[h]=0|e[t+h];else{var p=d[h-15],y=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+d[h-16]}p=f+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&l)+s[h]+d[h],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&a^i&a),f=l,l=c,c=u,u=o+p|0,o=a,a=i,i=r,r=p+y|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),s=(a=c).enc.Utf8,a.algo.HMAC=a.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),o=i.words,u=a.words,c=0;c<n;c++)o[c]^=1549556828,u[c]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),c=c||function(e){var t={},n=t.lib={},r=function(){},i=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,o=i/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var u=0;u<t;u+=s)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=t.algo={};return t}(Math),function(){var e,t=(e=c).lib,n=t.Base,r=t.WordArray;(e=e.x64={}).Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),e.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var a=e[i];n.push(a.high),n.push(a.low)}return r.create(n,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),r=t.length,i=0;i<r;i++)t[i]=t[i].clone();return e}})}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=c,n=t.lib.Hasher,r=(a=t.x64).Word,i=a.WordArray,a=t.algo,s=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],o=[],u=0;80>u;u++)o[u]=e();a=a.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(f=this._hash.words)[0],r=f[1],i=f[2],a=f[3],u=f[4],c=f[5],l=f[6],f=f[7],h=n.high,p=n.low,d=r.high,y=r.low,v=i.high,m=i.low,g=a.high,b=a.low,k=u.high,w=u.low,x=c.high,S=c.low,_=l.high,I=l.low,A=f.high,C=f.low,D=h,M=p,F=d,O=y,E=v,T=m,P=g,j=b,L=k,B=w,R=x,H=S,N=_,U=I,K=A,z=C,W=0;80>W;W++){var J=o[W];if(16>W)var q=J.high=0|e[t+2*W],V=J.low=0|e[t+2*W+1];else{q=((V=(q=o[W-15]).high)>>>1|($=q.low)<<31)^(V>>>8|$<<24)^V>>>7;var $=($>>>1|V<<31)^($>>>8|V<<24)^($>>>7|V<<25),G=((V=(G=o[W-2]).high)>>>19|(Q=G.low)<<13)^(V<<3|Q>>>29)^V>>>6,Q=(Q>>>19|V<<13)^(Q<<3|V>>>29)^(Q>>>6|V<<26),X=(V=o[W-7]).high,Y=(Z=o[W-16]).high,Z=Z.low;q=(q=(q=q+X+((V=$+V.low)>>>0<$>>>0?1:0))+G+((V+=Q)>>>0<Q>>>0?1:0))+Y+((V+=Z)>>>0<Z>>>0?1:0),J.high=q,J.low=V}X=L&R^~L&N,Z=B&H^~B&U,J=D&F^D&E^F&E;var ee=M&O^M&T^O&T,te=($=(D>>>28|M<<4)^(D<<30|M>>>2)^(D<<25|M>>>7),G=(M>>>28|D<<4)^(M<<30|D>>>2)^(M<<25|D>>>7),(Q=s[W]).high),ne=Q.low;Y=K+((L>>>14|B<<18)^(L>>>18|B<<14)^(L<<23|B>>>9))+((Q=z+((B>>>14|L<<18)^(B>>>18|L<<14)^(B<<23|L>>>9)))>>>0<z>>>0?1:0),K=N,z=U,N=R,U=H,R=L,H=B,L=P+(Y=(Y=(Y=Y+X+((Q+=Z)>>>0<Z>>>0?1:0))+te+((Q+=ne)>>>0<ne>>>0?1:0))+q+((Q+=V)>>>0<V>>>0?1:0))+((B=j+Q|0)>>>0<j>>>0?1:0)|0,P=E,j=T,E=F,T=O,F=D,O=M,D=Y+(J=$+J+((V=G+ee)>>>0<G>>>0?1:0))+((M=Q+V|0)>>>0<Q>>>0?1:0)|0}p=n.low=p+M,n.high=h+D+(p>>>0<M>>>0?1:0),y=r.low=y+O,r.high=d+F+(y>>>0<O>>>0?1:0),m=i.low=m+T,i.high=v+E+(m>>>0<T>>>0?1:0),b=a.low=b+j,a.high=g+P+(b>>>0<j>>>0?1:0),w=u.low=w+B,u.high=k+L+(w>>>0<B>>>0?1:0),S=c.low=S+H,c.high=x+R+(S>>>0<H>>>0?1:0),I=l.low=I+U,l.high=_+N+(I>>>0<U>>>0?1:0),C=f.low=C+z,f.high=A+K+(C>>>0<z>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(a),t.HmacSHA512=n._createHmacHelper(a)}(),u=(o=c).enc.Utf8,o.algo.HMAC=o.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,o=a.words,c=0;c<n;c++)s[c]^=1549556828,o[c]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),c=c||function(e){var t={},n=t.lib={},r=function(){},i=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,o=i/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var u=0;u<t;u+=s)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=t.algo={};return t}(Math),function(){var e=c,t=(i=e.lib).WordArray,n=i.Hasher,r=[],i=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],a=n[1],s=n[2],o=n[3],u=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var l=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=l<<1|l>>>31}l=(i<<5|i>>>27)+u+r[c],l=20>c?l+(1518500249+(a&s|~a&o)):40>c?l+(1859775393+(a^s^o)):60>c?l+((a&s|a&o|s&o)-1894007588):l+((a^s^o)-899497514),u=o,o=s,s=a<<30|a>>>2,a=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+a|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(i),e.HmacSHA1=n._createHmacHelper(i)}(),function(){var e=c,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var a=this._oKey=n.clone(),s=this._iKey=n.clone(),o=a.words,u=s.words,c=0;c<r;c++)o[c]^=1549556828,u[c]^=909522486;a.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=c,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).HMAC,a=e.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,a=i.create(n.hasher,e),s=r.create(),o=r.create([1]),u=s.words,c=o.words,l=n.keySize;for(n=n.iterations;u.length<l;){var f=a.update(t).finalize(o);a.reset();for(var h=f.words,p=h.length,d=f,y=1;y<n;y++){d=a.finalize(d),a.reset();for(var v=d.words,m=0;m<p;m++)h[m]^=v[m]}s.concat(f),c[0]++}return s.sigBytes=4*l,s}});t.PBKDF2=function(e,t,n){return a.create(n).compute(e,t)}}(),c=c||function(e){var t={},n=t.lib={},r=function(){},i=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,o=i/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var u=0;u<t;u+=s)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=t.algo={};return t}(Math),function(){var e=c,t=(i=e.lib).WordArray,n=i.Hasher,r=[],i=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],a=n[1],s=n[2],o=n[3],u=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var l=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=l<<1|l>>>31}l=(i<<5|i>>>27)+u+r[c],l=20>c?l+(1518500249+(a&s|~a&o)):40>c?l+(1859775393+(a^s^o)):60>c?l+((a&s|a&o|s&o)-1894007588):l+((a^s^o)-899497514),u=o,o=s,s=a<<30|a>>>2,a=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+a|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(i),e.HmacSHA1=n._createHmacHelper(i)}(),Object.defineProperty(i,"__esModule",{value:!0}),i.StandardFile=i.SFItemTransformer=i.SFCryptoWeb=i.SFCryptoJS=i.SFAbstractCrypto=i.SFItemHistoryEntry=i.SFItemHistory=i.SFHistorySession=i.SFPrivileges=i.SFPredicate=i.SFItemParams=i.SFItem=i.SFSyncManager=i.SFStorageManager=i.SFSingletonManager=i.SFSessionHistoryManager=i.SFPrivilegesManager=i.SFModelManager=i.SFMigrationManager=i.SFHttpManager=i.SFAuthManager=i.SFAlertManager=void 0;var w=function(){function e(){g(this,e)}var t,n;return k(e,[{key:"alert",value:(n=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){window.alert(t.text),e()}));case 1:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})},{key:"confirm",value:(t=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){window.confirm(t.text)?e():n()}));case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}]),e}();i.SFAlertManager=w;var x=function(){function e(t,n,r,i){g(this,e),e.DidSignOutEvent="DidSignOutEvent",e.WillSignInEvent="WillSignInEvent",e.DidSignInEvent="DidSignInEvent",this.httpManager=n,this.storageManager=t,this.alertManager=r||new w,this.$timeout=i||setTimeout.bind(window),this.eventHandlers=[]}var t,n,i,a,s,o,u,c,l,f;return k(e,[{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,s=this.eventHandlers[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(0,a.value)(e,t||{})}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"saveKeys",value:(f=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._keys=t,e.next=3,this.storageManager.setItem("mk",t.mk);case 3:return e.next=5,this.storageManager.setItem("ak",t.ak);case 5:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"signout",value:(l=m(r.mark(function t(n){var i=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._keys=null,this._authParams=null,!n){t.next=6;break}return t.abrupt("return",this.storageManager.clearAllData().then(function(){i.notifyEvent(e.DidSignOutEvent)}));case 6:this.notifyEvent(e.DidSignOutEvent);case 7:case"end":return t.stop()}},t,this)})),function(e){return l.apply(this,arguments)})},{key:"keys",value:(c=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._keys){e.next=11;break}return e.next=3,this.storageManager.getItem("mk");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.t0=t,e.next=9,this.storageManager.getItem("ak");case 9:e.t1=e.sent,this._keys={mk:e.t0,ak:e.t1};case 11:return e.abrupt("return",this._keys);case 12:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"getAuthParams",value:(u=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._authParams){e.next=5;break}return e.next=3,this.storageManager.getItem("auth_params");case 3:t=e.sent,this._authParams=JSON.parse(t);case 5:if(!this._authParams||this._authParams.version){e.next=9;break}return e.next=8,this.defaultProtocolVersion();case 8:this._authParams.version=e.sent;case 9:return e.abrupt("return",this._authParams);case 10:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"defaultProtocolVersion",value:(o=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keys();case 2:if(!(t=e.sent)||!t.ak){e.next=7;break}return e.abrupt("return","002");case 7:return e.abrupt("return","001");case 8:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"protocolVersion",value:(s=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthParams();case 2:if(!(t=e.sent)||!t.version){e.next=5;break}return e.abrupt("return",t.version);case 5:return e.abrupt("return",this.defaultProtocolVersion());case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"getAuthParamsForEmail",value:(a=m(r.mark(function e(t,n,i){var a,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=_.merge({email:n},i)).api=I.getApiVersion(),e.abrupt("return",new Promise(function(e,n){var r=t+"/auth/params";s.httpManager.getAbsolute(r,a,function(t){e(t)},function(t){console.error("Error getting auth params",t),"object"!==y(t)&&(t={error:{message:"A server error occurred while trying to sign in. Please try again."}}),e(t)})}));case 3:case"end":return e.stop()}},e)})),function(e,t,n){return a.apply(this,arguments)})},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"isLocked",value:function(){return 1==this.locked}},{key:"unlockAndResolve",value:function(e,t){this.unlock(),e(t)}},{key:"login",value:(i=m(r.mark(function t(n,i,a,s,o){var u=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=m(r.mark(function t(c,l){var f,h,p,d,v,g,b,k,w,x;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.keys();case 2:if(null==t.sent){t.next=6;break}return c({error:{message:"Cannot log in because already signed in."}}),t.abrupt("return");case 6:if(!u.isLocked()){t.next=9;break}return c({error:{message:"Login already in progress."}}),t.abrupt("return");case 9:return u.lock(),u.notifyEvent(e.WillSignInEvent),t.next=13,u.getAuthParamsForEmail(n,i,o);case 13:if((f=t.sent).identifier=i,!f.error){t.next=18;break}return u.unlockAndResolve(c,f),t.abrupt("return");case 18:if(f&&f.pw_cost){t.next=21;break}return u.unlockAndResolve(c,{error:{message:"Invalid email or password."}}),t.abrupt("return");case 21:if(SFJS.supportedVersions().includes(f.version)){t.next=25;break}return h=SFJS.isVersionNewerThanLibraryVersion(f.version)?"This version of the application does not support your newer account type. Please upgrade to the latest version of Standard Notes to sign in.":"The protocol version associated with your account is outdated and no longer supported by this application. Please visit standardnotes.org/help/security for more information.",u.unlockAndResolve(c,{error:{message:h}}),t.abrupt("return");case 25:if(!SFJS.isProtocolVersionOutdated(f.version)){t.next=32;break}return p="The encryption version for your account, ".concat(f.version,", is outdated and requires upgrade. You may proceed with login, but are advised to perform a security update using the web or desktop application. Please visit standardnotes.org/help/security for more information."),d=!1,t.next=30,u.alertManager.confirm({title:"Update Needed",text:p,confirmButtonText:"Sign In"}).catch(function(){u.unlockAndResolve(c,{error:{}}),d=!0});case 30:if(!d){t.next=32;break}return t.abrupt("return");case 32:if(SFJS.supportsPasswordDerivationCost(f.pw_cost)){t.next=36;break}return u.unlockAndResolve(c,{error:{message:"Your account was created on a platform with higher security capabilities than this browser supports. If we attempted to generate your login keys here, it would take hours. Please use a browser with more up to date security capabilities, like Google Chrome or Firefox, to log in."}}),t.abrupt("return");case 36:if(v=SFJS.costMinimumForVersion(f.version),!(f.pw_cost<v)){t.next=41;break}return u.unlockAndResolve(c,{error:{message:"Unable to login due to insecure password parameters. Please visit standardnotes.org/help/security for more information."}}),t.abrupt("return");case 41:if(!s){t.next=47;break}if(g=SFJS.version(),f.version===g){t.next=47;break}return b="Strict sign in refused server sign in parameters. The latest security version is ".concat(g,", but your account is reported to have version ").concat(f.version,". If you'd like to proceed with sign in anyway, please disable strict sign in and try again."),u.unlockAndResolve(c,{error:{message:b}}),t.abrupt("return");case 47:return t.next=49,SFJS.crypto.computeEncryptionKeysForUser(a,f);case 49:k=t.sent,w=n+"/auth/sign_in",(x=_.merge({password:k.pw,email:i},o)).api=I.getApiVersion(),u.httpManager.postAbsolute(w,x,function(){var t=m(r.mark(function t(a){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.handleAuthResponse(a,i,n,f,k);case 2:u.notifyEvent(e.DidSignInEvent),u.$timeout(function(){return u.unlockAndResolve(c,a)});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error("Error logging in",e),"object"!==y(e)&&(e={error:{message:"A server error occurred while trying to sign in. Please try again."}}),u.$timeout(function(){return u.unlockAndResolve(c,e)})});case 54:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},t)})),function(e,t,n,r,a){return i.apply(this,arguments)})},{key:"register",value:function(e,t,n){var i=this;return new Promise(function(){var a=m(r.mark(function a(s,o){var u,c,l,f,h,p;return r.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.isLocked()){a.next=3;break}return s({error:{message:"Register already in progress."}}),a.abrupt("return");case 3:if(!(n.length<8)){a.next=8;break}return u="Your password must be at least ".concat(8," characters in length. For your security, please choose a longer password or, ideally, a passphrase, and try again."),s({error:{message:u}}),a.abrupt("return");case 8:return i.lock(),a.next=11,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(t,n);case 11:c=a.sent,l=c.keys,f=c.authParams,h=e+"/auth",(p=_.merge({password:l.pw,email:t},f)).api=I.getApiVersion(),i.httpManager.postAbsolute(h,p,function(){var n=m(r.mark(function n(a){return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.handleAuthResponse(a,t,e,f,l);case 2:i.unlockAndResolve(s,a);case 3:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),function(e){console.error("Registration error",e),"object"!==y(e)&&(e={error:{message:"A server error occurred while trying to register. Please try again."}}),i.unlockAndResolve(s,e)});case 18:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"changePassword",value:(n=m(r.mark(function e(t,n,i,a,s){var o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=m(r.mark(function e(u,c){var l,f,h;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.isLocked()){e.next=3;break}return u({error:{message:"Change password already in progress."}}),e.abrupt("return");case 3:o.lock(),l=a.pw,f=t+"/auth/change_pw",(h=_.merge({new_password:l,current_password:i},s)).api=I.getApiVersion(),o.httpManager.postAuthenticatedAbsolute(f,h,function(){var e=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.handleAuthResponse(t,n,null,s,a);case 2:o.unlockAndResolve(u,t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e){"object"!==y(e)&&(e={error:{message:"Something went wrong while changing your password. Your password was not changed. Please try again."}}),o.unlockAndResolve(u,e)});case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"handleAuthResponse",value:(t=m(r.mark(function e(t,n,i,a,s){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=3;break}return e.next=3,this.storageManager.setItem("server",i);case 3:return this._authParams=a,e.next=6,this.storageManager.setItem("auth_params",JSON.stringify(a));case 6:return e.next=8,this.storageManager.setItem("jwt",t.token);case 8:return e.abrupt("return",this.saveKeys(s));case 9:case"end":return e.stop()}},e,this)})),function(e,n,r,i,a){return t.apply(this,arguments)})}]),e}();i.SFAuthManager=x;var S="undefined"!=typeof window?window:void 0!==e?e:null,I=function(){function e(t,n){g(this,e),this.$timeout=t||setTimeout.bind(S)}var t,n,i,a,s,o;return k(e,null,[{key:"getApiVersion",value:function(){return"20190520"}}]),k(e,[{key:"setJWTRequestHandler",value:function(e){this.jwtRequestHandler=e}},{key:"setAuthHeadersForRequest",value:(o=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.jwtRequestHandler();case 2:(n=e.sent)&&t.setRequestHeader("Authorization","Bearer "+n);case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"postAbsolute",value:(s=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,n,i,a));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"postAuthenticatedAbsolute",value:(a=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,n,i,a,!0));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return a.apply(this,arguments)})},{key:"patchAbsolute",value:(i=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("patch",t,n,i,a));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return i.apply(this,arguments)})},{key:"getAbsolute",value:(n=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("get",t,n,i,a));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r,i){return n.apply(this,arguments)})},{key:"httpRequest",value:(t=m(r.mark(function e(t,n,i,a,s){var o,u=this,c=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.length>5&&void 0!==c[5]&&c[5],e.abrupt("return",new Promise(function(){var e=m(r.mark(function e(c,l){var f;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((f=new XMLHttpRequest).onreadystatechange=function(){if(4==f.readyState){var e=f.responseText;if(e)try{e=JSON.parse(e)}catch(e){}f.status>=200&&f.status<=299?u.$timeout(function(){a(e),c(e)}):(console.error("Request error:",e),u.$timeout(function(){s(e,f.status),l(e)}))}},"get"==t&&Object.keys(i).length>0&&(n=u.urlForUrlAndParams(n,i)),f.open(t,n,!0),f.setRequestHeader("Content-type","application/json"),!o){e.next=8;break}return e.next=8,u.setAuthHeadersForRequest(f);case 8:"post"==t||"patch"==t?f.send(JSON.stringify(i)):f.send();case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)})),function(e,n,r,i,a){return t.apply(this,arguments)})},{key:"urlForUrlAndParams",value:function(e,t){var n=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&");return e.includes("?")?e+"&"+n:e+"?"+n}}]),e}();i.SFHttpManager=I;var A=function(){function e(t,n,i,a){var s=this;g(this,e),this.modelManager=t,this.syncManager=n,this.storageManager=i,this.completionHandlers=[],this.loadMigrations();var o=!1,u=a.addEventHandler(function(e){e==x.DidSignInEvent&&(o=!0)});this.receivedLocalDataEvent=n.initialDataLoaded(),this.syncManager.addEventHandler(function(){var e=m(r.mark(function e(t,n){var i,c,l,f,h,p,d,y,v;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c="sync:completed"==t,!(i="local-data-loaded"==t)&&!c){e.next=40;break}if(i?s.receivedLocalDataEvent=!0:c&&(s.receivedSyncCompletedEvent=!0),!s.receivedLocalDataEvent||!s.receivedSyncCompletedEvent){e.next=40;break}if(!o){e.next=39;break}return o=!1,a.removeEventHandler(u),e.next=10,s.getCompletedMigrations();case 10:l=e.sent.slice(),f=!0,h=!1,p=void 0,e.prev=14,d=l[Symbol.iterator]();case 16:if(f=(y=d.next()).done){e.next=25;break}return v=y.value,e.next=20,s.migrationForEncodedName(v);case 20:e.sent.runOnlyOnce||_.pull(s._completed,v);case 22:f=!0,e.next=16;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(14),h=!0,p=e.t0;case 31:e.prev=31,e.prev=32,f||null==d.return||d.return();case 34:if(e.prev=34,!h){e.next=37;break}throw p;case 37:return e.finish(34);case 38:return e.finish(31);case 39:s.runPendingMigrations();case 40:case"end":return e.stop()}},e,null,[[14,27,31,39],[32,,34,38]])}));return function(t,n){return e.apply(this,arguments)}}())}var t,n,i,a,s,o,u,c;return k(e,[{key:"addCompletionHandler",value:function(e){this.completionHandlers.push(e)}},{key:"removeCompletionHandler",value:function(e){_.pull(this.completionHandlers,e)}},{key:"migrationForEncodedName",value:(c=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decode(t);case 2:return n=e.sent,e.abrupt("return",this.migrations.find(function(e){return e.name==n}));case 4:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"loadMigrations",value:function(){this.migrations=this.registeredMigrations()}},{key:"registeredMigrations",value:function(){}},{key:"runPendingMigrations",value:(u=m(r.mark(function e(){var t,n,i,a,s,o,u,c,l,f,h,p,d,y,v,m,g,b,k,w,x,S,_,I,A,C,D,M;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPendingMigrations();case 2:for(t=e.sent,n=!0,i=!1,a=void 0,e.prev=6,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)(u=o.value).items=[];e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,a=e.t0;case 14:e.prev=14,e.prev=15,n||null==s.return||s.return();case 17:if(e.prev=17,!i){e.next=20;break}throw a;case 20:return e.finish(17);case 21:return e.finish(14);case 22:c=!0,l=!1,f=void 0,e.prev=25,h=this.modelManager.allNondummyItems[Symbol.iterator]();case 27:if(c=(p=h.next()).done){e.next=51;break}for(d=p.value,y=!0,v=!1,m=void 0,e.prev=32,g=t[Symbol.iterator]();!(y=(b=g.next()).done);y=!0)u=b.value,d.content_type==u.content_type&&u.items.push(d);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),v=!0,m=e.t1;case 40:e.prev=40,e.prev=41,y||null==g.return||g.return();case 43:if(e.prev=43,!v){e.next=46;break}throw m;case 46:return e.finish(43);case 47:return e.finish(40);case 48:c=!0,e.next=27;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(25),l=!0,f=e.t2;case 57:e.prev=57,e.prev=58,c||null==h.return||h.return();case 60:if(e.prev=60,!l){e.next=63;break}throw f;case 63:return e.finish(60);case 64:return e.finish(57);case 65:k=!0,w=!1,x=void 0,e.prev=68,S=t[Symbol.iterator]();case 70:if(k=(_=S.next()).done){e.next=81;break}if(!((u=_.value).items&&u.items.length>0||u.customHandler)){e.next=77;break}return e.next=75,this.runMigration(u,u.items);case 75:e.next=78;break;case 77:this.markMigrationCompleted(u);case 78:k=!0,e.next=70;break;case 81:e.next=87;break;case 83:e.prev=83,e.t3=e.catch(68),w=!0,x=e.t3;case 87:e.prev=87,e.prev=88,k||null==S.return||S.return();case 90:if(e.prev=90,!w){e.next=93;break}throw x;case 93:return e.finish(90);case 94:return e.finish(87);case 95:for(I=!0,A=!1,C=void 0,e.prev=98,D=this.completionHandlers[Symbol.iterator]();!(I=(M=D.next()).done);I=!0)(0,M.value)();e.next=106;break;case 102:e.prev=102,e.t4=e.catch(98),A=!0,C=e.t4;case 106:e.prev=106,e.prev=107,I||null==D.return||D.return();case 109:if(e.prev=109,!A){e.next=112;break}throw C;case 112:return e.finish(109);case 113:return e.finish(106);case 114:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21],[25,53,57,65],[32,36,40,48],[41,,43,47],[58,,60,64],[68,83,87,95],[88,,90,94],[98,102,106,114],[107,,109,113]])})),function(){return u.apply(this,arguments)})},{key:"encode",value:(o=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.btoa(t));case 1:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)})},{key:"decode",value:(s=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.atob(t));case 1:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"getCompletedMigrations",value:(a=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._completed){e.next=5;break}return e.next=3,this.storageManager.getItem("migrations");case 3:t=e.sent,this._completed=t?JSON.parse(t):[];case 5:return e.abrupt("return",this._completed);case 6:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getPendingMigrations",value:(i=m(r.mark(function e(){var t,n,i,a,s,o,u,c;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:t=e.sent,n=[],i=!0,a=!1,s=void 0,e.prev=7,o=this.migrations[Symbol.iterator]();case 9:if(i=(u=o.next()).done){e.next=22;break}return c=u.value,e.t0=t,e.next=14,this.encode(c.name);case 14:if(e.t1=e.sent,e.t2=e.t0.indexOf.call(e.t0,e.t1),e.t3=-1,e.t2!=e.t3){e.next=19;break}n.push(c);case 19:i=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t4=e.catch(7),a=!0,s=e.t4;case 28:e.prev=28,e.prev=29,i||null==o.return||o.return();case 31:if(e.prev=31,!a){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",n);case 37:case"end":return e.stop()}},e,this,[[7,24,28,36],[29,,31,35]])})),function(){return i.apply(this,arguments)})},{key:"markMigrationCompleted",value:(n=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:return n=e.sent,e.t0=n,e.next=6,this.encode(t.name);case 6:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),this.storageManager.setItem("migrations",JSON.stringify(n)),t.running=!1;case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"runMigration",value:(t=m(r.mark(function e(t,n){var i=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.running){e.next=2;break}return e.abrupt("return");case 2:if(console.log("Running migration:",t.name),t.running=!0,!t.customHandler){e.next=8;break}return e.abrupt("return",t.customHandler().then(function(){i.markMigrationCompleted(t)}));case 8:return e.abrupt("return",t.handler(n).then(function(){i.markMigrationCompleted(t)}));case 9:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFMigrationManager=A;var C=function(){function e(t){g(this,e),e.MappingSourceRemoteRetrieved="MappingSourceRemoteRetrieved",e.MappingSourceRemoteSaved="MappingSourceRemoteSaved",e.MappingSourceLocalSaved="MappingSourceLocalSaved",e.MappingSourceLocalRetrieved="MappingSourceLocalRetrieved",e.MappingSourceLocalDirtied="MappingSourceLocalDirtied",e.MappingSourceComponentRetrieved="MappingSourceComponentRetrieved",e.MappingSourceDesktopInstalled="MappingSourceDesktopInstalled",e.MappingSourceRemoteActionRetrieved="MappingSourceRemoteActionRetrieved",e.MappingSourceFileImport="MappingSourceFileImport",e.isMappingSourceRetrieved=function(t){return[e.MappingSourceRemoteRetrieved,e.MappingSourceComponentRetrieved,e.MappingSourceRemoteActionRetrieved].includes(t)},this.$timeout=t||setTimeout.bind(window),this.itemSyncObservers=[],this.items=[],this.itemsHash={},this.missedReferences={},this.uuidChangeObservers=[]}var t,n,i,a,s,o,u,c,l,f,h,p;return k(e,[{key:"handleSignout",value:function(){this.items.length=0,this.itemsHash={},this.missedReferences={}}},{key:"addModelUuidChangeObserver",value:function(e,t){this.uuidChangeObservers.push({id:e,callback:t})}},{key:"notifyObserversOfUuidChange",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,s=this.uuidChangeObservers[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;try{o.callback(e,t)}catch(e){console.error("Notify observers of uuid change exception:",e)}}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"alternateUUIDForItem",value:(p=m(r.mark(function t(n){var i,a,s,o,u,c,l;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.createItem(n),t.next=3,SFJS.crypto.generateUUID();case 3:for(i.uuid=t.sent,i.informReferencesOfUUIDChange(n.uuid,i.uuid),this.informModelsOfUUIDChangeForItem(i,n.uuid,i.uuid),a=!0,s=!1,o=void 0,t.prev=9,u=n.referencingObjects[Symbol.iterator]();!(a=(c=u.next()).done);a=!0)(l=c.value).setIsNoLongerBeingReferencedBy(n),n.setIsNoLongerBeingReferencedBy(l),l.addItemAsRelationship(i);t.next=17;break;case 13:t.prev=13,t.t0=t.catch(9),s=!0,o=t.t0;case 17:t.prev=17,t.prev=18,a||null==u.return||u.return();case 20:if(t.prev=20,!s){t.next=23;break}throw o;case 23:return t.finish(20);case 24:return t.finish(17);case 25:return this.setItemsDirty(n.referencingObjects,!0),this.resolveReferencesForItem(i),this.loggingEnabled&&console.log(n.uuid,"--\x3e",i.uuid),n.deleted=!0,n.content.references=[],this.setItemDirty(n,!1,!1,e.MappingSourceLocalSaved),t.next=33,this.mapResponseItemsToLocalModels([n],e.MappingSourceLocalSaved);case 33:return this.addItem(i),this.setItemDirty(i,!0,!0,e.MappingSourceLocalSaved),this.notifyObserversOfUuidChange(n,i),t.abrupt("return",i);case 37:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24]])})),function(e){return p.apply(this,arguments)})},{key:"informModelsOfUUIDChangeForItem",value:function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var s,o=this.items[Symbol.iterator]();!(r=(s=o.next()).done);r=!0)s.value.potentialItemOfInterestHasChangedItsUUID(e,t,n)}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}}},{key:"didSyncModelsOffline",value:function(t){this.notifySyncObserversOfModels(t,e.MappingSourceLocalSaved)}},{key:"mapResponseItemsToLocalModels",value:(h=m(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,source:n,sourceKey:i}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"mapResponseItemsToLocalModelsOmittingFields",value:(f=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,omitFields:n,source:i,sourceKey:a}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return f.apply(this,arguments)})},{key:"mapResponseItemsToLocalModelsWithOptions",value:(l=m(r.mark(function e(t){var n,i,a,s,o,u,c,l,f,h,p,y,v,m,g,b,k,w,x,S,_,I,A,C,D,M,F,O,E,T,P,j,L,B,R,H,N,U,K;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.items,i=t.omitFields,a=t.source,s=t.sourceKey,t.options,o=[],u=[],c=[],l=!0,f=!1,h=void 0,e.prev=5,p=n[Symbol.iterator]();case 7:if(l=(y=p.next()).done){e.next=58;break}if(v=y.value){e.next=11;break}return e.abrupt("continue",55);case 11:if(m=!v.content&&!v.errorDecrypting,v.content_type&&v.uuid&&!m||v.deleted){e.next=16;break}return console.error("Server response item is corrupt:",v),e.abrupt("continue",55);case 16:if(!Array.isArray(i)){e.next=36;break}for(g=!0,b=!1,k=void 0,e.prev=20,w=i[Symbol.iterator]();!(g=(x=w.next()).done);g=!0)S=x.value,delete v[S];e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),b=!0,k=e.t0;case 28:e.prev=28,e.prev=29,g||null==w.return||w.return();case 31:if(e.prev=31,!b){e.next=34;break}throw k;case 34:return e.finish(31);case 35:return e.finish(28);case 36:if((_=this.findItem(v.uuid))&&(_.updateFromJSON(v),_.dummy=!1),I=v.content_type||_&&_.content_type,!this.acceptableContentTypes||this.acceptableContentTypes.includes(I)){e.next=42;break}return e.abrupt("continue",55);case 42:if(A=!1,1!=v.deleted){e.next=50;break}if(!v.dirty){e.next=48;break}A=!0,e.next=50;break;case 48:return _&&(o.push(_),c.push(_),this.removeItemLocally(_)),e.abrupt("continue",55);case 50:_||(_=this.createItem(v)),this.addItem(_,A),_.errorDecrypting||c.push(_),o.push(_),u.push(v);case 55:l=!0,e.next=7;break;case 58:e.next=64;break;case 60:e.prev=60,e.t1=e.catch(5),f=!0,h=e.t1;case 64:e.prev=64,e.prev=65,l||null==p.return||p.return();case 67:if(e.prev=67,!f){e.next=70;break}throw h;case 70:return e.finish(67);case 71:return e.finish(64);case 72:for(C=!0,D=!1,M=void 0,e.prev=75,F=u.entries()[Symbol.iterator]();!(C=(O=F.next()).done);C=!0)E=d(O.value,2),T=E[0],P=E[1],j=o[T],P.content&&this.resolveReferencesForItem(j),j.didFinishSyncing();e.next=83;break;case 79:e.prev=79,e.t2=e.catch(75),D=!0,M=e.t2;case 83:e.prev=83,e.prev=84,C||null==F.return||F.return();case 86:if(e.prev=86,!D){e.next=89;break}throw M;case 89:return e.finish(86);case 90:return e.finish(83);case 91:for(L=this.popMissedReferenceStructsForObjects(u),B=!0,R=!1,H=void 0,e.prev=95,N=function(){var e=K.value,t=o.find(function(t){return t.uuid==e.reference_uuid});t&&e.for_item.addItemAsRelationship(t)},U=L[Symbol.iterator]();!(B=(K=U.next()).done);B=!0)N();e.next=104;break;case 100:e.prev=100,e.t3=e.catch(95),R=!0,H=e.t3;case 104:e.prev=104,e.prev=105,B||null==U.return||U.return();case 107:if(e.prev=107,!R){e.next=110;break}throw H;case 110:return e.finish(107);case 111:return e.finish(104);case 112:return e.next=114,this.notifySyncObserversOfModels(c,a,s);case 114:return e.abrupt("return",o);case 115:case"end":return e.stop()}},e,this,[[5,60,64,72],[20,24,28,36],[29,,31,35],[65,,67,71],[75,79,83,91],[84,,86,90],[95,100,104,112],[105,,107,111]])})),function(e){return l.apply(this,arguments)})},{key:"missedReferenceBuildKey",value:function(e,t){return"".concat(e,":").concat(t)}},{key:"popMissedReferenceStructsForObjects",value:function(e){if(!e||0==e.length)return[];for(var t=[],n=[],r=e.map(function(e){return e.uuid}),i=r[0].length,a=0,s=Object.keys(this.missedReferences);a<s.length;a++){var o=s[a];r.includes(o.substring(0,i))&&(t.push(this.missedReferences[o]),n.push(o))}for(var u=0,c=n;u<c.length;u++){var l=c[u];delete this.missedReferences[l]}return t}},{key:"resolveReferencesForItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.errorDecrypting){var n=e.contentObject;if(e.updateLocalRelationships(),n.references){var r=n.references.slice().map(function(e){return e.uuid}),i=this.findItems(r,!0),a=!0,s=!1,o=void 0;try{for(var u,c=i.entries()[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=d(u.value,2),f=l[0],h=l[1];if(h)e.addItemAsRelationship(h),t&&this.setItemDirty(h,!0);else{var p=r[f],y=this.missedReferenceBuildKey(p,e.uuid);if(!this.missedReferences[y]){var v={reference_uuid:p,for_item:e};this.missedReferences[y]=v}}}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}}}}},{key:"notifySyncObserversOfModels",value:(c=m(r.mark(function e(t,n,i){var a,s,o,u,c,l,f,h=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=this.itemSyncObservers.sort(function(e,t){return e.priority<t.priority?-1:1}),s=!0,o=!1,u=void 0,e.prev=4,c=r.mark(function e(){var a,s,o,u,c,l,p,d,y,v;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a=f.value,s=a.types.includes("*")?t:t.filter(function(e){return a.types.includes(e.content_type)}),o=[],u=[],c=!0,l=!1,p=void 0,e.prev=6,d=s[Symbol.iterator]();!(c=(y=d.next()).done);c=!0)(v=y.value).deleted?u.push(v):o.push(v);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),l=!0,p=e.t0;case 14:e.prev=14,e.prev=15,c||null==d.return||d.return();case 17:if(e.prev=17,!l){e.next=20;break}throw p;case 20:return e.finish(17);case 21:return e.finish(14);case 22:if(!(s.length>0)){e.next=25;break}return e.next=25,h._callSyncObserverCallbackWithTimeout(a,s,o,u,n,i);case 25:case"end":return e.stop()}},e,null,[[6,10,14,22],[15,,17,21]])}),l=a[Symbol.iterator]();case 7:if(s=(f=l.next()).done){e.next=12;break}return e.delegateYield(c(),"t0",9);case 9:s=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),o=!0,u=e.t1;case 18:e.prev=18,e.prev=19,s||null==l.return||l.return();case 21:if(e.prev=21,!o){e.next=24;break}throw u;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[4,14,18,26],[19,,21,25]])})),function(e,t,n){return c.apply(this,arguments)})},{key:"_callSyncObserverCallbackWithTimeout",value:(u=m(r.mark(function e(t,n,i,a,s,o){var u=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){u.$timeout(function(){try{t.callback(n,i,a,s,o)}catch(e){console.error("Sync observer exception",e)}finally{e()}})}));case 1:case"end":return e.stop()}},e)})),function(e,t,n,r,i,a){return u.apply(this,arguments)})},{key:"setItemDirty",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;this.setItemsDirty([e],t,n,r,i)}},{key:"setItemsDirty",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,s=!0,o=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){c.value.setDirty(n,r)}}catch(e){o=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(o)throw u}}this.notifySyncObserversOfModels(t,i||e.MappingSourceLocalDirtied,a)}},{key:"createItem",value:function(t){var n=e.ContentTypeClassMapping&&e.ContentTypeClassMapping[t.content_type];return n||(n=P),new n(t)}},{key:"createDuplicateItemFromResponseItem",value:(o=m(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.setDirty){e.next=3;break}return console.error("Attempting to create conflicted copy of non-response item."),e.abrupt("return",null);case 3:return n=JSON.parse(JSON.stringify(t)),e.next=6,SFJS.crypto.generateUUID();case 6:return n.uuid=e.sent,i=this.createItem(n),e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"duplicateItemAndAddAsConflict",value:function(e){return this.duplicateItemWithCustomContentAndAddAsConflict({content:e.content,duplicateOf:e})}},{key:"duplicateItemWithCustomContentAndAddAsConflict",value:function(e){var t=e.content,n=e.duplicateOf,r=this.duplicateItemWithCustomContent({content:t,duplicateOf:n});return this.addDuplicatedItemAsConflict({duplicate:r,duplicateOf:n}),r}},{key:"addDuplicatedItemAsConflict",value:function(e){var t=e.duplicate,n=e.duplicateOf;this.addDuplicatedItem(t,n),t.content.conflict_of=n.uuid}},{key:"duplicateItemWithCustomContent",value:function(e){var t=e.content,n=e.duplicateOf,r=new n.constructor({content:t});return r.created_at=n.created_at,r.content_type||(r.content_type=n.content_type),r}},{key:"duplicateItemAndAdd",value:function(e){var t=this.duplicateItemWithoutAdding(e);return this.addDuplicatedItem(t,e),t}},{key:"duplicateItemWithoutAdding",value:function(e){var t=new e.constructor({content:e.content});return t.created_at=e.created_at,t.content_type||(t.content_type=e.content_type),t}},{key:"addDuplicatedItem",value:function(e,t){this.addItem(e);var n=!0,r=!1,i=void 0;try{for(var a,s=t.referencingObjects[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;o.addItemAsRelationship(e),this.setItemDirty(o,!0)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}this.resolveReferencesForItem(e),this.setItemDirty(e,!0)}},{key:"addItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addItems([e],t)}},{key:"addItems",value:function(e){var t=this;e.forEach(function(e){t.itemsHash[e.uuid]||(t.itemsHash[e.uuid]=e,t.items.push(e))})}},{key:"addItemSyncObserver",value:function(e,t,n){this.addItemSyncObserverWithPriority({id:e,types:t,callback:n,priority:1})}},{key:"addItemSyncObserverWithPriority",value:function(e){var t=e.id,n=e.priority,r=e.types,i=e.callback;Array.isArray(r)||(r=[r]),this.itemSyncObservers.push({id:t,types:r,priority:n,callback:i})}},{key:"removeItemSyncObserver",value:function(e){_.remove(this.itemSyncObservers,_.find(this.itemSyncObservers,{id:e}))}},{key:"getDirtyItems",value:function(){return this.items.filter(function(e){return 1==e.dirty&&!e.dummy&&(!e.errorDecrypting||e.deleted)})}},{key:"clearDirtyItems",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)i.value.setDirty(!1)}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"removeAndDirtyAllRelationshipsForItem",value:function(e){if(!e.errorDecrypting){var t=!0,n=!1,r=void 0;try{for(var i,a=e.content.references[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,o=this.findItem(s.uuid);o&&(e.removeItemAsRelationship(o),o.hasRelationshipWithItem(e)&&(o.removeItemAsRelationship(e),this.setItemDirty(o,!0)))}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}var u=!0,c=!1,l=void 0;try{for(var f,h=e.referencingObjects[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;p.removeItemAsRelationship(e),this.setItemDirty(p,!0)}}catch(e){c=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw l}}e.referencingObjects=[]}},{key:"setAllItemsDirty",value:function(){var e=this.allItems;this.setItemsDirty(e,!0)}},{key:"setItemToBeDeleted",value:function(e){e.deleted=!0,e.dummy||this.setItemDirty(e,!0),this.removeAndDirtyAllRelationshipsForItem(e)}},{key:"removeItemLocally",value:(s=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:_.remove(this.items,{uuid:t.uuid}),delete this.itemsHash[t.uuid],t.isBeingRemovedLocally();case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"allItemsMatchingTypes",value:function(e){return this.allItems.filter(function(t){return(_.includes(e,t.content_type)||_.includes(e,"*"))&&!t.dummy})}},{key:"invalidItems",value:function(){return this.allItems.filter(function(e){return e.errorDecrypting})}},{key:"validItemsForContentType",value:function(e){return this.allItems.filter(function(t){return t.content_type==e&&!t.errorDecrypting})}},{key:"findItem",value:function(e){return this.itemsHash[e]}},{key:"findItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value,c=this.itemsHash[u];(c||t)&&n.push(c)}}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}},{key:"itemsMatchingPredicate",value:function(e){return this.itemsMatchingPredicates([e])}},{key:"itemsMatchingPredicates",value:function(e){return this.filterItemsWithPredicates(this.allItems,e)}},{key:"filterItemsWithPredicates",value:function(e,t){return e.filter(function(e){var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(!e.satisfiesPredicate(o))return!1}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return!0})}},{key:"importItems",value:(a=m(r.mark(function t(n){var i,a,s,o,u,c,l,f,h,p,d,y,v,m,g,b,k,w,x,S,_,I,A,C,D,M,F;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=[],a={},s=!0,o=!1,u=void 0,t.prev=5,c=n[Symbol.iterator]();case 7:if(s=(l=c.next()).done){t.next=18;break}if(f=l.value,h=this.findItem(f.uuid)){t.next=13;break}return a[f.uuid]={},t.abrupt("continue",15);case 13:p=this.duplicateItemWithoutAdding(h),a[f.uuid]={frozenValue:p,itemRef:h};case 15:s=!0,t.next=7;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(5),o=!0,u=t.t0;case 24:t.prev=24,t.prev=25,s||null==c.return||c.return();case 27:if(t.prev=27,!o){t.next=30;break}throw u;case 30:return t.finish(27);case 31:return t.finish(24);case 32:d=!0,y=!1,v=void 0,t.prev=35,m=n[Symbol.iterator]();case 37:if(d=(g=m.next()).done){t.next=52;break}if(b=g.value,k=a[b.uuid],w=k.frozenValue,x=k.itemRef,!w||x.errorDecrypting){t.next=47;break}return t.next=43,this.createDuplicateItemFromResponseItem(b);case 43:S=t.sent,b.deleted||w.isItemContentEqualWith(S)||(this.addDuplicatedItemAsConflict({duplicate:S,duplicateOf:x}),i.push(S)),t.next=49;break;case 47:i.push(b),x&&x.errorDecrypting&&(x.errorDecrypting=!1);case 49:d=!0,t.next=37;break;case 52:t.next=58;break;case 54:t.prev=54,t.t1=t.catch(35),y=!0,v=t.t1;case 58:t.prev=58,t.prev=59,d||null==m.return||m.return();case 61:if(t.prev=61,!y){t.next=64;break}throw v;case 64:return t.finish(61);case 65:return t.finish(58);case 66:return t.next=68,this.mapResponseItemsToLocalModels(i,e.MappingSourceFileImport);case 68:for(_=t.sent,I=!0,A=!1,C=void 0,t.prev=72,D=_[Symbol.iterator]();!(I=(M=D.next()).done);I=!0)F=M.value,this.setItemDirty(F,!0,!1),F.deleted=!1;t.next=80;break;case 76:t.prev=76,t.t2=t.catch(72),A=!0,C=t.t2;case 80:t.prev=80,t.prev=81,I||null==D.return||D.return();case 83:if(t.prev=83,!A){t.next=86;break}throw C;case 86:return t.finish(83);case 87:return t.finish(80);case 88:return t.abrupt("return",_);case 89:case"end":return t.stop()}},t,this,[[5,20,24,32],[25,,27,31],[35,54,58,66],[59,,61,65],[72,76,80,88],[81,,83,87]])})),function(e){return a.apply(this,arguments)})},{key:"getAllItemsJSONData",value:(i=m(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getJSONDataForItems(this.allItems,t,n,i));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"getJSONDataForItems",value:(n=m(r.mark(function e(t,n,i,a){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return new j(e,n,i).paramsForExportFile()})).then(function(e){if(a&&0==e.length)return null;var t={items:e};return n&&(t.auth_params=i),JSON.stringify(t,null,2)}));case 1:case"end":return e.stop()}},e)})),function(e,t,r,i){return n.apply(this,arguments)})},{key:"computeDataIntegrityHash",value:(t=m(r.mark(function e(){var t,n,i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.allNondummyItems.sort(function(e,t){return t.updated_at-e.updated_at}),n=t.map(function(e){return e.updatedAtTimestamp()}),i=n.join(","),e.next=6,SFJS.crypto.sha256(i);case 6:return a=e.sent,e.abrupt("return",a);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error computing data integrity hash",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this,[[0,10]])})),function(){return t.apply(this,arguments)})},{key:"allItems",get:function(){return this.items.slice()}},{key:"allNondummyItems",get:function(){return this.items.filter(function(e){return!e.dummy})}}]),e}();i.SFModelManager=C;var D=function(){function e(t,n,r){g(this,e),this.modelManager=t,this.syncManager=n,this.singletonManager=r,this.loadPrivileges(),e.CredentialAccountPassword="CredentialAccountPassword",e.CredentialLocalPasscode="CredentialLocalPasscode",e.ActionManageExtensions="ActionManageExtensions",e.ActionManageBackups="ActionManageBackups",e.ActionViewProtectedNotes="ActionViewProtectedNotes",e.ActionManagePrivileges="ActionManagePrivileges",e.ActionManagePasscode="ActionManagePasscode",e.ActionDeleteNote="ActionDeleteNote",e.SessionExpiresAtKey="SessionExpiresAtKey",e.SessionLengthKey="SessionLengthKey",e.SessionLengthNone=0,e.SessionLengthFiveMinutes=300,e.SessionLengthOneHour=3600,e.SessionLengthOneWeek=604800,this.availableActions=[e.ActionViewProtectedNotes,e.ActionDeleteNote,e.ActionManagePasscode,e.ActionManageBackups,e.ActionManageExtensions,e.ActionManagePrivileges],this.availableCredentials=[e.CredentialAccountPassword,e.CredentialLocalPasscode],this.sessionLengths=[e.SessionLengthNone,e.SessionLengthFiveMinutes,e.SessionLengthOneHour,e.SessionLengthOneWeek,e.SessionLengthIndefinite]}var t,n,i,a,s,o,u,c,l,f,h,p;return k(e,[{key:"setDelegate",value:function(e){this.delegate=e}},{key:"getAvailableActions",value:function(){return this.availableActions}},{key:"getAvailableCredentials",value:function(){return this.availableCredentials}},{key:"netCredentialsForAction",value:(p=m(r.mark(function t(n){var i,a,s,o,u,c,l,f;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPrivileges();case 2:t.t0=n,i=t.sent.getCredentialsForAction(t.t0),a=[],s=!0,o=!1,u=void 0,t.prev=8,c=i[Symbol.iterator]();case 10:if(s=(l=c.next()).done){t.next=27;break}if((f=l.value)!=e.CredentialAccountPassword){t.next=19;break}return t.next=15,this.delegate.isOffline();case 15:t.sent||a.push(f),t.next=24;break;case 19:if(f!=e.CredentialLocalPasscode){t.next=24;break}return t.next=22,this.delegate.hasLocalPasscode();case 22:t.sent&&a.push(f);case 24:s=!0,t.next=10;break;case 27:t.next=33;break;case 29:t.prev=29,t.t1=t.catch(8),o=!0,u=t.t1;case 33:t.prev=33,t.prev=34,s||null==c.return||c.return();case 36:if(t.prev=36,!o){t.next=39;break}throw u;case 39:return t.finish(36);case 40:return t.finish(33);case 41:return t.abrupt("return",a);case 42:case"end":return t.stop()}},t,this,[[8,29,33,41],[34,,36,40]])})),function(e){return p.apply(this,arguments)})},{key:"loadPrivileges",value:(h=m(r.mark(function e(){var t=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadPromise){e.next=2;break}return e.abrupt("return",this.loadPromise);case 2:return this.loadPromise=new Promise(function(e,n){var i=B.contentType(),a=new L("content_type","=",i);t.singletonManager.registerSingleton([a],function(n){t.privileges=n,e(n)},function(){var n=m(r.mark(function n(a){var s;return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s=new B({content_type:i}),SFJS.crypto.generateUUIDSync){n.next=4;break}return n.next=4,s.initUUID();case 4:t.modelManager.addItem(s),t.modelManager.setItemDirty(s,!0),t.syncManager.sync(),a(s),e(s);case 9:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())}),e.abrupt("return",this.loadPromise);case 4:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"getPrivileges",value:(f=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.privileges){e.next=4;break}return e.abrupt("return",this.privileges);case 4:return e.abrupt("return",this.loadPrivileges());case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"displayInfoForCredential",value:function(t){var n={};return n[e.CredentialAccountPassword]={label:"Account Password",prompt:"Please enter your account password."},n[e.CredentialLocalPasscode]={label:"Local Passcode",prompt:"Please enter your local passcode."},n[t]}},{key:"displayInfoForAction",value:function(t){var n={};return n[e.ActionManageExtensions]={label:"Manage Extensions"},n[e.ActionManageBackups]={label:"Download/Import Backups"},n[e.ActionViewProtectedNotes]={label:"View Protected Notes"},n[e.ActionManagePrivileges]={label:"Manage Privileges"},n[e.ActionManagePasscode]={label:"Manage Passcode"},n[e.ActionDeleteNote]={label:"Delete Notes"},n[t]}},{key:"getSessionLengthOptions",value:function(){return[{value:e.SessionLengthNone,label:"Don't Remember"},{value:e.SessionLengthFiveMinutes,label:"5 Minutes"},{value:e.SessionLengthOneHour,label:"1 Hour"},{value:e.SessionLengthOneWeek,label:"1 Week"}]}},{key:"setSessionLength",value:(l=m(r.mark(function t(n){var i;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n,a=void 0,(a=new Date).setSeconds(a.getSeconds()+r),i=a,t.abrupt("return",Promise.all([this.delegate.saveToStorage(e.SessionExpiresAtKey,JSON.stringify(i)),this.delegate.saveToStorage(e.SessionLengthKey,JSON.stringify(n))]));case 3:case"end":return t.stop()}var r,a},t,this)})),function(e){return l.apply(this,arguments)})},{key:"clearSession",value:(c=m(r.mark(function t(){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.setSessionLength(e.SessionLengthNone));case 1:case"end":return t.stop()}},t,this)})),function(){return c.apply(this,arguments)})},{key:"getSelectedSessionLength",value:(u=m(r.mark(function t(){var n;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionLengthKey);case 2:if(!(n=t.sent)){t.next=7;break}return t.abrupt("return",JSON.parse(n));case 7:return t.abrupt("return",e.SessionLengthNone);case 8:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"getSessionExpirey",value:(o=m(r.mark(function t(){var n;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionExpiresAtKey);case 2:if(!(n=t.sent)){t.next=7;break}return t.abrupt("return",new Date(JSON.parse(n)));case 7:return t.abrupt("return",new Date);case 8:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)})},{key:"actionHasPrivilegesConfigured",value:(s=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"actionRequiresPrivilege",value:(a=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionExpirey();case 2:if(!(e.sent>new Date)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.netCredentialsForAction(t);case 7:return n=e.sent,e.abrupt("return",n.length>0);case 9:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"savePrivileges",value:(i=m(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:t=e.sent,this.modelManager.setItemDirty(t,!0),this.syncManager.sync();case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"authenticateAction",value:(n=m(r.mark(function e(t,n){var i,a,s,o,u,c,l,f,h;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:i=e.sent,a=[],s=[],o=!0,u=!1,c=void 0,e.prev=7,l=i[Symbol.iterator]();case 9:if(o=(f=l.next()).done){e.next=18;break}return h=f.value,e.next=13,this._verifyAuthenticationParameters(h,n[h]);case 13:e.sent?a.push(h):s.push(h);case 15:o=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),u=!0,c=e.t0;case 24:e.prev=24,e.prev=25,o||null==l.return||l.return();case 27:if(e.prev=27,!u){e.next=30;break}throw c;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",{success:0==s.length,successfulCredentials:a,failedCredentials:s});case 33:case"end":return e.stop()}},e,this,[[7,20,24,32],[25,,27,31]])})),function(e,t){return n.apply(this,arguments)})},{key:"_verifyAuthenticationParameters",value:(t=m(r.mark(function t(n,i){var a,s,o=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=function(){var e=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.delegate.verifyAccountPassword(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.delegate.verifyLocalPasscode(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n!=e.CredentialAccountPassword){t.next=6;break}return t.abrupt("return",a(i));case 6:if(n!=e.CredentialLocalPasscode){t.next=8;break}return t.abrupt("return",s(i));case 8:case"end":return t.stop()}},t)})),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFPrivilegesManager=D;var M=function(){function e(t,n,r,i,a){var s=this;g(this,e),this.modelManager=t,this.storageManager=n,this.$timeout=a||setTimeout.bind(window),this.keyRequestHandler=r,this.loadFromDisk().then(function(){s.modelManager.addItemSyncObserver("session-history",i,function(e,t,n,r,i){if(r!==C.MappingSourceLocalDirtied){var a=!0,o=!1,u=void 0;try{for(var c,l=e[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;try{s.addHistoryEntryForItem(f)}catch(e){console.log("Caught exception while trying to add item history entry",e)}}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}})})}var t,n,i,a,s,o,u;return k(e,[{key:"encryptionParams",value:(u=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler());case 1:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"addHistoryEntryForItem",value:function(e){var t=this,n={uuid:e.uuid,content_type:e.content_type,updated_at:e.updated_at,content:e.getContentCopy()},r=this.historySession.addEntryForItem(n);this.autoOptimize&&this.historySession.optimizeHistoryForItem(e),r&&this.diskEnabled&&(this.diskTimeout&&(this.$timeout.hasOwnProperty("cancel")?this.$timeout.cancel(this.diskTimeout):clearTimeout(this.diskTimeout)),this.diskTimeout=this.$timeout(function(){t.saveToDisk()},2e3))}},{key:"historyForItem",value:function(e){return this.historySession.historyForItem(e)}},{key:"clearHistoryForItem",value:(o=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearItemHistory(t),e.abrupt("return",this.saveToDisk());case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"clearAllHistory",value:(s=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearAllHistory(),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 2:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"toggleDiskSaving",value:(a=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled=!this.diskEnabled,!this.diskEnabled){e.next=6;break}this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!0)),this.saveToDisk(),e.next=8;break;case 6:return this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!1)),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 8:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"saveToDisk",value:(i=m(r.mark(function e(){var t,n=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.encryptionParams();case 4:t=e.sent,new j(this.historySession,t.keys,t.auth_params).paramsForSync().then(function(e){n.storageManager.setItem("sessionHistory_revisions",JSON.stringify(e))});case 7:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"loadFromDisk",value:(n=m(r.mark(function e(){var t,n,i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("sessionHistory_persist");case 2:return(t=e.sent)&&(this.diskEnabled=JSON.parse(t)),e.next=6,this.storageManager.getItem("sessionHistory_revisions");case 6:if(!(n=e.sent)){e.next=18;break}return n=JSON.parse(n),e.next=11,this.encryptionParams();case 11:return i=e.sent,e.next=14,SFJS.itemTransformer.decryptItem(n,i.keys);case 14:a=new R(n),this.historySession=a,e.next=19;break;case 18:this.historySession=new R;case 19:return e.next=21,this.storageManager.getItem("sessionHistory_autoOptimize");case 21:s=e.sent,this.autoOptimize=!s||JSON.parse(s);case 23:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"toggleAutoOptimize",value:(t=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!0)):this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!1));case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}();i.SFSessionHistoryManager=M;var F=function(){function e(t,n){var r=this;g(this,e),this.syncManager=n,this.modelManager=t,this.singletonHandlers=[],t.addItemSyncObserverWithPriority({id:"sf-singleton-manager",types:"*",priority:-1,callback:function(e,n,i,a,s){a!==C.MappingSourceLocalDirtied&&r.resolveSingletons(t.allNondummyItems,null,!0)}}),n.addEventHandler(function(e,n){if("local-data-loaded"==e)r.resolveSingletons(t.allNondummyItems,null,!0),r.initialDataLoaded=!0;else if("sync:completed"==e){if(!r.initialDataLoaded)return;r.resolveSingletons(n.retrievedItems,n.savedItems)}}),t.addModelUuidChangeObserver("singleton-manager",function(e,t){var n=!0,i=!1,a=void 0;try{for(var s,o=r.singletonHandlers[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;u.singleton&&L.ItemSatisfiesPredicates(t,u.predicates)&&(u.singleton=null,r.resolveSingletons([t]))}}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}})}return k(e,[{key:"registerSingleton",value:function(e,t,n){this.singletonHandlers.push({predicates:e,resolutionCallback:t,createBlock:n})}},{key:"resolveSingletons",value:function(e,t,n){var r=this;e=e||[],t=t||[];var i=!0,a=!1,s=void 0;try{for(var o,u=function(){var i=o.value,a=i.predicates.slice(),s=r.modelManager.filterItemsWithPredicates(e,a),u=function(){i.createBlock&&(i.pendingCreateBlockCallback=!0,i.createBlock(function(e){i.singleton=e,i.pendingCreateBlockCallback=!1,i.resolutionCallback&&i.resolutionCallback(e)}))},c=r.modelManager.filterItemsWithPredicates(t,a).length;if(s.length>0||c>0){var l=r.modelManager.itemsMatchingPredicates(a);if(l.length>=2){var f=l.sort(function(e,t){return e.errorDecrypting?1:t.errorDecrypting||e.created_at<t.created_at?-1:1}),h=f[0],p=f.slice(1,f.length),d=!0,y=!1,v=void 0;try{for(var m,g=p[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var b=m.value;r.modelManager.setItemToBeDeleted(b)}}catch(e){y=!0,v=e}finally{try{d||null==g.return||g.return()}finally{if(y)throw v}}r.syncManager.sync(),i.singleton=h,i.resolutionCallback&&i.resolutionCallback(h)}else if(1==l.length){var k=l[0];k.errorDecrypting?(r.modelManager.setItemToBeDeleted(k),u()):i.singleton&&i.singleton===k||(i.singleton=k,i.resolutionCallback&&i.resolutionCallback(k))}}else i.singleton||n||i.pendingCreateBlockCallback||u()},c=this.singletonHandlers[Symbol.iterator]();!(i=(o=c.next()).done);i=!0)u()}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}}}]),e}();i.SFSingletonManager=F;var O=function(){function e(){g(this,e)}var t,n,i,a,s,o,u,c,l,f;return k(e,[{key:"setItem",value:(f=m(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e,t){return f.apply(this,arguments)})},{key:"getItem",value:(l=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},{key:"removeItem",value:(c=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)})},{key:"clear",value:(u=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return u.apply(this,arguments)})},{key:"getAllModels",value:(o=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)})},{key:"saveModel",value:(s=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveModels([t]));case 1:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"saveModels",value:(a=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})},{key:"deleteModel",value:(i=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},{key:"clearAllModels",value:(n=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"clearAllData",value:(t=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.clear(),this.clearAllModels()]));case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}();i.SFStorageManager=O;var E,T=function(){function e(t,n,r,i,a){g(this,e),e.KeyRequestLoadLocal="KeyRequestLoadLocal",e.KeyRequestSaveLocal="KeyRequestSaveLocal",e.KeyRequestLoadSaveAccount="KeyRequestLoadSaveAccount",this.httpManager=r,this.modelManager=t,this.storageManager=n,this.$interval=a||setInterval.bind(window),this.$timeout=i||setTimeout.bind(window),this.syncStatus={},this.syncStatusObservers=[],this.eventHandlers=[],this.PerSyncItemUploadLimit=150,this.ServerItemDownloadLimit=150,this.MajorDataChangeThreshold=15,this.MaxDiscordanceBeforeOutOfSync=5,this.syncDiscordance=0,this.outOfSync=!1}var t,n,i,a,s,o,u,c,l,f,h,p,d,y,v,b,w,x,S,A,D,M,F;return k(e,[{key:"handleServerIntegrityHash",value:(F=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!=t.length){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.modelManager.computeDataIntegrityHash();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:if(n===t){e.next=13;break}return this.syncDiscordance++,this.syncDiscordance>=this.MaxDiscordanceBeforeOutOfSync&&(this.outOfSync||(this.outOfSync=!0,this.notifyEvent("enter-out-of-sync"))),e.abrupt("return",!1);case 13:return this.outOfSync&&(this.outOfSync=!1,this.notifyEvent("exit-out-of-sync")),this.syncDiscordance=0,e.abrupt("return",!0);case 16:case"end":return e.stop()}},e,this)})),function(e){return F.apply(this,arguments)})},{key:"isOutOfSync",value:function(){return this.outOfSync}},{key:"getServerURL",value:(M=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("server");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=window._default_sf_server;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}},e,this)})),function(){return M.apply(this,arguments)})},{key:"getSyncURL",value:(D=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getServerURL();case 2:return e.t0=e.sent,e.abrupt("return",e.t0+"/items/sync");case 4:case"end":return e.stop()}},e,this)})),function(){return D.apply(this,arguments)})},{key:"registerSyncStatusObserver",value:function(e){var t={key:new Date,callback:e};return this.syncStatusObservers.push(t),t}},{key:"removeSyncStatusObserver",value:function(e){_.pull(this.syncStatusObservers,e)}},{key:"syncStatusDidChange",value:function(){var e=this;this.syncStatusObservers.forEach(function(t){t.callback(e.syncStatus)})}},{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,s=this.eventHandlers[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(0,a.value)(e,t||{})}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"setKeyRequestHandler",value:function(e){this.keyRequestHandler=e}},{key:"getActiveKeyInfo",value:(A=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"initialDataLoaded",value:function(){return!0===this._initialDataLoaded}},{key:"_sortLocalItems",value:function(e){var t=this;return e.sort(function(e,n){var r=new Date(n.updated_at)-new Date(e.updated_at),i=t.contentTypeLoadPriority,a=0,s=0;return i&&(a=i.indexOf(e.content_type),s=i.indexOf(n.content_type),-1==a&&(a=i.length),-1==s&&(s=i.length)),a==s?r:a<s?-1:1})}},{key:"loadLocalItems",value:(S=m(r.mark(function t(){var n,i,a,s,o,u=this,c=arguments;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(n=c.length>0&&void 0!==c[0]?c[0]:{}).incrementalCallback,a=n.batchSize,!(s=n.options)||!s.simulateHighLatency){t.next=5;break}return o=s.simulatedLatency||1e3,t.next=5,this._awaitSleep(o);case 5:if(!this.loadLocalDataPromise){t.next=7;break}return t.abrupt("return",this.loadLocalDataPromise);case 7:return a||(a=100),this.loadLocalDataPromise=this.storageManager.getAllModels().then(function(t){var n=(t=(t=u._sortLocalItems(t)).filter(function(e){var t=u.modelManager.findItem(e.uuid);return!t||new Date(e.dirtiedDate)>t.dirtiedDate})).length,s=0,o=[],c=function(){var l=m(r.mark(function l(){var f,h;return r.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return f=t.slice(s,s+a),r.next=3,u.handleItemsResponse(f,null,C.MappingSourceLocalRetrieved,e.KeyRequestLoadLocal);case 3:if(h=r.sent,o.push(h),!((s+=f.length)<n)){r.next=10;break}return r.abrupt("return",new Promise(function(e,t){u.$timeout(function(){u.notifyEvent("local-data-incremental-load"),i&&i(s,n),c().then(e)})}));case 10:u._initialDataLoaded=!0,u.notifyEvent("local-data-loaded");case 12:case"end":return r.stop()}},l)}));return function(){return l.apply(this,arguments)}}();return c()}),t.abrupt("return",this.loadLocalDataPromise);case 10:case"end":return t.stop()}},t,this)})),function(){return S.apply(this,arguments)})},{key:"writeItemsToLocalStorage",value:(x=m(r.mark(function t(n,i){var a=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=n.length){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=m(r.mark(function t(s,o){var u,c,l,f,h,p,d,y,v,g;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(u=[],c=[],l=!0,f=!1,h=void 0,t.prev=4,p=n[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)!0!==(y=d.value).deleted||y.dirty?u.push(y):c.push(y);t.next=12;break;case 8:t.prev=8,t.t0=t.catch(4),f=!0,h=t.t0;case 12:t.prev=12,t.prev=13,l||null==p.return||p.return();case 15:if(t.prev=15,!f){t.next=18;break}throw h;case 18:return t.finish(15);case 19:return t.finish(12);case 20:if(!(c.length>0)){t.next=23;break}return t.next=23,Promise.all(c.map(function(){var e=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.storageManager.deleteModel(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 23:return t.next=25,a.getActiveKeyInfo(e.KeyRequestSaveLocal);case 25:if(v=t.sent,!(u.length>0)){t.next=33;break}return t.next=29,Promise.all(u.map(function(){var e=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(t,v.keys,v.auth_params),e.next=3,n.paramsForLocalStorage();case 3:return n=e.sent,i&&delete n.dirty,e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).catch(function(e){return o(e)});case 29:return g=t.sent,t.next=32,a.storageManager.saveModels(g).catch(function(e){console.error("Error writing items",e),a.syncStatus.localError=e,a.syncStatusDidChange(),o()});case 32:a.syncStatus.localError&&(a.syncStatus.localError=null,a.syncStatusDidChange());case 33:s();case 34:case"end":return t.stop()}},t,null,[[4,8,12,20],[13,,15,19]])}));return function(e,n){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t)})),function(e,t){return x.apply(this,arguments)})},{key:"syncOffline",value:(w=m(r.mark(function e(t){var n,i,a,s,o,u=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=!0,i=!1,a=void 0,e.prev=3,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)o.value.updated_at=new Date;e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),i=!0,a=e.t0;case 11:e.prev=11,e.prev=12,n||null==s.return||s.return();case 14:if(e.prev=14,!i){e.next=17;break}throw a;case 17:return e.finish(14);case 18:return e.finish(11);case 19:return e.abrupt("return",this.writeItemsToLocalStorage(t,!0).then(function(e){var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;o.deleted&&u.modelManager.removeItemLocally(o)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return u.modelManager.clearDirtyItems(t),u.modelManager.didSyncModelsOffline(t),u.notifyEvent("sync:completed",{savedItems:t}),{saved_items:t}}));case 20:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18]])})),function(e){return w.apply(this,arguments)})},{key:"markAllItemsDirtyAndSaveOffline",value:(b=m(r.mark(function e(t){var n,i,a,s,o,u,c,l,f,h,p,d,y;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=28;break}n=this.modelManager.allNondummyItems.filter(function(e){return!e.errorDecrypting}).slice(),i=!0,a=!1,s=void 0,e.prev=5,o=n[Symbol.iterator]();case 7:if(i=(u=o.next()).done){e.next=14;break}return c=u.value,e.next=11,this.modelManager.alternateUUIDForItem(c);case 11:i=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,s=e.t0;case 20:e.prev=20,e.prev=21,i||null==o.return||o.return();case 23:if(e.prev=23,!a){e.next=26;break}throw s;case 26:return e.finish(23);case 27:return e.finish(20);case 28:for(l=this.modelManager.allNondummyItems,f=!0,h=!1,p=void 0,e.prev=32,d=l[Symbol.iterator]();!(f=(y=d.next()).done);f=!0)y.value.setDirty(!0);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),h=!0,p=e.t1;case 40:e.prev=40,e.prev=41,f||null==d.return||d.return();case 43:if(e.prev=43,!h){e.next=46;break}throw p;case 46:return e.finish(43);case 47:return e.finish(40);case 48:return e.abrupt("return",this.writeItemsToLocalStorage(l,!1));case 49:case"end":return e.stop()}},e,this,[[5,16,20,28],[21,,23,27],[32,36,40,48],[41,,43,47]])})),function(e){return b.apply(this,arguments)})},{key:"setSyncToken",value:(v=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=t,e.next=3,this.storageManager.setItem("syncToken",t);case 3:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"getSyncToken",value:(y=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._syncToken){e.next=4;break}return e.next=3,this.storageManager.getItem("syncToken");case 3:this._syncToken=e.sent;case 4:return e.abrupt("return",this._syncToken);case 5:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"setCursorToken",value:(d=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken=t,!t){e.next=6;break}return e.next=4,this.storageManager.setItem("cursorToken",t);case 4:e.next=8;break;case 6:return e.next=8,this.storageManager.removeItem("cursorToken");case 8:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"getCursorToken",value:(p=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken){e.next=4;break}return e.next=3,this.storageManager.getItem("cursorToken");case 3:this._cursorToken=e.sent;case 4:return e.abrupt("return",this._cursorToken);case 5:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"clearQueuedCallbacks",value:function(){this._queuedCallbacks=[]}},{key:"callQueuedCallbacks",value:function(e){var t=this.queuedCallbacks;if(t.length){var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(0,a.value)(e)}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}this.clearQueuedCallbacks()}}},{key:"beginCheckingIfSyncIsTakingTooLong",value:function(){this.syncStatus.checker&&this.stopCheckingIfSyncIsTakingTooLong(),this.syncStatus.checker=this.$interval(function(){(new Date-this.syncStatus.syncStart)/1e3>5&&(this.notifyEvent("sync:taking-too-long"),this.stopCheckingIfSyncIsTakingTooLong())}.bind(this),500)}},{key:"stopCheckingIfSyncIsTakingTooLong",value:function(){this.$interval.hasOwnProperty("cancel")?this.$interval.cancel(this.syncStatus.checker):clearInterval(this.syncStatus.checker),this.syncStatus.checker=null}},{key:"lockSyncing",value:function(){this.syncLocked=!0}},{key:"unlockSyncing",value:function(){this.syncLocked=!1}},{key:"sync",value:(h=m(r.mark(function t(){var n,i=this,a=arguments;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>0&&void 0!==a[0]?a[0]:{},!this.syncLocked){t.next=4;break}return console.log("Sync Locked, Returning;"),t.abrupt("return");case 4:return t.abrupt("return",new Promise(function(){var t=m(r.mark(function t(a,s){var o,u,c,l,f,h,p,d,y,v,m,g,b,k;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n||(n={}),o=i.modelManager.getDirtyItems(),u=o.filter(function(e){return!i.lastDirtyItemsSave||e.dirtiedDate>i.lastDirtyItemsSave}),t.next=5,i.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 5:if(c=t.sent,l=i.syncStatus.syncOpInProgress,f=i.initialDataLoaded(),!l&&f){t.next=16;break}return i.performSyncAgainOnCompletion=!0,i.lastDirtyItemsSave=new Date,t.next=13,i.writeItemsToLocalStorage(u,!1);case 13:return l&&(i.queuedCallbacks.push(a),i.loggingEnabled&&console.warn("Attempting to sync while existing sync is in progress.")),f||(i.loggingEnabled&&console.warn("(1) Attempting to perform online sync before local data has loaded"),a()),t.abrupt("return");case 16:if(i.syncStatus.syncOpInProgress=!0,!c.offline){t.next=19;break}return t.abrupt("return",i.syncOffline(o).then(function(e){i.syncStatus.syncOpInProgress=!1,a(e)}).catch(function(e){i.notifyEvent("sync-exception",e)}));case 19:if(i.initialDataLoaded()){t.next=22;break}return console.error("Attempting to perform online sync before local data has loaded"),t.abrupt("return");case 22:return i.loggingEnabled&&console.log("Syncing online user."),h=i.syncStatus.needsMoreSync,i.syncStatus.syncStart=new Date,i.beginCheckingIfSyncIsTakingTooLong(),p=i.PerSyncItemUploadLimit,(d=o.slice(0,p)).length<o.length?i.syncStatus.needsMoreSync=!0:i.syncStatus.needsMoreSync=!1,h||(i.syncStatus.total=o.length,i.syncStatus.current=0),i.syncStatus.current>i.syncStatus.total&&(i.syncStatus.total=i.syncStatus.current),i.syncStatusDidChange(),t.next=34,i.writeItemsToLocalStorage(u,!1);case 34:return i.lastDirtyItemsSave=new Date,n.onPreSyncSave&&n.onPreSyncSave(),i.allRetreivedItems||(i.allRetreivedItems=[]),i.allSavedItems||(i.allSavedItems=[]),(y={}).limit=i.ServerItemDownloadLimit,n.performIntegrityCheck&&(y.compute_integrity=!0),t.prev=41,t.next=44,Promise.all(d.map(function(e){var t=new j(e,c.keys,c.auth_params);return t.additionalFields=n.additionalFields,t.paramsForSync()})).then(function(e){y.items=e});case 44:t.next=49;break;case 46:t.prev=46,t.t0=t.catch(41),i.notifyEvent("sync-exception",t.t0);case 49:for(v=!0,m=!1,g=void 0,t.prev=52,b=d[Symbol.iterator]();!(v=(k=b.next()).done);v=!0)k.value.dirtyCount=0;t.next=60;break;case 56:t.prev=56,t.t1=t.catch(52),m=!0,g=t.t1;case 60:t.prev=60,t.prev=61,v||null==b.return||b.return();case 63:if(t.prev=63,!m){t.next=66;break}throw g;case 66:return t.finish(63);case 67:return t.finish(60);case 68:return t.next=70,i.getSyncToken();case 70:return y.sync_token=t.sent,t.next=73,i.getCursorToken();case 73:return y.cursor_token=t.sent,y.api=I.getApiVersion(),i.loggingEnabled&&console.log("Syncing with params",y),t.prev=76,t.t2=i.httpManager,t.next=80,i.getSyncURL();case 80:t.t3=t.sent,t.t4=y,t.t5=function(e){i.handleSyncSuccess(d,e,n).then(function(){a(e)}).catch(function(e){console.log("Caught sync success exception:",e),i.handleSyncError(e,null,o).then(function(t){i.notifyEvent("sync-exception",e),a(t)})})},t.t6=function(e,t){i.handleSyncError(e,t,o).then(function(e){a(e)})},t.t2.postAuthenticatedAbsolute.call(t.t2,t.t3,t.t4,t.t5,t.t6),t.next=90;break;case 87:t.prev=87,t.t7=t.catch(76),console.log("Sync exception caught:",t.t7);case 90:case"end":return t.stop()}},t,null,[[41,46],[52,56,60,68],[61,,63,67],[76,87]])}));return function(e,n){return t.apply(this,arguments)}}()));case 5:case"end":return t.stop()}},t,this)})),function(){return h.apply(this,arguments)})},{key:"_awaitSleep",value:(f=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Simulating high latency sync request",t),e.abrupt("return",new Promise(function(e,n){setTimeout(function(){e()},t)}));case 2:case"end":return e.stop()}},e)})),function(e){return f.apply(this,arguments)})},{key:"handleSyncSuccess",value:(l=m(r.mark(function t(n,i,a){var s,o,u,c,l,f,h,p,d,y,v,m,g,b,k,w,x=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.simulateHighLatency){t.next=4;break}return s=a.simulatedLatency||1e3,t.next=4,this._awaitSleep(s);case 4:for(this.syncStatus.error=null,this.loggingEnabled&&console.log("Sync response",i),o=this.allSavedItems.map(function(e){return e.uuid}),u=i.saved_items.map(function(e){return e.uuid}),i.retrieved_items=i.retrieved_items.filter(function(e){var t=o.includes(e.uuid),n=u.includes(e.uuid);if(t||n)return!1;var r=x.modelManager.findItem(e.uuid);return!r||!r.dirty}),c=[],l=!0,f=!1,h=void 0,t.prev=13,p=n[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)0==(y=d.value).dirtyCount&&c.push(y);t.next=21;break;case 17:t.prev=17,t.t0=t.catch(13),f=!0,h=t.t0;case 21:t.prev=21,t.prev=22,l||null==p.return||p.return();case 24:if(t.prev=24,!f){t.next=27;break}throw h;case 27:return t.finish(24);case 28:return t.finish(21);case 29:return this.modelManager.clearDirtyItems(c),t.next=32,this.handleItemsResponse(i.retrieved_items,null,C.MappingSourceRemoteRetrieved,e.KeyRequestLoadSaveAccount);case 32:return v=t.sent,this.allRetreivedItems=this.allRetreivedItems.concat(v),this.syncStatus.retrievedCount=this.allRetreivedItems.length,m=["content","auth_hash"],t.next=38,this.handleItemsResponse(i.saved_items,m,C.MappingSourceRemoteSaved,e.KeyRequestLoadSaveAccount);case 38:return g=t.sent,this.allSavedItems=this.allSavedItems.concat(g),b=i.unsaved,t.next=43,this.deprecated_handleUnsavedItemsResponse(b);case 43:return t.next=45,this.handleConflictsResponse(i.conflicts);case 45:if(k=t.sent,w=k&&k.length>0,!k){t.next=50;break}return t.next=50,this.writeItemsToLocalStorage(k,!1);case 50:return t.next=52,this.writeItemsToLocalStorage(g,!1);case 52:return t.next=54,this.writeItemsToLocalStorage(v,!1);case 54:if(!i.integrity_hash||i.cursor_token){t.next=59;break}return t.next=57,this.handleServerIntegrityHash(i.integrity_hash);case 57:t.sent||this.syncDiscordance<this.MaxDiscordanceBeforeOutOfSync&&(this.performSyncAgainOnCompletion=!0);case 59:return this.syncStatus.syncOpInProgress=!1,this.syncStatus.current+=n.length,this.syncStatusDidChange(),this.setSyncToken(i.sync_token),this.setCursorToken(i.cursor_token),this.stopCheckingIfSyncIsTakingTooLong(),t.next=67,this.getCursorToken();case 67:if(!t.sent&&!this.syncStatus.needsMoreSync){t.next=72;break}return t.abrupt("return",new Promise(function(e,t){setTimeout(function(){this.sync(a).then(e)}.bind(x),10)}));case 72:if(!w){t.next=77;break}return this.performSyncAgainOnCompletion=!1,t.abrupt("return",new Promise(function(e,t){setTimeout(function(){x.sync(a).then(e)},10)}));case 77:return this.syncStatus.retrievedCount=0,this.syncStatus.current=0,this.syncStatus.total=0,this.syncStatusDidChange(),(this.allRetreivedItems.length>=this.majorDataChangeThreshold||g.length>=this.majorDataChangeThreshold||b&&b.length>=this.majorDataChangeThreshold||k&&k.length>=this.majorDataChangeThreshold)&&this.notifyEvent("major-data-change"),this.callQueuedCallbacks(i),this.notifyEvent("sync:completed",{retrievedItems:this.allRetreivedItems,savedItems:this.allSavedItems}),this.allRetreivedItems=[],this.allSavedItems=[],this.performSyncAgainOnCompletion&&(this.performSyncAgainOnCompletion=!1,setTimeout(function(){x.sync(a)},10)),t.abrupt("return",i);case 88:case"end":return t.stop()}},t,this,[[13,17,21,29],[22,,24,28]])})),function(e,t,n){return l.apply(this,arguments)})},{key:"handleSyncError",value:(c=m(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sync error: ",t),401==n&&this.notifyEvent("sync-session-invalid"),t?"string"==typeof t&&(t={error:{message:t}}):t={error:{message:"Could not connect to server."}},this.syncStatus.syncOpInProgress=!1,this.syncStatus.error=t.error,this.syncStatusDidChange(),this.writeItemsToLocalStorage(i,!1),this.modelManager.didSyncModelsOffline(i),this.stopCheckingIfSyncIsTakingTooLong(),this.notifyEvent("sync:error",t.error),this.callQueuedCallbacks({error:"Sync error"}),e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)})),function(e,t,n){return c.apply(this,arguments)})},{key:"handleItemsResponse",value:(u=m(r.mark(function e(t,n,i,a){var s,o,u;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getActiveKeyInfo(a);case 2:return s=e.sent.keys,e.next=5,SFJS.itemTransformer.decryptMultipleItems(t,s);case 5:return e.next=7,this.modelManager.mapResponseItemsToLocalModelsOmittingFields(t,n,i);case 7:return o=e.sent,(u=o.filter(function(e){var t=e.errorDecryptingValueChanged;return e.errorDecryptingValueChanged=!1,t})).length>0&&this.writeItemsToLocalStorage(u,!1),e.abrupt("return",o);case 11:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return u.apply(this,arguments)})},{key:"refreshErroredItems",value:(o=m(r.mark(function t(){var n;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=this.modelManager.allNondummyItems.filter(function(e){return 1==e.errorDecrypting})).length>0)){t.next=3;break}return t.abrupt("return",this.handleItemsResponse(n,null,C.MappingSourceLocalRetrieved,e.KeyRequestLoadSaveAccount));case 3:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)})},{key:"handleConflictsResponse",value:(s=m(r.mark(function t(n){var i,a,s,o,u,c,l,f,h,p,d,y,v,m,g,b,k,w,x,S,_,I,A,D,M,F,O,E,T,j,L;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!=n.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Conflicted Items:",n),i={},a=!0,s=!1,o=void 0,t.prev=7,u=n[Symbol.iterator]();case 9:if(a=(c=u.next()).done){t.next=21;break}if(l=c.value,f=l.server_item||l.unsaved_item,h=this.modelManager.findItem(f.uuid)){t.next=16;break}return i[f.uuid]={},t.abrupt("continue",18);case 16:p=h.getContentCopy(),i[f.uuid]={frozenContent:p,itemRef:h};case 18:a=!0,t.next=9;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(7),s=!0,o=t.t0;case 27:t.prev=27,t.prev=28,a||null==u.return||u.return();case 30:if(t.prev=30,!s){t.next=33;break}throw o;case 33:return t.finish(30);case 34:return t.finish(27);case 35:d=[],y=!0,v=!1,m=void 0,t.prev=39,g=n[Symbol.iterator]();case 41:if(y=(b=g.next()).done){t.next=91;break}return k=b.value,w=k.server_item||k.unsaved_item,t.t1=SFJS.itemTransformer,t.t2=[w],t.next=48,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 48:return t.t3=t.sent.keys,t.next=51,t.t1.decryptMultipleItems.call(t.t1,t.t2,t.t3);case 51:if(x=i[w.uuid],S=x.frozenContent,_=x.itemRef){t.next=54;break}return t.abrupt("continue",88);case 54:if(d.push(_),"uuid_conflict"!==k.type){t.next=62;break}return t.next=58,this.modelManager.alternateUUIDForItem(_);case 58:I=t.sent,d.push(I),t.next=88;break;case 62:if("sync_conflict"!==k.type){t.next=86;break}return t.next=65,this.modelManager.createDuplicateItemFromResponseItem(w);case 65:if(A=t.sent,D=this.modelManager.duplicateItemWithCustomContent({content:S,duplicateOf:_}),M=!D.isItemContentEqualWith(A),F=!_.isItemContentEqualWith(A),O=!1,E=!1,T=!1,j=!1,w.deleted||_.deleted?j=!0:M?(new Date-_.client_updated_at)/1e3<20?(T=!0,E=!0):(O=!0,j=!0):F?P.AreItemContentsEqual({leftContent:_.content,rightContent:A.content,keysToIgnore:_.keysToIgnoreWhenCheckingContentEquality().concat(["references"]),appDataKeysToIgnore:_.appDataKeysToIgnoreWhenCheckingContentEquality()})?T=!0:(O=!0,j=!0):j=!0,!O){t.next=79;break}return t.next=77,this.modelManager.duplicateItemWithCustomContentAndAddAsConflict({content:S,duplicateOf:_});case 77:L=t.sent,d.push(L);case 79:if(E&&(this.modelManager.addDuplicatedItemAsConflict({duplicate:A,duplicateOf:_}),d.push(A)),!j){t.next=83;break}return t.next=83,this.modelManager.mapResponseItemsToLocalModelsOmittingFields([w],null,C.MappingSourceRemoteRetrieved);case 83:T&&(_.updated_at=A.updated_at,_.setDirty(!0)),t.next=88;break;case 86:return console.error("Unsupported conflict type",k.type),t.abrupt("continue",88);case 88:y=!0,t.next=41;break;case 91:t.next=97;break;case 93:t.prev=93,t.t4=t.catch(39),v=!0,m=t.t4;case 97:t.prev=97,t.prev=98,y||null==g.return||g.return();case 100:if(t.prev=100,!v){t.next=103;break}throw m;case 103:return t.finish(100);case 104:return t.finish(97);case 105:return t.abrupt("return",d);case 106:case"end":return t.stop()}},t,this,[[7,23,27,35],[28,,30,34],[39,93,97,105],[98,,100,104]])})),function(e){return s.apply(this,arguments)})},{key:"deprecated_handleUnsavedItemsResponse",value:(a=m(r.mark(function t(n){var i,a,s,o,u,c,l,f,h,p;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!=n.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Unsaved Items:",n),i=!0,a=!1,s=void 0,t.prev=6,o=n[Symbol.iterator]();case 8:if(i=(u=o.next()).done){t.next=35;break}return c=u.value,l=c.item,t.t0=SFJS.itemTransformer,t.t1=[l],t.next=15,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 15:return t.t2=t.sent.keys,t.next=18,t.t0.decryptMultipleItems.call(t.t0,t.t1,t.t2);case 18:if(f=this.modelManager.findItem(l.uuid)){t.next=21;break}return t.abrupt("continue",32);case 21:if("uuid_conflict"!==(h=c.error).tag){t.next=27;break}return t.next=25,this.modelManager.alternateUUIDForItem(f);case 25:t.next=32;break;case 27:if("sync_conflict"!==h.tag){t.next=32;break}return t.next=30,this.modelManager.createDuplicateItemFromResponseItem(l);case 30:p=t.sent,l.deleted||f.isItemContentEqualWith(p)||this.modelManager.addDuplicatedItemAsConflict({duplicate:p,duplicateOf:f});case 32:i=!0,t.next=8;break;case 35:t.next=41;break;case 37:t.prev=37,t.t3=t.catch(6),a=!0,s=t.t3;case 41:t.prev=41,t.prev=42,i||null==o.return||o.return();case 44:if(t.prev=44,!a){t.next=47;break}throw s;case 47:return t.finish(44);case 48:return t.finish(41);case 49:case"end":return t.stop()}},t,this,[[6,37,41,49],[42,,44,48]])})),function(e){return a.apply(this,arguments)})},{key:"stateless_downloadAllItems",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(){var i=m(r.mark(function i(a,s){var o;return r.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o={limit:n.limit||500,sync_token:n.syncToken,cursor_token:n.cursorToken,content_type:n.contentType,event:n.event,api:I.getApiVersion()},i.prev=1,i.t0=t.httpManager,i.next=5,t.getSyncURL();case 5:i.t1=i.sent,i.t2=o,i.t3=function(){var i=m(r.mark(function i(s){var o,u;return r.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.retrievedItems||(n.retrievedItems=[]),o=s.retrieved_items,r.next=4,t.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 4:return u=r.sent.keys,r.next=7,SFJS.itemTransformer.decryptMultipleItems(o,u);case 7:n.retrievedItems=n.retrievedItems.concat(o.map(function(e){return t.modelManager.createItem(e)})),n.syncToken=s.sync_token,n.cursorToken=s.cursor_token,n.cursorToken?t.stateless_downloadAllItems(n).then(a):a(n.retrievedItems);case 11:case"end":return r.stop()}},i)}));return function(e){return i.apply(this,arguments)}}(),i.t4=function(e,t){s(e)},i.t0.postAuthenticatedAbsolute.call(i.t0,i.t1,i.t2,i.t3,i.t4),i.next=16;break;case 12:i.prev=12,i.t5=i.catch(1),console.log("Download all items exception caught:",i.t5),s(i.t5);case 16:case"end":return i.stop()}},i,null,[[1,12]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"resolveOutOfSync",value:(i=m(r.mark(function e(){var t=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stateless_downloadAllItems({event:"resolve-out-of-sync"}).then(function(){var e=m(r.mark(function e(n){var i,a,s,o,u,c,l,f;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=!0,s=!1,o=void 0,e.prev=4,u=n[Symbol.iterator]();case 6:if(a=(c=u.next()).done){e.next=18;break}if(l=c.value,!(f=t.modelManager.findItem(l.uuid))){e.next=14;break}if(l.isItemContentEqualWith(f)){e.next=14;break}return e.next=14,t.modelManager.duplicateItemAndAddAsConflict(f);case 14:i.push(l);case 15:a=!0,e.next=6;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(4),s=!0,o=e.t0;case 24:e.prev=24,e.prev=25,a||null==u.return||u.return();case 27:if(e.prev=27,!s){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.next=34,t.modelManager.mapResponseItemsToLocalModelsWithOptions({items:i,source:C.MappingSourceRemoteRetrieved});case 34:return e.next=36,t.writeItemsToLocalStorage(t.modelManager.allNondummyItems);case 36:return e.abrupt("return",t.sync({performIntegrityCheck:!0}));case 37:case"end":return e.stop()}},e,null,[[4,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"handleSignout",value:(n=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.outOfSync=!1,this.loadLocalDataPromise=null,this.performSyncAgainOnCompletion=!1,this.syncStatus.syncOpInProgress=!1,this._queuedCallbacks=[],this.syncStatus={},e.abrupt("return",this.clearSyncToken());case 7:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"clearSyncToken",value:(t=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=null,this._cursorToken=null,e.abrupt("return",this.storageManager.removeItem("syncToken"));case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"__setLocalDataNotLoaded",value:function(){this.loadLocalDataPromise=null,this._initialDataLoaded=!1}},{key:"queuedCallbacks",get:function(){return this._queuedCallbacks||(this._queuedCallbacks=[]),this._queuedCallbacks}}]),e}();i.SFSyncManager=T;var P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g(this,e),this.content={},this.referencingObjects=[],this.updateFromJSON(t),this.uuid||"undefined"!=typeof SFJS&&SFJS.crypto.generateUUIDSync&&(this.uuid=SFJS.crypto.generateUUIDSync()),"object"!==y(this.content)||this.content.references||(this.content.references=[])}var t;return k(e,[{key:"initUUID",value:(t=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uuid){e.next=4;break}return e.next=3,SFJS.crypto.generateUUID();case 3:this.uuid=e.sent;case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"updateFromJSON",value:function(t){if(t){this.deleted=t.deleted,this.uuid=t.uuid,this.enc_item_key=t.enc_item_key,this.auth_hash=t.auth_hash,this.auth_params=t.auth_params;for(var n=0,r=["errorDecrypting","dirty","dirtyCount","dirtiedDate","dummy"];n<r.length;n++){var i=r[n];void 0!==t[i]&&(this[i]=t[i])}if(this.dirtiedDate&&"string"==typeof this.dirtiedDate&&(this.dirtiedDate=new Date(this.dirtiedDate)),this.content_type||(this.content_type=t.content_type),t.errorDecrypting)this.content=t.content;else try{var a="string"==typeof t.content?JSON.parse(t.content):t.content;e.deepMerge(this.contentObject,a)}catch(e){console.log("Error while updating item from json",e)}t.created_at&&(this.created_at=t.created_at),t.updated_at&&(this.updated_at=t.updated_at),this.created_at?this.created_at=new Date(this.created_at):this.created_at=new Date,this.updated_at?this.updated_at=new Date(this.updated_at):this.updated_at=new Date(0),this._client_updated_at=null,t.content?this.mapContentToLocalProperties(this.contentObject):1==t.deleted&&this.handleDeletedContent()}}},{key:"mapContentToLocalProperties",value:function(e){}},{key:"createContentJSONFromProperties",value:function(){var t=this.structureParams();return e.deepMerge(this.contentObject,t),t}},{key:"structureParams",value:function(){return this.getContentCopy()}},{key:"handleDeletedContent",value:function(){}},{key:"setDirty",value:function(e,t){this.dirty=e,this.dirtyCount||(this.dirtyCount=0),e?this.dirtyCount++:this.dirtyCount=0,this.dirtiedDate=new Date,e&&t?this.client_updated_at=new Date:this.hasRawClientUpdatedAtValue()||(this.client_updated_at=new Date(this.updated_at))}},{key:"updateLocalRelationships",value:function(){}},{key:"addItemAsRelationship",value:function(e){if(e.setIsBeingReferencedBy(this),!this.hasRelationshipWithItem(e)){var t=this.content.references||[];t.push({uuid:e.uuid,content_type:e.content_type}),this.content.references=t}}},{key:"removeItemAsRelationship",value:function(e){e.setIsNoLongerBeingReferencedBy(this),this.removeReferenceWithUuid(e.uuid)}},{key:"setIsBeingReferencedBy",value:function(e){_.find(this.referencingObjects,{uuid:e.uuid})||this.referencingObjects.push(e)}},{key:"setIsNoLongerBeingReferencedBy",value:function(e){_.remove(this.referencingObjects,{uuid:e.uuid}),this.hasRelationshipWithItem(e)&&(this.removeReferenceWithUuid(e.uuid),this.setDirty(!0))}},{key:"removeReferenceWithUuid",value:function(e){var t=this.content.references||[];t=t.filter(function(t){return t.uuid!=e}),this.content.references=t}},{key:"hasRelationshipWithItem",value:function(e){return null!=this.content.references.find(function(t){return t.uuid==e.uuid})}},{key:"isBeingRemovedLocally",value:function(){}},{key:"didFinishSyncing",value:function(){}},{key:"informReferencesOfUUIDChange",value:function(e,t){}},{key:"potentialItemOfInterestHasChangedItsUUID",value:function(e,t,n){if(!this.errorDecrypting){var r=!0,i=!1,a=void 0;try{for(var s,o=this.content.references[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;u.uuid==t&&(u.uuid=n,this.setDirty(!0))}}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}}}},{key:"doNotEncrypt",value:function(){return!1}},{key:"setDomainDataItem",value:function(e,t,n){if(n){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var r=this.content.appData[n];r||(r={}),r[e]=t,this.content.appData[n]=r}}else console.error("SFItem.AppDomain needs to be set.")}},{key:"getDomainDataItem",value:function(e,t){if(t){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var n=this.content.appData[t];return n?n[e]:null}}else console.error("SFItem.AppDomain needs to be set.")}},{key:"setAppDataItem",value:function(t,n){this.setDomainDataItem(t,n,e.AppDomain)}},{key:"getAppDataItem",value:function(t){return this.getDomainDataItem(t,e.AppDomain)}},{key:"hasRawClientUpdatedAtValue",value:function(){return null!=this.getAppDataItem("client_updated_at")}},{key:"keysToIgnoreWhenCheckingContentEquality",value:function(){return[]}},{key:"appDataKeysToIgnoreWhenCheckingContentEquality",value:function(){return["client_updated_at"]}},{key:"getContentCopy",value:function(){return JSON.parse(JSON.stringify(this.content))}},{key:"isItemContentEqualWith",value:function(t){return e.AreItemContentsEqual({leftContent:this.content,rightContent:t.content,keysToIgnore:this.keysToIgnoreWhenCheckingContentEquality(),appDataKeysToIgnore:this.appDataKeysToIgnoreWhenCheckingContentEquality()})}},{key:"satisfiesPredicate",value:function(e){return L.ItemSatisfiesPredicate(this,e)}},{key:"createdAtString",value:function(){return this.dateToLocalizedString(this.created_at)}},{key:"updatedAtString",value:function(){return this.dateToLocalizedString(this.client_updated_at)}},{key:"updatedAtTimestamp",value:function(){return this.updated_at.getTime()}},{key:"dateToLocalizedString",value:function(e){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!E){var t=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;E=new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return E.format(e)}return e.toDateString()+" "+e.toLocaleTimeString()}},{key:"contentObject",get:function(){if(this.errorDecrypting)return this.content;if(!this.content)return this.content={},this.content;if(null!==this.content&&"object"===y(this.content))return this.content;try{var e=JSON.parse(this.content);return this.content=e,this.content}catch(e){return console.log("Error parsing json",e,this),this.content={},this.content}}},{key:"pinned",get:function(){return this.getAppDataItem("pinned")}},{key:"archived",get:function(){return this.getAppDataItem("archived")}},{key:"locked",get:function(){return this.getAppDataItem("locked")}},{key:"displayName",get:function(){return"Item"}},{key:"client_updated_at",get:function(){if(!this._client_updated_at){var e=this.getAppDataItem("client_updated_at");this._client_updated_at=e?new Date(e):new Date(this.updated_at)}return this._client_updated_at},set:function(e){this._client_updated_at=e,this.setAppDataItem("client_updated_at",e)}}],[{key:"deepMerge",value:function(e,t){return _.mergeWith(e,t,function(e,t){if(_.isArray(e))return t}),e}},{key:"AreItemContentsEqual",value:function(t){var n=t.leftContent,r=t.rightContent,i=t.keysToIgnore,a=t.appDataKeysToIgnore,s=function(e,t){if(!e)return e;var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)delete e[a.value]}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return e};return(n=JSON.parse(JSON.stringify(n))).appData&&s(n.appData[e.AppDomain],a),n=s(n,i),(r=JSON.parse(JSON.stringify(r))).appData&&s(r.appData[e.AppDomain],a),r=s(r,i),JSON.stringify(n)===JSON.stringify(r)}}]),e}();i.SFItem=P;var j=function(){function e(t,n,r){if(g(this,e),this.item=t,this.keys=n,this.auth_params=r,this.keys&&!this.auth_params)throw"SFItemParams.auth_params must be supplied if supplying keys.";if(this.auth_params&&!this.auth_params.version)throw"SFItemParams.auth_params is missing version"}var t,n,i,a,s;return k(e,[{key:"paramsForExportFile",value:(s=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.forExportFile=!0,!t){e.next=5;break}return e.abrupt("return",this.__params());case 5:return e.next=7,this.__params();case 7:return n=e.sent,e.abrupt("return",_.omit(n,["deleted"]));case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"paramsForExtension",value:(a=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.paramsForExportFile());case 1:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"paramsForLocalStorage",value:(i=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.additionalFields=["dirty","dirtiedDate","errorDecrypting"],this.forExportFile=!0,e.abrupt("return",this.__params());case 3:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"paramsForSync",value:(n=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.__params());case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"__params",value:(t=m(r.mark(function e(){var t,n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={uuid:this.item.uuid,content_type:this.item.content_type,deleted:this.item.deleted,created_at:this.item.created_at,updated_at:this.item.updated_at},this.item.errorDecrypting){e.next=23;break}if(n=this.item.doNotEncrypt()&&!this.forExportFile,!this.keys||n){e.next=11;break}return e.next=6,SFJS.itemTransformer.encryptItem(this.item,this.keys,this.auth_params);case 6:i=e.sent,_.merge(t,i),"001"!==this.auth_params.version&&(t.auth_hash=null),e.next=21;break;case 11:if(!this.forExportFile){e.next=15;break}e.t0=this.item.createContentJSONFromProperties(),e.next=19;break;case 15:return e.next=17,SFJS.crypto.base64(JSON.stringify(this.item.createContentJSONFromProperties()));case 17:e.t1=e.sent,e.t0="000"+e.t1;case 19:t.content=e.t0,this.forExportFile||(t.enc_item_key=null,t.auth_hash=null);case 21:e.next=26;break;case 23:t.content=this.item.content,t.enc_item_key=this.item.enc_item_key,t.auth_hash=this.item.auth_hash;case 26:return this.additionalFields&&_.merge(t,_.pick(this.item,this.additionalFields)),e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}();i.SFItemParams=j;var L=function(){function e(t,n,r){g(this,e),this.keypath=t,this.operator=n,this.value=r,e.IsRecursiveOperator(this.operator)&&(this.value=this.value.map(e.fromArray))}return k(e,null,[{key:"fromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"ObjectSatisfiesPredicate",value:function(t,n){if(Array.isArray(n)&&(n=this.fromArray(n)),e.IsRecursiveOperator(n.operator)){if("and"===n.operator){var r=!0,i=!1,a=void 0;try{for(var s,o=n.value[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(!this.ObjectSatisfiesPredicate(t,u))return!1}}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return!0}if("or"===n.operator){var c=!0,l=!1,f=void 0;try{for(var h,p=n.value[Symbol.iterator]();!(c=(h=p.next()).done);c=!0)if(u=h.value,this.ObjectSatisfiesPredicate(t,u))return!0}catch(e){l=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}return!1}}var d=n.value;"string"==typeof d&&d.includes(".ago")&&(d=this.DateFromString(d));var y=n.keypath.split(".").reduce(function(e,t){return e&&e[t]},t),v=[!1,"",null,void 0,NaN];return null==y?"!="==n.operator?!v.includes(n.value):v.includes(n.value):"="==n.operator?Array.isArray(y)?JSON.stringify(y)==JSON.stringify(d):y==d:"!="==n.operator?Array.isArray(y)?JSON.stringify(y)!=JSON.stringify(d):y!==d:"<"==n.operator?y<d:">"==n.operator?y>d:"<="==n.operator?y<=d:">="==n.operator?y>=d:"startsWith"==n.operator?y.startsWith(d):"in"==n.operator?-1!=d.indexOf(y):"includes"==n.operator?this.resolveIncludesPredicate(y,d):"matches"==n.operator&&new RegExp(d).test(y)}},{key:"resolveIncludesPredicate",value:function(t,n){if("string"==typeof n)return t.includes(n);var r;r=Array.isArray(n)?e.fromArray(n):n;var i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value;if(this.ObjectSatisfiesPredicate(c,r))return!0}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return!1}},{key:"ItemSatisfiesPredicate",value:function(t,n){return Array.isArray(n)&&(n=e.fromArray(n)),this.ObjectSatisfiesPredicate(t,n)}},{key:"ItemSatisfiesPredicates",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(!this.ItemSatisfiesPredicate(e,o))return!1}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return!0}},{key:"DateFromString",value:function(e){var t=e.split("."),n=t[1],r=new Date,i=parseInt(t[0]);return"days"==n?r.setDate(r.getDate()-i):"hours"==n&&r.setHours(r.getHours()-i),r}},{key:"IsRecursiveOperator",value:function(e){return["and","or"].includes(e)}}]),e}();i.SFPredicate=L;var B=function(e){function t(e){var n;return g(this,t),(n=l(this,f(t).call(this,e))).content.desktopPrivileges||(n.content.desktopPrivileges={}),n}return h(t,e),k(t,null,[{key:"contentType",value:function(){return"SN|Privileges"}}]),k(t,[{key:"setCredentialsForAction",value:function(e,t){this.content.desktopPrivileges[e]=t}},{key:"getCredentialsForAction",value:function(e){return this.content.desktopPrivileges[e]||[]}},{key:"toggleCredentialForAction",value:function(e,t){this.isCredentialRequiredForAction(e,t)?this.removeCredentialForAction(e,t):this.addCredentialForAction(e,t)}},{key:"removeCredentialForAction",value:function(e,t){_.pull(this.content.desktopPrivileges[e],t)}},{key:"addCredentialForAction",value:function(e,t){var n=this.getCredentialsForAction(e);n.push(t),this.setCredentialsForAction(e,n)}},{key:"isCredentialRequiredForAction",value:function(e,t){return this.getCredentialsForAction(e).includes(t)}}]),t}(P);i.SFPrivileges=B;var R=function(e){function t(e){var n;return g(this,t),(n=l(this,f(t).call(this,e))).content.itemUUIDToItemHistoryMapping||(n.content.itemUUIDToItemHistoryMapping={}),Object.keys(n.content.itemUUIDToItemHistoryMapping).forEach(function(e){var t=n.content.itemUUIDToItemHistoryMapping[e];n.content.itemUUIDToItemHistoryMapping[e]=new H(t)}),n}return h(t,e),k(t,[{key:"addEntryForItem",value:function(e){return this.historyForItem(e).addHistoryEntryForItem(e)}},{key:"historyForItem",value:function(e){var t=this.content.itemUUIDToItemHistoryMapping[e.uuid];return t||(t=this.content.itemUUIDToItemHistoryMapping[e.uuid]=new H),t}},{key:"clearItemHistory",value:function(e){this.historyForItem(e).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"optimizeHistoryForItem",value:function(e){var n=this.historyForItem(e);n.entries.length>t.LargeItemEntryAmountThreshold&&n.optimize()}}]),t}(P);i.SFHistorySession=R,R.LargeItemEntryAmountThreshold=60;var H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g(this,e),this.entries||(this.entries=[]),t.entries){var n=!0,r=!1,i=void 0;try{for(var a,s=t.entries[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value,u=this.createEntryForItem(o.item);u.setPreviousEntry(this.getLastEntry()),this.entries.push(u)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}}return k(e,[{key:"createEntryForItem",value:function(t){var n=e.HistoryEntryClassMapping&&e.HistoryEntryClassMapping[t.content_type];return n||(n=N),new n(t)}},{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(e){var t=this.createEntryForItem(e),n=this.getLastEntry();if(t.setPreviousEntry(n),!t.isSameAsEntry(n))return this.entries.push(t),t}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var t=this,n=[],r=function(t){return t.deltaSize()>e.LargeEntryDeltaThreshold},i=function(e,i,a){if(a?n.push(e):-1!==(i=n.indexOf(e))&&n.splice(i,1),a&&r(e)&&-1==e.operationVector()){var s=t.entries[i-1];s&&n.push(s)}};this.entries.forEach(function(e,n){if(0==n||n==t.entries.length-1)i(e,n,!0);else{var a=r(e);i(e,n,a)}}),this.entries=this.entries.filter(function(e,t){return-1!==n.indexOf(e)})}}]),e}();i.SFItemHistory=H,H.LargeEntryDeltaThreshold=15;var N=function(){function e(t){g(this,e),this.item=P.deepMerge({},t),this.defaultContentKeyToDiffOn="text",this.textCharDiffLength=0,"string"==typeof this.item.updated_at&&(this.item.updated_at=new Date(this.item.updated_at))}return k(e,[{key:"setPreviousEntry",value:function(e){this.hasPreviousEntry=null!=e,this.item.content[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=e?this.item.content[this.defaultContentKeyToDiffOn].length-e.item.content[this.defaultContentKeyToDiffOn].length:this.item.content[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return null!=this.textCharDiffLength?this.hasPreviousEntry&&0!=this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return null!=this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(e){if(!e)return!1;var t=new P(this.item),n=new P(e.item);return t.isItemContentEqualWith(n)}}]),e}();i.SFItemHistoryEntry=N,S="undefined"!=typeof window?window:void 0!==e?e:null;var U=function(){function e(){g(this,e),this.DefaultPBKDF2Length=768}var t,n,i,a,s,o,u,l,f,h,p,d,y,v,b;return k(e,[{key:"generateUUIDSync",value:function(){var e=S.crypto||S.msCrypto;if(e){var t=new Uint32Array(4);e.getRandomValues(t);var n=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){n++;var r=t[n>>3]>>n%8*4&15;return("x"==e?r:3&r|8).toString(16)})}var r=(new Date).getTime();return S.performance&&"function"==typeof S.performance.now&&(r+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}},{key:"generateUUID",value:(b=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.generateUUIDSync());case 1:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"timingSafeEqual",value:function(e,t){var n=String(e),r=String(t),i=n.length,a=0;i!==r.length&&(r=n,a=1);for(var s=0;s<i;s++)a|=n.charCodeAt(s)^r.charCodeAt(s);return 0===a}},{key:"decryptText",value:(v=m(r.mark(function e(){var t,n,i,a,s,o,u,l,f,h,p,d=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=d.length>0&&void 0!==d[0]?d[0]:{}).ciphertextToAuth,i=t.contentCiphertext,a=t.encryptionKey,s=t.iv,o=t.authHash,u=t.authKey,!(d.length>1?d[1]:void 0)||o){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!o){e.next=12;break}return e.next=8,this.hmac256(n,u);case 8:if(l=e.sent,!1!==this.timingSafeEqual(o,l)){e.next=12;break}return console.error("Auth hash does not match, returning null."),e.abrupt("return",null);case 12:return f=c.enc.Hex.parse(a),h=c.enc.Hex.parse(s||""),p=c.AES.decrypt(i,f,{iv:h,mode:c.mode.CBC,padding:c.pad.Pkcs7}),e.abrupt("return",p.toString(c.enc.Utf8));case 16:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"encryptText",value:(y=m(r.mark(function e(t,n,i){var a,s,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.enc.Hex.parse(n),s=c.enc.Hex.parse(i||""),o=c.AES.encrypt(t,a,{iv:s,mode:c.mode.CBC,padding:c.pad.Pkcs7}),e.abrupt("return",o.toString());case 4:case"end":return e.stop()}},e)})),function(e,t,n){return y.apply(this,arguments)})},{key:"generateRandomKey",value:(d=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.lib.WordArray.random(t/8).toString());case 1:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)})},{key:"generateItemEncryptionKey",value:(p=m(r.mark(function e(){var t,n,i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=512,n=1,e.next=4,this.generateRandomKey(t);case 4:return i=e.sent,e.next=7,this.generateRandomKey(t);case 7:return a=e.sent,e.abrupt("return",this.pbkdf2(a,i,n,t));case 9:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"firstHalfOfKey",value:(h=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(0,t.length/2));case 1:case"end":return e.stop()}},e)})),function(e){return h.apply(this,arguments)})},{key:"secondHalfOfKey",value:(f=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(t.length/2,t.length));case 1:case"end":return e.stop()}},e)})),function(e){return f.apply(this,arguments)})},{key:"base64",value:(l=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})));case 1:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},{key:"base64Decode",value:(u=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.atob(t));case 1:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)})},{key:"sha256",value:(o=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.SHA256(t).toString());case 1:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)})},{key:"hmac256",value:(s=m(r.mark(function e(t,n){var i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.enc.Hex.parse(n),a=c.enc.Utf8.parse(t),s=c.HmacSHA256(a,i).toString(),e.abrupt("return",s);case 4:case"end":return e.stop()}},e)})),function(e,t){return s.apply(this,arguments)})},{key:"generateSalt",value:(a=m(r.mark(function e(t,n,i,a){var s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sha256([t,"SF",n,i,a].join(":"));case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return a.apply(this,arguments)})},{key:"generateSymmetricKeyPair",value:(i=m(r.mark(function e(){var t,n,i,a,s,o,u,c,l,f,h=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=h.length>0&&void 0!==h[0]?h[0]:{}).password,i=t.pw_salt,a=t.pw_cost,e.next=3,this.pbkdf2(n,i,a,this.DefaultPBKDF2Length);case 3:return s=e.sent,o=s.length,u=o/3,c=s.slice(0,u),l=s.slice(u,2*u),f=s.slice(2*u,3*u),e.abrupt("return",[c,l,f]);case 10:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"computeEncryptionKeysForUser",value:(n=m(r.mark(function e(t,n){var i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("003"!=n.version){e.next=9;break}if(n.identifier){e.next=4;break}return console.error("authParams is missing identifier."),e.abrupt("return");case 4:return e.next=6,this.generateSalt(n.identifier,n.version,n.pw_cost,n.pw_nonce);case 6:i=e.sent,e.next=10;break;case 9:i=n.pw_salt;case 10:return e.abrupt("return",this.generateSymmetricKeyPair({password:t,pw_salt:i,pw_cost:n.pw_cost}).then(function(e){return{pw:e[0],mk:e[1],ak:e[2]}}));case 11:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"generateInitialKeysAndAuthParamsForUser",value:(t=m(r.mark(function e(t,n){var i,a,s,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.SFJS.version,a=this.SFJS.defaultPasswordGenerationCost,e.next=4,this.generateRandomKey(256);case 4:return s=e.sent,e.next=7,this.generateSalt(t,i,a,s);case 7:return o=e.sent,e.abrupt("return",this.generateSymmetricKeyPair({password:n,pw_salt:o,pw_cost:a}).then(function(e){var n={pw_nonce:s,pw_cost:a,identifier:t,version:i};return{keys:{pw:e[0],mk:e[1],ak:e[2]},authParams:n}}));case 9:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFAbstractCrypto=U;var K=function(e){function t(){return g(this,t),l(this,f(t).apply(this,arguments))}var n;return h(t,e),k(t,[{key:"pbkdf2",value:(n=m(r.mark(function e(t,n,i,a){var s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={keySize:a/32,hasher:c.algo.SHA512,iterations:i},e.abrupt("return",c.PBKDF2(t,n,s).toString());case 2:case"end":return e.stop()}},e)})),function(e,t,r,i){return n.apply(this,arguments)})}]),t}(U);i.SFCryptoJS=K;var z=(S="undefined"!=typeof window?window:void 0!==e?e:null).crypto?S.crypto.subtle:null,W=function(e){function t(){return g(this,t),l(this,f(t).apply(this,arguments))}var n,i,a,s,o,u,c,p,d,y,v,b,w,x;return h(t,e),k(t,[{key:"pbkdf2",value:(x=m(r.mark(function e(t,n,i,a){var s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webCryptoImportKey(t,"PBKDF2",["deriveBits"]);case 2:if(s=e.sent){e.next=6;break}return console.log("Key is null, unable to continue"),e.abrupt("return",null);case 6:return e.abrupt("return",this.webCryptoDeriveBits(s,n,i,a));case 7:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return x.apply(this,arguments)})},{key:"generateRandomKey",value:(w=m(r.mark(function e(t){var n=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z.generateKey({name:"AES-CBC",length:t},!0,["encrypt","decrypt"]).then(function(e){return z.exportKey("raw",e).then(function(){var e=m(r.mark(function e(t){var i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.arrayBufferToHexString(new Uint8Array(t));case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error exporting key",e)})}).catch(function(e){console.error("Error generating key",e)}));case 2:case"end":return e.stop()}},e)})),function(e){return w.apply(this,arguments)})},{key:"generateItemEncryptionKey",value:(b=m(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.generateRandomKey(256),this.generateRandomKey(256)]).then(function(e){return e.join("")}));case 2:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"encryptText",value:(v=m(r.mark(function e(t,n,i){var a,s,o,u,c,l=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=6;break}return e.next=3,this.hexStringToArrayBuffer(i);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=new ArrayBuffer(16);case 7:return a=e.t0,s={name:"AES-CBC",iv:a},e.next=11,this.hexStringToArrayBuffer(n);case 11:return o=e.sent,e.next=14,this.webCryptoImportKey(o,s.name,["encrypt"]);case 14:return u=e.sent,e.next=17,this.stringToArrayBuffer(t);case 17:return c=e.sent,e.abrupt("return",crypto.subtle.encrypt(s,u,c).then(function(){var e=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.arrayBufferToBase64(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return v.apply(this,arguments)})},{key:"decryptText",value:(y=m(r.mark(function e(){var t,n,i,a,s,o,u,c,l,f,h,p,d,y=this,v=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=v.length>0&&void 0!==v[0]?v[0]:{}).ciphertextToAuth,i=t.contentCiphertext,a=t.encryptionKey,s=t.iv,o=t.authHash,u=t.authKey,!(v.length>1?v[1]:void 0)||o){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!o){e.next=12;break}return e.next=8,this.hmac256(n,u);case 8:if(c=e.sent,!1!==this.timingSafeEqual(o,c)){e.next=12;break}return console.error("Auth hash does not match, returning null. ".concat(o," != ").concat(c)),e.abrupt("return",null);case 12:if(!s){e.next=18;break}return e.next=15,this.hexStringToArrayBuffer(s);case 15:e.t0=e.sent,e.next=19;break;case 18:e.t0=new ArrayBuffer(16);case 19:return l=e.t0,f={name:"AES-CBC",iv:l},e.next=23,this.hexStringToArrayBuffer(a);case 23:return h=e.sent,e.next=26,this.webCryptoImportKey(h,f.name,["decrypt"]);case 26:return p=e.sent,e.next=29,this.base64ToArrayBuffer(i);case 29:return d=e.sent,e.abrupt("return",crypto.subtle.decrypt(f,p,d).then(function(){var e=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.arrayBufferToString(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error decrypting:",e)}));case 31:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"hmac256",value:(d=m(r.mark(function e(t,n){var i,a,s,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hexStringToArrayBuffer(n);case 2:return i=e.sent,e.next=5,this.webCryptoImportKey(i,"HMAC",["sign"],{name:"SHA-256"});case 5:return a=e.sent,e.next=8,this.stringToArrayBuffer(t);case 8:return s=e.sent,e.abrupt("return",crypto.subtle.sign({name:"HMAC"},a,s).then(function(){var e=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.arrayBufferToHexString(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error computing hmac",e)}));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"webCryptoImportKey",value:(p=m(r.mark(function e(t,n,i,a){var s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=6;break}return e.next=3,this.stringToArrayBuffer(t);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=t;case 7:return s=e.t0,e.abrupt("return",z.importKey("raw",s,{name:n,hash:a},!1,i).then(function(e){return e}).catch(function(e){return console.error(e),null}));case 9:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return p.apply(this,arguments)})},{key:"webCryptoDeriveBits",value:(c=m(r.mark(function e(t,n,i,a){var s,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stringToArrayBuffer(n);case 2:return e.t0=e.sent,e.t1=i,e.t2={name:"SHA-512"},s={name:"PBKDF2",salt:e.t0,iterations:e.t1,hash:e.t2},e.abrupt("return",z.deriveBits(s,t,a).then(function(){var e=m(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.arrayBufferToHexString(new Uint8Array(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return console.error(e),null}));case 7:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return c.apply(this,arguments)})},{key:"stringToArrayBuffer",value:(u=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(r)}));case 1:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)})},{key:"arrayBufferToString",value:(o=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsText(r)}));case 1:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)})},{key:"arrayBufferToHexString",value:(s=m(r.mark(function e(t){var n,i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=new Uint8Array(t),i="",s=0;s<n.byteLength;s++)(a=n[s].toString(16)).length<2&&(a="0"+a),i+=a;return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"hexStringToArrayBuffer",value:(a=m(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],i=0;i<t.length;i+=2)n.push(parseInt(t.substr(i,2),16));return e.abrupt("return",new Uint8Array(n));case 2:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})},{key:"base64ToArrayBuffer",value:(i=m(r.mark(function e(t){var n,i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.base64Decode(t);case 2:for(n=e.sent,i=n.length,a=new Uint8Array(i),s=0;s<i;s++)a[s]=n.charCodeAt(s);return e.abrupt("return",a.buffer);case 7:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"arrayBufferToBase64",value:(n=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new Blob([t],{type:"application/octet-binary"}),i=new FileReader;i.onload=function(t){var n=t.target.result;e(n.substr(n.indexOf(",")+1))},i.readAsDataURL(r)}));case 1:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),t}(U);i.SFCryptoWeb=W;var J=function(){function e(t){g(this,e),this.crypto=t}var t,n,i,a;return k(e,[{key:"_private_encryptString",value:(a=m(r.mark(function e(t,n,i,a,s){var o,u,c,l,f,h;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("001"!==s.version){e.next=7;break}return e.next=3,this.crypto.encryptText(t,n,null);case 3:u=e.sent,o=s.version+u,e.next=21;break;case 7:return e.next=9,this.crypto.generateRandomKey(128);case 9:return c=e.sent,e.next=12,this.crypto.encryptText(t,n,c);case 12:return u=e.sent,l=[s.version,a,c,u].join(":"),e.next=16,this.crypto.hmac256(l,i);case 16:return f=e.sent,e.next=19,this.crypto.base64(JSON.stringify(s));case 19:h=e.sent,o=[s.version,f,a,c,u,h].join(":");case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}},e,this)})),function(e,t,n,r,i){return a.apply(this,arguments)})},{key:"encryptItem",value:(i=m(r.mark(function e(t,n,i){var a,s,o,u,c,l;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.next=3,this.crypto.generateItemEncryptionKey();case 3:if(s=e.sent,"001"!==i.version){e.next=10;break}return e.next=7,this.crypto.encryptText(s,n.mk,null);case 7:a.enc_item_key=e.sent,e.next=13;break;case 10:return e.next=12,this._private_encryptString(s,n.mk,n.ak,t.uuid,i);case 12:a.enc_item_key=e.sent;case 13:return e.next=15,this.crypto.firstHalfOfKey(s);case 15:return o=e.sent,e.next=18,this.crypto.secondHalfOfKey(s);case 18:return u=e.sent,e.next=21,this._private_encryptString(JSON.stringify(t.createContentJSONFromProperties()),o,u,t.uuid,i);case 21:if(c=e.sent,"001"!==i.version){e.next=27;break}return e.next=25,this.crypto.hmac256(c,u);case 25:l=e.sent,a.auth_hash=l;case 27:return a.content=c,e.abrupt("return",a);case 29:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"encryptionComponentsFromString",value:function(e,t,n){var r=e.substring(0,3);if("001"===r)return{contentCiphertext:e.substring(3,e.length),encryptionVersion:r,ciphertextToAuth:e,iv:null,authHash:null,encryptionKey:t,authKey:n};var i=e.split(":");return{encryptionVersion:i[0],authHash:i[1],uuid:i[2],iv:i[3],contentCiphertext:i[4],authParams:i[5],ciphertextToAuth:[i[0],i[2],i[3],i[4]].join(":"),encryptionKey:t,authKey:n}}},{key:"decryptItem",value:(n=m(r.mark(function e(t,n){var i,a,s,o,u,c,l,f;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t.content){e.next=2;break}return e.abrupt("return");case 2:if(!t.content.startsWith("000")){e.next=14;break}return e.prev=3,e.t0=JSON,e.next=7,this.crypto.base64Decode(t.content.substring(3,t.content.length));case 7:e.t1=e.sent,t.content=e.t0.parse.call(e.t0,e.t1),e.next=13;break;case 11:e.prev=11,e.t2=e.catch(3);case 13:return e.abrupt("return");case 14:if(t.enc_item_key){e.next=17;break}return console.log("Missing item encryption key, skipping decryption."),e.abrupt("return");case 17:if(i=t.enc_item_key,a=!0,i.startsWith("002")||i.startsWith("003")||(i="001"+i,a=!1),!(s=this.encryptionComponentsFromString(i,n.mk,n.ak)).uuid||s.uuid===t.uuid){e.next=26;break}return console.error("Item key params UUID does not match item UUID"),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 26:return e.next=28,this.crypto.decryptText(s,a);case 28:if(o=e.sent){e.next=34;break}return console.log("Error decrypting item",t),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 34:return e.next=36,this.crypto.firstHalfOfKey(o);case 36:return u=e.sent,e.next=39,this.crypto.secondHalfOfKey(o);case 39:return c=e.sent,l=this.encryptionComponentsFromString(t.content,u,c),e.prev=41,e.t3=JSON,e.next=45,this.crypto.base64Decode(l.authParams);case 45:e.t4=e.sent,t.auth_params=e.t3.parse.call(e.t3,e.t4),e.next=51;break;case 49:e.prev=49,e.t5=e.catch(41);case 51:if(!l.uuid||l.uuid===t.uuid){e.next=55;break}return t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 55:return l.authHash||(l.authHash=t.auth_hash),e.next=58,this.crypto.decryptText(l,!0);case 58:(f=e.sent)?(1==t.errorDecrypting&&(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!1,t.content=f):(t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0);case 60:case"end":return e.stop()}},e,this,[[3,11],[41,49]])})),function(e,t){return n.apply(this,arguments)})},{key:"decryptMultipleItems",value:(t=m(r.mark(function e(t,n,i){var a,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=m(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(1!=t.deleted||null!=t.content){e.next=4;break}return e.abrupt("return");case 4:if(!("string"==typeof t.content||t.content instanceof String)){e.next=19;break}return e.prev=6,e.next=9,s.decryptItem(t,n);case 9:e.next=19;break;case 11:if(e.prev=11,e.t0=e.catch(6),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,!i){e.next=17;break}throw e.t0;case 17:return console.error("Error decrypting item",t,e.t0),e.abrupt("return");case 19:case"end":return e.stop()}},e,null,[[6,11]])}));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",Promise.all(t.map(function(e){return a(e)})));case 2:case"end":return e.stop()}},e)})),function(e,n,r){return t.apply(this,arguments)})}]),e}();i.SFItemTransformer=J,S="undefined"!=typeof window?window:void 0!==e?e:null;var q=function(){function e(t){g(this,e),S&&("undefined"!=typeof document&&document.documentMode||/Edge/.test(navigator.userAgent)||!S.crypto||!S.crypto.subtle?this.crypto=new K:this.crypto=new W),t&&(this.crypto=t),this.itemTransformer=new J(this.crypto),this.crypto.SFJS={version:this.version(),defaultPasswordGenerationCost:this.defaultPasswordGenerationCost()}}return k(e,[{key:"version",value:function(){return"003"}},{key:"supportsPasswordDerivationCost",value:function(e){return!(e>5e3)||this.crypto instanceof W}},{key:"supportedVersions",value:function(){return["001","002","003"]}},{key:"isVersionNewerThanLibraryVersion",value:function(e){var t=this.version();return parseInt(e)>parseInt(t)}},{key:"isProtocolVersionOutdated",value:function(e){var t={"001":Date.parse("2018-01-01"),"002":Date.parse("2020-01-01")}[e];return!!t&&new Date>t}},{key:"costMinimumForVersion",value:function(e){return{"001":3e3,"002":3e3,"003":11e4}[e]}},{key:"defaultPasswordGenerationCost",value:function(){return this.costMinimumForVersion(this.version())}}]),e}();if(i.StandardFile=q,S)try{S.StandardFile=q,S.SFJS=new q,S.SFCryptoWeb=W,S.SFCryptoJS=K,S.SFItemTransformer=J,S.SFModelManager=C,S.SFItem=P,S.SFItemParams=j,S.SFHttpManager=I,S.SFStorageManager=O,S.SFSyncManager=T,S.SFAuthManager=x,S.SFMigrationManager=A,S.SFAlertManager=w,S.SFPredicate=L,S.SFHistorySession=R,S.SFSessionHistoryManager=M,S.SFItemHistory=H,S.SFItemHistoryEntry=N,S.SFPrivilegesManager=D,S.SFPrivileges=B,S.SFSingletonManager=F}catch(e){console.log("Exception while exporting window variables",e)}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}).call(this,n(2))},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=y;var l={},f={};f[a]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(A([])));p&&p!==n&&r.call(p,a)&&(f=p);var d=b.prototype=m.prototype=Object.create(f);g.prototype=d.constructor=b,b.constructor=g,b[o]=g.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(d),e},c.awrap=function(e){return{__await:e}},k(w.prototype),w.prototype[s]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,r){var i=new w(y(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},k(d),d[o]="Generator",d[a]=function(){return this},d.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var o=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function y(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new I(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=x(s,n);if(o){if(o===l)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=v(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,s),a}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function m(){}function g(){}function b(){}function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function w(e){var t;this._invoke=function(n,i){function a(){return new Promise(function(t,a){!function t(n,i,a,s){var o=v(e[n],e,i);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,s)},function(e){t("throw",e,a,s)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},s)}s(o.arg)}(n,i,t,a)})}return t=t?t.then(a,a):a()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=v(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(e,r){var i;(function(){function a(e,t){return e.set(t[0],t[1]),e}function s(e,t){return e.add(t),e}function o(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var s=e[n];t(s,n,e)&&(a[i++]=s)}return a}function u(e,t){return!(null==e||!e.length)&&-1<d(e,t,0)}function c(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function l(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function f(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)n=t(n,e[r],r,e);return n}function h(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function p(e,t,n){var r=e.length;for(n+=-1;++n<r;)if(t(e[n],n,e))return n;return-1}function d(e,t,n){if(t==t)e:{--n;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=p(e,y,n);return e}function y(e){return e!=e}function v(e,t){return e.has(t)}function m(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function g(e){var t=Object;return function(n){return e(t(n))}}function b(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function k(){}function w(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function x(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function S(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new S;++t<n;)this.add(e[t])}function I(e){this.size=(this.__data__=new x(e)).size}function A(e,t){var n,r=wn(e),i=!r&&kn(e),a=!r&&!i&&xn(e),s=!r&&!i&&!a&&Sn(e);if(r=r||i||a||s){i=e.length;for(var o=String,u=-1,c=Array(i);++u<i;)c[u]=o(u);i=c}else i=[];for(n in o=i.length,e)!t&&!_t.call(e,n)||r&&("length"==n||a&&("offset"==n||"parent"==n)||s&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||ue(n,o))||i.push(n);return i}function C(e,t,n){(n===Ve||ke(e[t],n))&&(n!==Ve||t in e)||F(e,t,n)}function D(e,t,n){var r=e[t];_t.call(e,t)&&ke(r,n)&&(n!==Ve||t in e)||F(e,t,n)}function M(e,t){for(var n=e.length;n--;)if(ke(e[n][0],t))return n;return-1}function F(e,t,n){"__proto__"==t&&Ht?Ht(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function O(e,t,n,r,i,a){var s,o=1&t,u=2&t,c=4&t;if(n&&(s=i?n(e,r,i,a):n(e)),s!==Ve)return s;if(!Ie(e))return e;if(r=wn(e)){if(s=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&_t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!o)return $(e,s)}else{var l=yn(e),f="[object Function]"==l||"[object GeneratorFunction]"==l;if(xn(e))return J(e,o);if("[object Object]"==l||"[object Arguments]"==l||f&&!i){if(s=u||f?{}:ae(e),!o)return u?function(e,t){return G(e,dn(e),t)}(e,function(e,t){return e&&G(t,Re(t),e)}(s,e)):function(e,t){return G(e,pn(e),t)}(e,function(e,t){return e&&G(t,Be(t),e)}(s,e))}else{if(!ct[l])return i?e:{};s=se(e,l,O,o)}}if(a||(a=new I),i=a.get(e))return i;a.set(e,s),u=c?u?te:ee:u?Re:Be;var h=r?Ve:u(e);return function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n););}(h||e,function(r,i){h&&(r=e[i=r]),D(s,i,O(r,t,n,i,e,a))}),s}function E(e,t){var n=[];return cn(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function T(e,t){for(var n=0,r=(t=W(t,e)).length;null!=e&&n<r;)e=e[pe(t[n++])];return n&&n==r?e:Ve}function P(e,t,n){return t=t(e),wn(e)?t:l(t,n(e))}function j(e){if(null==e)e=e===Ve?"[object Undefined]":"[object Null]";else if(Rt&&Rt in Object(e)){var t=_t.call(e,Rt),n=e[Rt];try{e[Rt]=Ve;var r=!0}catch(e){}var i=At.call(e);r&&(t?e[Rt]=n:delete e[Rt]),e=i}else e=At.call(e);return e}function L(e){return Ae(e)&&"[object Arguments]"==j(e)}function B(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!Ae(e)&&!Ae(t))t=e!=e&&t!=t;else e:{var a,s,o=wn(e),u=wn(t),c="[object Object]"==(a="[object Arguments]"==(a=o?"[object Array]":yn(e))?"[object Object]":a);if(u="[object Object]"==(s="[object Arguments]"==(s=u?"[object Array]":yn(t))?"[object Object]":s),(s=a==s)&&xn(e)){if(!xn(t)){t=!1;break e}o=!0,c=!1}if(s&&!c)i||(i=new I),t=o||Sn(e)?Y(e,t,n,r,B,i):function(e,t,n,r,i,a,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!a(new Ot(e),new Ot(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return ke(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=m;case"[object Set]":if(o||(o=b),e.size!=t.size&&!(1&r))break;return(n=s.get(e))?n==t:(r|=2,s.set(e,t),t=Y(o(e),o(t),r,i,a,s),s.delete(e),t);case"[object Symbol]":if(sn)return sn.call(e)==sn.call(t)}return!1}(e,t,a,n,r,B,i);else{if(!(1&n)&&(o=c&&_t.call(e,"__wrapped__"),a=u&&_t.call(t,"__wrapped__"),o||a)){e=o?e.value():e,t=a?t.value():t,i||(i=new I),t=B(e,t,n,r,i);break e}if(s)t:if(i||(i=new I),o=1&n,a=ee(e),u=a.length,s=ee(t).length,u==s||o){for(c=u;c--;){var l=a[c];if(!(o?l in t:_t.call(t,l))){t=!1;break t}}if((s=i.get(e))&&i.get(t))t=s==t;else{s=!0,i.set(e,t),i.set(t,e);for(var f=o;++c<u;){var h=e[l=a[c]],p=t[l];if(r)var d=o?r(p,h,l,t,e,i):r(h,p,l,e,t,i);if(d===Ve?h!==p&&!B(h,p,n,r,i):!d){s=!1;break}f||(f="constructor"==l)}s&&!f&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(s=!1),i.delete(e),i.delete(t),t=s}}else t=!1;else t=!1}}return t}function R(e){return"function"==typeof e?e:null==e?Ue:"object"==typeof e?wn(e)?function(e,t){return ce(e)&&t==t&&!Ie(t)?fe(pe(e),t):function(n){var r=je(n,e);return r===Ve&&r===t?Le(n,e):B(t,r,3)}}(e[0],e[1]):function(e){var t=function(e){for(var t=Be(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!Ie(i)]}return t}(e);return 1==t.length&&t[0][2]?fe(t[0][0],t[0][1]):function(n){return n===e||function(e,t){var n=t.length,r=n;if(null==e)return!r;for(e=Object(e);n--;)if((i=t[n])[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1;for(;++n<r;){var i,a=(i=t[n])[0],s=e[a],o=i[1];if(i[2]){if(s===Ve&&!(a in e))return!1}else if(!B(o,s,3,void 0,i=new I))return!1}return!0}(n,t)}}(e):We(e)}function H(e,t){var n=-1,r=we(e)?Array(e.length):[];return cn(e,function(e,i,a){r[++n]=t(e,i,a)}),r}function N(e,t,n,r,i){e!==t&&ln(t,function(a,s){if(Ie(a)){i||(i=new I);var o=i,u=e[s],c=t[s];if(d=o.get(c))C(e,s,d);else{var l=(d=r?r(u,c,s+"",e,t,o):Ve)===Ve;if(l){var f=wn(c),h=!f&&xn(c),p=!f&&!h&&Sn(c),d=c;f||h||p?wn(u)?d=u:xe(u)?d=$(u):h?(l=!1,d=J(c,!0)):p?(l=!1,d=V(c,!0)):d=[]:Ce(c)||kn(c)?(d=u,kn(u)?d=Te(u):(!Ie(u)||n&&Se(u))&&(d=ae(c))):l=!1}l&&(o.set(c,d),N(d,c,n,r,o),o.delete(c)),C(e,s,d)}}else(o=r?r(e[s],a,s+"",e,t,i):Ve)===Ve&&(o=a),C(e,s,o)},Re)}function U(e){return vn(he(e,void 0,Ue),e+"")}function K(e){if("string"==typeof e)return e;if(wn(e))return c(e,K)+"";if(Me(e))return on?on.call(e):"";var t=e+"";return"0"==t&&1/e==-$e?"-0":t}function z(e,t){var n;if(2>(t=W(t,e)).length)n=e;else{var r=0,i=-1,a=-1,s=(n=t).length;for(0>r&&(r=-r>s?0:s+r),0>(i=i>s?s:i)&&(i+=s),s=r>i?0:i-r>>>0,r>>>=0,i=Array(s);++a<s;)i[a]=n[a+r];n=T(e,i)}null==(e=n)||delete e[pe(me(t))]}function W(e,t){return wn(e)?e:ce(e,t)?[e]:mn(Pe(e))}function J(e,t){if(t)return e.slice();var n=e.length;return n=Et?Et(n):new e.constructor(n),e.copy(n),n}function q(e){var t=new e.constructor(e.byteLength);return new Ot(t).set(new Ot(e)),t}function V(e,t){return new e.constructor(t?q(e.buffer):e.buffer,e.byteOffset,e.length)}function $(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function G(e,t,n){var r=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var s=t[i],o=Ve;o===Ve&&(o=e[s]),r?F(n,s,o):D(n,s,o)}return n}function Q(e){return U(function(t,n){var r,i=-1,a=n.length,s=1<a?n[a-1]:Ve,o=2<a?n[2]:Ve;if(s=3<e.length&&"function"==typeof s?(a--,s):Ve,r=o){r=n[0];var u=n[1];if(Ie(o)){var c=typeof u;r=!!("number"==c?we(o)&&ue(u,o.length):"string"==c&&u in o)&&ke(o[u],r)}else r=!1}for(r&&(s=3>a?Ve:s,a=1),t=Object(t);++i<a;)(o=n[i])&&e(t,o,i,s);return t})}function X(e){return Ce(e)?Ve:e}function Y(e,t,n,r,i,a){var s=1&n,o=e.length;if(o!=(u=t.length)&&!(s&&u>o))return!1;if((u=a.get(e))&&a.get(t))return u==t;var u=-1,c=!0,l=2&n?new _:Ve;for(a.set(e,t),a.set(t,e);++u<o;){var f=e[u],p=t[u];if(r)var d=s?r(p,f,u,t,e,a):r(f,p,u,e,t,a);if(d!==Ve){if(d)continue;c=!1;break}if(l){if(!h(t,function(e,t){if(!v(l,t)&&(f===e||i(f,e,n,r,a)))return l.push(t)})){c=!1;break}}else if(f!==p&&!i(f,p,n,r,a)){c=!1;break}}return a.delete(e),a.delete(t),c}function Z(e){return vn(he(e,Ve,ve),e+"")}function ee(e){return P(e,Be,pn)}function te(e){return P(e,Re,dn)}function ne(){var e=(e=k.iteratee||Ke)===Ke?R:e;return arguments.length?e(arguments[0],arguments[1]):e}function re(e,t){var n=e.__data__,r=typeof t;return("string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?n["string"==typeof t?"string":"hash"]:n.map}function ie(e,t){var n=null==e?Ve:e[t];return!Ie(n)||It&&It in n||!(Se(n)?Dt:at).test(de(n))?Ve:n}function ae(e){return"function"!=typeof e.constructor||le(e)?{}:un(Tt(e))}function se(e,t,n,r){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return q(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return t=r?q(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return V(e,r);case"[object Map]":return f(t=r?n(m(e),1):m(e),a,new e.constructor);case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return(t=new e.constructor(e.source,nt.exec(e))).lastIndex=e.lastIndex,t;case"[object Set]":return f(t=r?n(b(e),1):b(e),s,new e.constructor);case"[object Symbol]":return sn?Object(sn.call(e)):{}}}function oe(e){return wn(e)||kn(e)||!!(Bt&&e&&e[Bt])}function ue(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||ot.test(e))&&-1<e&&0==e%1&&e<t}function ce(e,t){if(wn(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Me(e))||Xe.test(e)||!Qe.test(e)||null!=t&&e in Object(t)}function le(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||wt)}function fe(e,t){return function(n){return null!=n&&n[e]===t&&(t!==Ve||e in Object(n))}}function he(e,t,n){return t=Wt(t===Ve?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=Wt(r.length-t,0),s=Array(a);++i<a;)s[i]=r[t+i];for(i=-1,a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}function pe(e){if("string"==typeof e||Me(e))return e;var t=e+"";return"0"==t&&1/e==-$e?"-0":t}function de(e){if(null!=e){try{return St.call(e)}catch(e){}return e+""}return""}function ye(e,t,n){var r=null==e?0:e.length;return r?(0>(n=null==n?0:Oe(n))&&(n=Wt(r+n,0)),p(e,ne(t,3),n)):-1}function ve(e){return null!=e&&e.length?function e(t,n,r,i,a){var s=-1,o=t.length;for(r||(r=oe),a||(a=[]);++s<o;){var u=t[s];0<n&&r(u)?1<n?e(u,n-1,r,i,a):l(a,u):i||(a[a.length]=u)}return a}(e,1):[]}function me(e){var t=null==e?0:e.length;return t?e[t-1]:Ve}function ge(e,t){var n;if(e&&e.length&&t&&t.length){var r=d,i=-1,a=(n=t).length;for(e===n&&(n=$(n));++i<a;)for(var s=0,o=n[i];-1<(s=r(e,o,s,void 0));)e!=e&&Lt.call(e,s,1),Lt.call(e,s,1);n=e}else n=e;return n}function be(e,t){function n(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;return a.has(i)?a.get(i):(r=e.apply(this,r),n.cache=a.set(i,r)||a,r)}if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");return n.cache=new(be.Cache||S),n}function ke(e,t){return e===t||e!=e&&t!=t}function we(e){return null!=e&&_e(e.length)&&!Se(e)}function xe(e){return Ae(e)&&we(e)}function Se(e){return!!Ie(e)&&("[object Function]"==(e=j(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}function _e(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e}function Ie(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ae(e){return null!=e&&"object"==typeof e}function Ce(e){return!(!Ae(e)||"[object Object]"!=j(e))&&(null===(e=Tt(e))||"function"==typeof(e=_t.call(e,"constructor")&&e.constructor)&&e instanceof e&&St.call(e)==Ct)}function De(e){return"string"==typeof e||!wn(e)&&Ae(e)&&"[object String]"==j(e)}function Me(e){return"symbol"==typeof e||Ae(e)&&"[object Symbol]"==j(e)}function Fe(e){return e?(e=Ee(e))===$e||e===-$e?17976931348623157e292*(0>e?-1:1):e==e?e:0:0===e?e:0}function Oe(e){var t=(e=Fe(e))%1;return e==e?t?e-t:e:0}function Ee(e){if("number"==typeof e)return e;if(Me(e))return Ge;if(Ie(e)&&(e=Ie(e="function"==typeof e.valueOf?e.valueOf():e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e.replace(et,"");var t=it.test(e);return t||st.test(e)?ft(e.slice(2),t?2:8):rt.test(e)?Ge:+e}function Te(e){return G(e,Re(e))}function Pe(e){return null==e?"":K(e)}function je(e,t,n){return(e=null==e?Ve:T(e,t))===Ve?n:e}function Le(e,t){var n;if(n=null!=e){for(var r,i=-1,a=(r=W(t,n=e)).length,s=!1;++i<a;){var o=pe(r[i]);if(!(s=null!=n&&null!=n&&o in Object(n)))break;n=n[o]}n=s||++i!=a?s:!!(a=null==n?0:n.length)&&_e(a)&&ue(o,a)&&(wn(n)||kn(n))}return n}function Be(e){if(we(e))e=A(e);else if(le(e)){var t,n=[];for(t in Object(e))_t.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=zt(e);return e}function Re(e){if(we(e))e=A(e,!0);else if(Ie(e)){var t,n=le(e),r=[];for(t in e)("constructor"!=t||!n&&_t.call(e,t))&&r.push(t);e=r}else{if(t=[],null!=e)for(n in Object(e))t.push(n);e=t}return e}function He(e){return null==e?[]:function(e,t){return c(t,function(t){return e[t]})}(e,Be(e))}function Ne(e){return function(){return e}}function Ue(e){return e}function Ke(e){return R("function"==typeof e?e:O(e,1))}function ze(){}function We(e){return ce(e)?function(e){return function(t){return null==t?Ve:t[e]}}(pe(e)):function(e){return function(t){return T(t,e)}}(e)}function Je(){return[]}function qe(){return!1}var Ve,$e=1/0,Ge=NaN,Qe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xe=/^\w*$/,Ye=/^\./,Ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,et=/^\s+|\s+$/g,tt=/\\(\\)?/g,nt=/\w*$/,rt=/^[-+]0x[0-9a-f]+$/i,it=/^0b[01]+$/i,at=/^\[object .+?Constructor\]$/,st=/^0o[0-7]+$/i,ot=/^(?:0|[1-9]\d*)$/,ut={};ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Arguments]"]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object Boolean]"]=ut["[object DataView]"]=ut["[object Date]"]=ut["[object Error]"]=ut["[object Function]"]=ut["[object Map]"]=ut["[object Number]"]=ut["[object Object]"]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object WeakMap]"]=!1;var ct={};ct["[object Arguments]"]=ct["[object Array]"]=ct["[object ArrayBuffer]"]=ct["[object DataView]"]=ct["[object Boolean]"]=ct["[object Date]"]=ct["[object Float32Array]"]=ct["[object Float64Array]"]=ct["[object Int8Array]"]=ct["[object Int16Array]"]=ct["[object Int32Array]"]=ct["[object Map]"]=ct["[object Number]"]=ct["[object Object]"]=ct["[object RegExp]"]=ct["[object Set]"]=ct["[object String]"]=ct["[object Symbol]"]=ct["[object Uint8Array]"]=ct["[object Uint8ClampedArray]"]=ct["[object Uint16Array]"]=ct["[object Uint32Array]"]=!0,ct["[object Error]"]=ct["[object Function]"]=ct["[object WeakMap]"]=!1;var lt,ft=parseInt,ht="object"==typeof e&&e&&e.Object===Object&&e,pt="object"==typeof self&&self&&self.Object===Object&&self,dt=ht||pt||Function("return this")(),yt=t&&!t.nodeType&&t,vt=yt&&"object"==typeof r&&r&&!r.nodeType&&r,mt=vt&&vt.exports===yt,gt=mt&&ht.process;e:{try{lt=gt&&gt.binding&&gt.binding("util");break e}catch(a){}lt=void 0}var bt=lt&&lt.isTypedArray,kt=Array.prototype,wt=Object.prototype,xt=dt["__core-js_shared__"],St=Function.prototype.toString,_t=wt.hasOwnProperty,It=function(){var e=/[^.]+$/.exec(xt&&xt.keys&&xt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),At=wt.toString,Ct=St.call(Object),Dt=RegExp("^"+St.call(_t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mt=mt?dt.Buffer:Ve,Ft=dt.Symbol,Ot=dt.Uint8Array,Et=Mt?Mt.a:Ve,Tt=g(Object.getPrototypeOf),Pt=Object.create,jt=wt.propertyIsEnumerable,Lt=kt.splice,Bt=Ft?Ft.isConcatSpreadable:Ve,Rt=Ft?Ft.toStringTag:Ve,Ht=function(){try{var e=ie(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Nt=Math.floor,Ut=Object.getOwnPropertySymbols,Kt=Mt?Mt.isBuffer:Ve,zt=g(Object.keys),Wt=Math.max,Jt=Math.min,qt=Date.now,Vt=ie(dt,"DataView"),$t=ie(dt,"Map"),Gt=ie(dt,"Promise"),Qt=ie(dt,"Set"),Xt=ie(dt,"WeakMap"),Yt=ie(Object,"create"),Zt=de(Vt),en=de($t),tn=de(Gt),nn=de(Qt),rn=de(Xt),an=Ft?Ft.prototype:Ve,sn=an?an.valueOf:Ve,on=an?an.toString:Ve,un=function(){function e(){}return function(t){return Ie(t)?Pt?Pt(t):(e.prototype=t,t=new e,e.prototype=Ve,t):{}}}();w.prototype.clear=function(){this.__data__=Yt?Yt(null):{},this.size=0},w.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},w.prototype.get=function(e){var t=this.__data__;return Yt?"__lodash_hash_undefined__"===(e=t[e])?Ve:e:_t.call(t,e)?t[e]:Ve},w.prototype.has=function(e){var t=this.__data__;return Yt?t[e]!==Ve:_t.call(t,e)},w.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Yt&&t===Ve?"__lodash_hash_undefined__":t,this},x.prototype.clear=function(){this.__data__=[],this.size=0},x.prototype.delete=function(e){var t=this.__data__;return!(0>(e=M(t,e))||(e==t.length-1?t.pop():Lt.call(t,e,1),--this.size,0))},x.prototype.get=function(e){var t=this.__data__;return 0>(e=M(t,e))?Ve:t[e][1]},x.prototype.has=function(e){return-1<M(this.__data__,e)},x.prototype.set=function(e,t){var n=this.__data__,r=M(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this},S.prototype.clear=function(){this.size=0,this.__data__={hash:new w,map:new($t||x),string:new w}},S.prototype.delete=function(e){return e=re(this,e).delete(e),this.size-=e?1:0,e},S.prototype.get=function(e){return re(this,e).get(e)},S.prototype.has=function(e){return re(this,e).has(e)},S.prototype.set=function(e,t){var n=re(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},_.prototype.add=_.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},_.prototype.has=function(e){return this.__data__.has(e)},I.prototype.clear=function(){this.__data__=new x,this.size=0},I.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},I.prototype.get=function(e){return this.__data__.get(e)},I.prototype.has=function(e){return this.__data__.has(e)},I.prototype.set=function(e,t){var n=this.__data__;if(n instanceof x){var r=n.__data__;if(!$t||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new S(r)}return n.set(e,t),this.size=n.size,this};var cn=function(e,t){if(null==e)return e;if(!we(e))return function(e,t){return e&&ln(e,t,Be)}(e,t);for(var n=e.length,r=-1,i=Object(e);++r<n&&!1!==t(i[r],r,i););return e},ln=function(e,t,n){for(var r=-1,i=Object(e),a=(n=n(e)).length;a--;){var s=n[++r];if(!1===t(i[s],s,i))break}return e},fn=Ht?function(e,t){return Ht(e,"toString",{configurable:!0,enumerable:!1,value:Ne(t),writable:!0})}:Ue,hn=Qt&&1/b(new Qt([,-0]))[1]==$e?function(e){return new Qt(e)}:ze,pn=Ut?function(e){return null==e?[]:(e=Object(e),o(Ut(e),function(t){return jt.call(e,t)}))}:Je,dn=Ut?function(e){for(var t=[];e;)l(t,pn(e)),e=Tt(e);return t}:Je,yn=j;(Vt&&"[object DataView]"!=yn(new Vt(new ArrayBuffer(1)))||$t&&"[object Map]"!=yn(new $t)||Gt&&"[object Promise]"!=yn(Gt.resolve())||Qt&&"[object Set]"!=yn(new Qt)||Xt&&"[object WeakMap]"!=yn(new Xt))&&(yn=function(e){var t=j(e);if(e=(e="[object Object]"==t?e.constructor:Ve)?de(e):"")switch(e){case Zt:return"[object DataView]";case en:return"[object Map]";case tn:return"[object Promise]";case nn:return"[object Set]";case rn:return"[object WeakMap]"}return t});var vn=function(e){var t=0,n=0;return function(){var r=qt(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(Ve,arguments)}}(fn),mn=function(e){var t=(e=be(e,function(e){return 500===t.size&&t.clear(),e})).cache;return e}(function(e){var t=[];return Ye.test(e)&&t.push(""),e.replace(Ze,function(e,n,r,i){t.push(r?i.replace(tt,"$1"):n||e)}),t}),gn=U(ge),bn=function(e){return function(t,n,r){var i=Object(t);if(!we(t)){var a=ne(n,3);t=Be(t),n=function(e){return a(i[e],e,i)}}return-1<(n=e(t,n,r))?i[a?t[n]:n]:Ve}}(ye);be.Cache=S;var kn=L(function(){return arguments}())?L:function(e){return Ae(e)&&_t.call(e,"callee")&&!jt.call(e,"callee")},wn=Array.isArray,xn=Kt||qe,Sn=bt?function(e){return function(t){return e(t)}}(bt):function(e){return Ae(e)&&_e(e.length)&&!!ut[j(e)]},_n=Q(function(e,t,n){N(e,t,n)}),In=Q(function(e,t,n,r){N(e,t,n,r)}),An=Z(function(e,t){var n={};if(null==e)return n;var r=!1;t=c(t,function(t){return t=W(t,e),r||(r=1<t.length),t}),G(e,te(e),n),r&&(n=O(n,7,X));for(var i=t.length;i--;)z(n,t[i]);return n}),Cn=Z(function(e,t){return null==e?{}:function(e,t){return function(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var s=t[r],o=T(e,s);if(n(o,s)){var u=a;if(s=W(s,e),Ie(u))for(var c=-1,l=(s=W(s,u)).length,f=l-1;null!=u&&++c<l;){var h=pe(s[c]),p=o;if(c!=f){var d=u[h];(p=Ve)===Ve&&(p=Ie(d)?d:ue(s[c+1])?[]:{})}D(u,h,p),u=u[h]}}}return a}(e,t,function(t,n){return Le(e,n)})}(e,t)});k.constant=Ne,k.filter=function(e,t){return(wn(e)?o:E)(e,ne(t,3))},k.flatten=ve,k.iteratee=Ke,k.keys=Be,k.keysIn=Re,k.map=function(e,t){return(wn(e)?c:H)(e,ne(t,3))},k.memoize=be,k.merge=_n,k.mergeWith=In,k.omit=An,k.pick=Cn,k.property=We,k.pull=gn,k.pullAll=ge,k.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],a=e.length;for(t=ne(t,3);++r<a;){var s=e[r];t(s,r,e)&&(n.push(s),i.push(r))}for(a=(r=e?i.length:0)-1;r--;)if(s=i[r],r==a||s!==o){var o=s;ue(s)?Lt.call(e,s,1):z(e,s)}return n},k.toPlainObject=Te,k.uniq=function(e){if(e&&e.length)e:{var t=-1,n=u,r=e.length,i=!0,a=[],s=a;if(200<=r){if(n=hn(e)){e=b(n);break e}i=!1,n=v,s=new _}else s=a;t:for(;++t<r;){var o=c=e[t],c=0!==c?c:0;if(i&&o==o){for(var l=s.length;l--;)if(s[l]===o)continue t;a.push(c)}else n(s,o,void 0)||(s!==a&&s.push(o),a.push(c))}e=a}else e=[];return e},k.values=He,k.cloneDeep=function(e){return O(e,5)},k.eq=ke,k.find=bn,k.findIndex=ye,k.get=je,k.hasIn=Le,k.identity=Ue,k.includes=function(e,t,n,r){return e=we(e)?e:He(e),n=n&&!r?Oe(n):0,r=e.length,0>n&&(n=Wt(r+n,0)),De(e)?n<=r&&-1<e.indexOf(t,n):!!r&&-1<d(e,t,n)},k.isArguments=kn,k.isArray=wn,k.isArrayLike=we,k.isArrayLikeObject=xe,k.isBuffer=xn,k.isFunction=Se,k.isLength=_e,k.isObject=Ie,k.isObjectLike=Ae,k.isPlainObject=Ce,k.isString=De,k.isSymbol=Me,k.isTypedArray=Sn,k.last=me,k.stubArray=Je,k.stubFalse=qe,k.noop=ze,k.sortedIndexBy=function(e,t,n){t=(n=ne(n,2))(t);for(var r=0,i=null==e?0:e.length,a=t!=t,s=null===t,o=Me(t),u=t===Ve;r<i;){var c=Nt((r+i)/2),l=n(e[c]),f=l!==Ve,h=null===l,p=l==l,d=Me(l);(a?p:u?p&&f:s?p&&f&&!h:o?p&&f&&!h&&!d:!h&&!d&&l<t)?r=c+1:i=c}return Jt(i,4294967294)},k.toFinite=Fe,k.toInteger=Oe,k.toNumber=Ee,k.toString=Pe,k.VERSION="4.17.4",dt._=k,void 0===(i=function(){return k}.call(t,n,t,r))||(r.exports=i)}).call(this)}).call(this,n(2),n(4)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return N}),n(1),n(3);var i=n(0);function a(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){a(s,r,i,o,u,"next",e)}function u(e){a(s,r,i,o,u,"throw",e)}o(void 0)})}}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.componentManager=t,this.updateObservers=[],this.items=[]}var t,n,a,u,l;return t=e,(n=[{key:"getPlatform",value:function(){return this.componentManager.platform}},{key:"getEnvironment",value:function(){return this.componentManager.environment}},{key:"isMobile",value:function(){return"mobile"==this.getEnvironment()}},{key:"addEventHandler",value:function(e){var t={id:Math.random,callback:e};return this.updateObservers.push(t),t}},{key:"removeUpdateObserver",value:function(e){this.updateObservers.splice(this.updateObservers.indexOf(e),1)}},{key:"notifyObserversOfEvent",value:function(e){var t,n=o(this.updateObservers);try{for(n.s();!(t=n.n()).done;)t.value.callback(e)}catch(e){n.e(e)}finally{n.f()}}},{key:"filterItems",value:function(e){return this.items.filter(function(t){return t.content_type==e})}},{key:"getFileDescriptors",value:function(){return this.filterItems(e.FileDescriptorContentTypeKey)}},{key:"beginStreamingFiles",value:function(){var t=this,n=[e.FileDescriptorContentTypeKey,e.FileSafeCredentialsContentType,e.FileSafeIntegrationContentTypeKey];this.componentManager.streamItems(n,function(e){t.handleStreamItemsMessage(e)})}},{key:"handleStreamItemsMessage",value:(l=s(r.mark(function t(n){var a,s,u,c;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=o(n),t.prev=1,a.s();case 3:if((s=a.n()).done){t.next=15;break}if(u=s.value,!(u=new i.SFItem(u)).deleted){t.next=9;break}return this.removeItemFromItems(u),t.abrupt("continue",13);case 9:if(!u.isMetadataUpdate){t.next=11;break}return t.abrupt("continue",13);case 11:(c=this.indexOfItem(u))>=0?this.items[c]=u:this.items.push(u);case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:this.notifyObserversOfEvent(e.BridgeEventReceivedItems);case 24:case"end":return t.stop()}},t,this,[[1,17,20,23]])})),function(e){return l.apply(this,arguments)})},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter(function(t){return t.uuid!==e.uuid})}},{key:"createItem",value:function(e,t){this.createItems([e],t)}},{key:"createItems",value:function(e,t){this.componentManager.createItems(e,function(e){t&&t(e.map(function(e){return new i.SFItem(e)}))})}},{key:"saveItem",value:(u=s(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveItems([t]));case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"saveItems",value:(a=s(r.mark(function t(n){var i=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,r){i.componentManager.saveItems(n,function(n){t(n),i.notifyObserversOfEvent(e.BridgeEventSavedItem)})}));case 1:case"end":return t.stop()}},t)})),function(e){return a.apply(this,arguments)})},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(e,t){this.componentManager.deleteItems(e,t)}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter(function(t){return t.uuid!==e.uuid})}}])&&c(t.prototype,n),e}();function h(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){h(a,r,i,s,o,"next",e)}function o(e){h(a,r,i,s,o,"throw",e)}s(void 0)})}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}l(f,"FileItemContentTypeKey","SN|FileSafe|File"),l(f,"FileSafeCredentialsContentType","SN|FileSafe|Credentials"),l(f,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata"),l(f,"FileSafeIntegrationContentTypeKey","SN|FileSafe|Integration"),l(f,"BridgeEventLoadedCredentials","BridgeEventLoadedCredentials"),l(f,"BridgeEventReceivedItems","BridgeEventReceivedItems"),l(f,"BridgeEventSavedItem","BridgeEventSavedItem");var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.httpManger=new i.SFHttpManager,this.httpManger.setJWTRequestHandler(function(){})}var t,n,a,s,o;return t=e,(n=[{key:"setCredentials",value:function(e){this.credentials=e}},{key:"uploadFile",value:(o=p(r.mark(function e(t,n,i){var a,s,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(i.content.relayUrl,"/integrations/save-item"),s={file:{name:t,item:n},source:i.content.source,authorization:i.content.authorization},e.abrupt("return",new Promise(function(e,t){o.httpManger.postAbsolute(a,s,function(t){e(t.metadata)},function(e){var n=e.error;n||(n={message:"File upload failed."}),console.log("Upload error response",n),t(n)})}));case 3:case"end":return e.stop()}},e)})),function(e,t,n){return o.apply(this,arguments)})},{key:"downloadFile",value:(s=p(r.mark(function e(t,n){var i,a,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(n.content.relayUrl,"/integrations/download-item"),a={metadata:t.content.serverMetadata,authorization:n.content.authorization},e.abrupt("return",new Promise(function(e,t){s.httpManger.postAbsolute(i,a,function(t){e(t)},function(e){var n=e.error;console.log("Download error response",e),t(n)})}));case 3:case"end":return e.stop()}},e)})),function(e,t){return s.apply(this,arguments)})},{key:"deleteFile",value:(a=p(r.mark(function e(t,n){var i,a,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(n.content.relayUrl,"/integrations/delete-item"),a={metadata:t.content.serverMetadata,authorization:n.content.authorization},e.abrupt("return",new Promise(function(e,t){s.httpManger.postAbsolute(i,a,function(t){e(t)},function(e){var n=e.error;console.log("Download error response",e),t(n)})}));case 3:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)})}])&&d(t.prototype,n),e}();function v(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionBridge=t}var t,n,a,s;return t=e,(n=[{key:"integrationForFileDescriptor",value:function(e){return this.integrations.find(function(t){return e.content.serverMetadata&&t.content.source==e.content.serverMetadata.source})}},{key:"parseIntegrationCode",value:function(e){var t=atob(e),n=JSON.parse(t);return n.rawCode=e,n}},{key:"saveIntegrationFromCode",value:(a=r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseIntegrationCode(t),0==this.integrations.length&&(n.isDefaultUploadSource=!0),i=this.createAndSaveIntegrationObject(n),e.abrupt("return",i);case 4:case"end":return e.stop()}},e,this)}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function s(e){g(i,n,r,s,o,"next",e)}function o(e){g(i,n,r,s,o,"throw",e)}s(void 0)})},function(e){return s.apply(this,arguments)})},{key:"createAndSaveIntegrationObject",value:function(e){var t=new i.SFItem({content_type:f.FileSafeIntegrationContentTypeKey,content:e});return this.extensionBridge.createItems([t]),t}},{key:"getDefaultIntegration",value:function(){return this.integrations.find(function(e){return e.content.isDefaultUploadSource})}},{key:"setIntegrationAsDefault",value:function(e){var t=[e],n=this.getDefaultIntegration();n&&(n.content.isDefaultUploadSource=!1,t.push(n)),e.content.isDefaultUploadSource=!0,this.extensionBridge.saveItems(t)}},{key:"displayStringForIntegration",value:function(e){var t,n,r=e.content.source.split("_"),i="",a=0,s=v(r);try{for(s.s();!(t=s.n()).done;){i+=(n=t.value).charAt(0).toUpperCase()+n.slice(1),a<r.length-1&&(i+=" "),a++}}catch(e){s.e(e)}finally{s.f()}return i}},{key:"deleteIntegration",value:function(e){var t=this,n=e.content.isDefaultUploadSource;this.extensionBridge.deleteItem(e,function(r){if(r.deleted&&n&&t.integrations.length>0){var i,a=v(t.integrations);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s!=e){t.setIntegrationAsDefault(s);break}}}catch(e){a.e(e)}finally{a.f()}}})}},{key:"integrations",get:function(){return this.extensionBridge.filterItems(f.FileSafeIntegrationContentTypeKey)}}])&&b(t.prototype,n),e}();function w(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(){function e(t){var n=this,r=t.extensionBridge,i=t.onCredentialLoad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,"getDefaultCredentials",function(){var e=n.credentials.find(function(e){return e.content.isDefault});return!e&&n.credentials.length>0&&(e=n.credentials[0]),e}),_(this,"setCredentialAsDefault",function(e){var t=n.getDefaultCredentials();t&&(t.content.isDefault=!1),e.content.isDefault=!0,n.extensionBridge.saveItems([t,e])}),_(this,"deleteCredential",function(e){n.extensionBridge.deleteItem(e)}),this.extensionBridge=r,this.onCredentialLoad=i,this.credentials=[],this.extensionBridge.addEventHandler(function(e){e==f.BridgeEventReceivedItems&&n.reloadCredentials()})}var t,n,a,s;return t=e,(n=[{key:"reloadCredentials",value:function(){var e=this;this.credentials=[];var t=this.extensionBridge.filterItems(f.FileSafeCredentialsContentType);if(0!=t.length){var n,r=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}(t);try{var i=function(){var t=n.value;e.credentials.find(function(e){e.uuid,t.uuid})||e.credentials.push(t)};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}this.onCredentialLoad(),this.credentials.length>0&&this.didLoadCredentials()}}},{key:"createNewCredentials",value:(a=r.mark(function e(){var t,n,a,s,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=256,e.next=3,SFJS.crypto.generateRandomKey(t);case 3:return n=e.sent,e.next=6,SFJS.crypto.generateRandomKey(t);case 6:return a=e.sent,e.next=9,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(n,a);case 9:return(s=e.sent).isDefault=0==this.credentials.length,o=new i.SFItem({content_type:f.FileSafeCredentialsContentType,content:s}),this.extensionBridge.saveItem(o),this.didLoadCredentials(),e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function s(e){w(i,n,r,s,o,"next",e)}function o(e){w(i,n,r,s,o,"throw",e)}s(void 0)})},function(){return s.apply(this,arguments)})},{key:"didLoadCredentials",value:function(){this.extensionBridge.notifyObserversOfEvent(f.BridgeEventLoadedCredentials)}},{key:"credentialForFileDescriptor",value:function(e){return this.credentials.find(function(t){return e.content.references.find(function(e){return e.uuid==t.uuid})})}},{key:"getAllCredentials",value:function(){return this.credentials}},{key:"saveCredential",value:function(e){this.extensionBridge.saveItem(e)}}])&&S(t.prototype,n),e}(),A=function(){return new Worker(n.p+"filesafe-js/EncryptionWorker.js")};function C(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function D(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){C(a,r,i,s,o,"next",e)}function o(e){C(a,r,i,s,o,"throw",e)}s(void 0)})}}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionBridge=t,this.relayManager=n,this.integrationManager=r,this.credentialManager=i}var t,n,a,s,o,u,c;return t=e,(n=[{key:"getAllFileDescriptors",value:function(){return this.extensionBridge.getFileDescriptors()}},{key:"fileDescriptorsForNote",value:function(e){return e?this.extensionBridge.getFileDescriptors().filter(function(t){return t.hasRelationshipWithItem(e)}):[]}},{key:"findFileDescriptor",value:function(e){return this.extensionBridge.getFileDescriptors().find(function(t){return t.uuid==e})}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.extensionBridge.getFileDescriptors().filter(function(t){return t.content.references.find(function(t){return t.uuid==e.uuid})})}},{key:"deleteFileFromDescriptor",value:(c=D(r.mark(function e(t){var n=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){n.extensionBridge.deleteItems([t],function(r){if(r.deleted){var i=n.integrationManager.integrationForFileDescriptor(t);i&&n.relayManager.deleteFile(t,i).then(function(t){e()})}else e(r)})}));case 1:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)})},{key:"uploadFile",value:(u=D(r.mark(function e(t){var n,a,s,o,u,c,l,h=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileItem,a=t.inputFileName,s=t.fileType,o=t.credential,u=t.note,c=this.integrationManager.getDefaultIntegration(),a.split(".")[1],l="".concat(n.uuid,".sf.json"),e.abrupt("return",new Promise(function(e,t){var r=new A;r.addEventListener("message",function(n){var r=n.data;if(r.error)return console.log("Error uploading file",r.error),void t(r.error);var c=new i.SFItem({content_type:f.FileDescriptorContentTypeKey,content:{serverMetadata:n.data.metadata,fileName:a,fileType:s}});u&&c.addItemAsRelationship(u),c.addItemAsRelationship(o),h.extensionBridge.createItem(c,function(t){e(t[0])})});var p={outputFileName:l,fileItem:n,integration:c,operation:"upload",credentials:h.credentialManager.getDefaultCredentials()};r.postMessage(p)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"downloadFileFromDescriptor",value:(o=D(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.integrationManager.integrationForFileDescriptor(t)){e.next=6;break}throw(i=t.content.serverMetadata)?alert("Unable to find integration named '".concat(i.source,"'.")):alert("Unable to find integration for this file."),"Unable to find integration";case 6:return e.abrupt("return",this.relayManager.downloadFile(t,n).then(function(e){return e.items[0]}));case 7:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"encryptFile",value:(s=D(r.mark(function e(t){var n,i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.inputFileName,a=t.fileType,s=t.credential,e.abrupt("return",new Promise(function(e,t){var r=new A;r.addEventListener("message",function(t){e(t.data.fileItem)}),r.postMessage({operation:"encrypt",keys:s.content.keys,authParams:s.content.authParams,contentType:f.FileItemContentTypeKey,fileData:n,fileName:i,fileType:a})}));case 2:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"decryptFile",value:(a=D(r.mark(function e(t){var n,i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileDescriptor,i=t.fileItem,(a=t.credential)||(a=this.credentialManager.credentialForFileDescriptor(n)),e.abrupt("return",new Promise(function(e,t){var n=new A;n.addEventListener("message",function(n){var r=n.data;r.error?t(r.error):e(r)}),n.postMessage({operation:"decrypt",keys:a.content.keys,item:i})}));case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})}])&&M(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}F(O,"FileItemContentTypeKey","SN|FileSafe|File"),F(O,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata");var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"base64toBinary",value:function(e){for(var t=atob(e),n=[],r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Uint8Array(n)}},{key:"downloadData",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=document.createElement("a");a.setAttribute("download",t);var s=this.tempUrlForData(e,n);a.href=s,a.setAttribute("target","_blank"),i?window.location.href=a.href:(document.body.appendChild(a),a.click(),a.remove()),setTimeout(function(){r.revokeTempUrl(s)},500)}},{key:"tempUrlForData",value:function(e,t){return window.URL.createObjectURL(new Blob([e],{type:t||"text/json"}))}},{key:"revokeTempUrl",value:function(e){window.URL.revokeObjectURL(e)}},{key:"copyTextToClipboard",value:function(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);var t;if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{(t=document.createElement("textarea")).setAttribute("readonly",!0),t.setAttribute("contenteditable",!0),t.style.position="fixed",t.value=e,document.body.appendChild(t),t.focus(),t.select();var n=document.createRange();n.selectNodeContents(t);var r=window.getSelection();r.removeAllRanges(),r.addRange(n),t.setSelectionRange(0,t.value.length),document.execCommand("copy")}catch(e){console.error(e)}finally{document.body.removeChild(t)}}}],null&&E(t.prototype,null),n&&E(t,n),e}();function P(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){P(a,r,i,s,o,"next",e)}function o(e){P(a,r,i,s,o,"throw",e)}s(void 0)})}}function L(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),e}var N=function(){function e(t){var n=this,r=t.componentManager;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataChangeObservers=[],this.newFileDescriptorHandlers=[],this.extensionBridge=new f(r),this.extensionBridge.addEventHandler(function(e){n.notifyObservers()}),this.relayManager=new y,this.integrationManager=new k(this.extensionBridge),this.credentialManager=new I({extensionBridge:this.extensionBridge,onCredentialLoad:function(){n.relayManager.setCredentials(n.credentialManager.getDefaultCredentials())}}),this.fileManager=new O(this.extensionBridge,this.relayManager,this.integrationManager,this.credentialManager),this.extensionBridge.beginStreamingFiles()}var t,n,a,s,o,u,c,l;return H(e,null,[{key:"getSFItemClass",value:function(){return i.SFItem}}]),H(e,[{key:"addNewFileDescriptorHandler",value:function(e){this.newFileDescriptorHandlers.push(e)}},{key:"notifyObservers",value:function(){var e,t=L(this.dataChangeObservers);try{for(t.s();!(e=t.n()).done;)(0,e.value)()}catch(e){t.e(e)}finally{t.f()}}},{key:"addDataChangeObserver",value:function(e){return this.dataChangeObservers.push(e),e}},{key:"removeDataChangeObserver",value:function(e){this.dataChangeObservers=this.dataChangeObservers.filter(function(e){})}},{key:"setCurrentNote",value:function(e){this.currentNote=e,this.notifyObservers()}},{key:"getAllFileDescriptors",value:function(){return this.fileManager.getAllFileDescriptors()}},{key:"findFileDescriptor",value:function(e){return this.fileManager.findFileDescriptor(e)}},{key:"fileDescriptorsForCurrentNote",value:function(){return this.fileManager.fileDescriptorsForNote(this.currentNote)}},{key:"fileDescriptorsForNote",value:function(e){return this.fileManager.fileDescriptorsForNote(e)}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e)}},{key:"deleteFileFromDescriptor",value:(l=j(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileManager.deleteFileFromDescriptor(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"uploadFile",value:(c=j(r.mark(function e(t){var n,i,a,s,o,u,c,l;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileItem,i=t.inputFileName,a=t.fileType,s=t.credential,(o=t.note)||(o=this.currentNote),e.next=4,this.fileManager.uploadFile({fileItem:n,inputFileName:i,fileType:a,credential:s,note:o});case 4:if(u=e.sent){c=L(this.newFileDescriptorHandlers);try{for(c.s();!(l=c.n()).done;)(0,l.value)(u)}catch(e){c.e(e)}finally{c.f()}}return e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"encryptAndUploadJavaScriptFileObject",value:(u=j(r.mark(function e(t){var n=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,i){var a=new FileReader;a.onload=function(){var i=j(r.mark(function i(a){var s,o,u,c;return r.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s=a.target.result,o=s,r.next=4,SFJS.crypto.arrayBufferToBase64(o);case 4:return u=r.sent,r.next=7,n.encryptAndUploadData({base64Data:u,inputFileName:t.name,fileType:t.type});case 7:c=r.sent,e(c);case 9:case"end":return r.stop()}},i)}));return function(e){return i.apply(this,arguments)}}(),a.readAsArrayBuffer(t)}));case 1:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)})},{key:"encryptAndUploadData",value:(o=j(r.mark(function e(t){var n,i,a,s,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.base64Data,i=t.inputFileName,a=t.fileType,s=this.getDefaultCredentials(),e.abrupt("return",this.encryptFile({data:n,inputFileName:i,fileType:a,credential:s}).then(function(){var e=j(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.uploadFile({fileItem:t,inputFileName:i,fileType:a,credential:s}).catch(function(e){console.error("filesafe-js | error uploading file:",e)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"downloadFileFromDescriptor",value:(s=j(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileManager.downloadFileFromDescriptor(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"encryptFile",value:(a=j(r.mark(function e(t){var n,i,a,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.inputFileName,a=t.fileType,s=t.credential,e.abrupt("return",this.fileManager.encryptFile({data:n,inputFileName:i,fileType:a,credential:s}));case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"decryptFile",value:(n=j(r.mark(function e(t){var n,i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileDescriptor,i=t.fileItem,a=t.credential,e.abrupt("return",this.fileManager.decryptFile({fileDescriptor:n,fileItem:i,credential:a}));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"downloadBase64Data",value:function(e){var t=e.base64Data,n=e.fileName,r=e.fileType;T.downloadData(T.base64toBinary(t),n,r)}},{key:"createTemporaryFileUrl",value:function(e){var t=e.base64Data,n=e.dataType;return T.tempUrlForData(T.base64toBinary(t),n)}},{key:"revokeTempUrl",value:function(e){T.revokeTempUrl(e)}},{key:"createNewCredentials",value:(t=j(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.credentialManager.createNewCredentials());case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"numberOfFilesEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e).length}},{key:"credentialForFileDescriptor",value:function(e){return this.credentialManager.credentialForFileDescriptor(e)}},{key:"getAllCredentials",value:function(){return this.credentialManager.getAllCredentials()}},{key:"getDefaultCredentials",value:function(){return this.credentialManager.getDefaultCredentials()}},{key:"setCredentialAsDefault",value:function(e){return this.credentialManager.setCredentialAsDefault(e)}},{key:"deleteCredential",value:function(e){return this.credentialManager.deleteCredential(e)}},{key:"saveCredential",value:function(e){return this.credentialManager.saveCredential(e)}},{key:"getAllIntegrations",value:function(){return this.integrationManager.integrations}},{key:"integrationForFileDescriptor",value:function(e){return this.integrationManager.integrationForFileDescriptor(e)}},{key:"saveIntegrationFromCode",value:function(e){return this.integrationManager.saveIntegrationFromCode(e)}},{key:"getDefaultIntegration",value:function(){return this.integrationManager.getDefaultIntegration()}},{key:"setIntegrationAsDefault",value:function(e){return this.integrationManager.setIntegrationAsDefault(e)}},{key:"deleteIntegration",value:function(e){return this.integrationManager.deleteIntegration(e)}},{key:"displayStringForIntegration",value:function(e){return this.integrationManager.displayStringForIntegration(e)}},{key:"base64toBinary",value:function(e){return T.base64toBinary(e)}},{key:"isMobile",value:function(){return this.extensionBridge.isMobile()}},{key:"getEnvironment",value:function(){return this.extensionBridge.getEnvironment()}},{key:"getPlatform",value:function(){return this.extensionBridge.getPlatform()}},{key:"copyTextToClipboard",value:function(e){return T.copyTextToClipboard(e)}},{key:"hasLegacyAccess",value:function(){var e=Boolean(this.getAllCredentials().length>0&&this.getAllIntegrations().length>0),t=Boolean(this.getAllFileDescriptors().length>0);return e||t}}]),e}()}])},3738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4373:e=>{e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},4633:(e,t,n)=>{var r=n(5172),i=n(6993),a=n(5869),s=n(887),o=n(1791),u=n(4373),c=n(579);function l(){"use strict";var t=i(),n=t.m(l),f=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function h(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))}var p={throw:1,return:2,break:3,continue:3};function d(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,p[e],t)},delegateYield:function(e,i,a){return t.resultName=i,n(r.d,c(e),a)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,n,r,i){return t.w(d(e),n,r,i&&i.reverse())},isGeneratorFunction:h,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:o,async:function(e,t,n,r,i){return(h(t)?s:a)(d(e),t,n,r,i)},keys:u,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,t,n)=>{var r=n(4633)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},5172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},5546:e=>{function t(n,r,i,a){var s=Object.defineProperty;try{s({},"",{})}catch(n){s=0}e.exports=t=function(e,n,r,i){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?s?s(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,i,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},5869:(e,t,n)=>{var r=n(887);e.exports=function(e,t,n,i,a){var s=r(e,t,n,i,a);return s.next().then(function(e){return e.done?e.value:s.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},6993:(e,t,n)=>{var r=n(5546);function i(){var t,n,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function u(e,i,a,s){var o=i&&i.prototype instanceof l?i:l,u=Object.create(o.prototype);return r(u,"_invoke",function(e,r,i){var a,s,o,u=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,o=t,h.n=n,c}};function p(e,r){for(s=e,o=r,n=0;!f&&u&&!i&&n<l.length;n++){var i,a=l[n],p=h.p,d=a[2];e>3?(i=d===r)&&(o=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=e<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<d&&(i=e<3||a[0]>r||r>d)&&(a[4]=e,a[5]=r,h.n=d,s=0))}if(i||e>1)return c;throw f=!0,r}return function(i,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,d),s=l,o=d;(n=s<2?t:o)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,o)):h.n=o:h.v=o);try{if(u=2,a){if(s||(i="next"),n=a[i]){if(!(n=n.call(a,o)))throw TypeError("iterator result is not an object");if(!n.done)return n;o=n.value,s<2&&(s=0)}else 1===s&&(n=a.return)&&n.call(a),s<2&&(o=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((n=(f=h.n<0)?o:e.call(r,h))!==c)break}catch(n){a=t,s=1,o=n}finally{u=1}}return{value:n,done:f}}}(e,a,s),!0),u}var c={};function l(){}function f(){}function h(){}n=Object.getPrototypeOf;var p=[][s]?n(n([][s]())):(r(n={},s,function(){return this}),n),d=h.prototype=l.prototype=Object.create(p);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return f.prototype=h,r(d,"constructor",h),r(h,"constructor",f),f.displayName="GeneratorFunction",r(h,o,"GeneratorFunction"),r(d),r(d,o,"Generator"),r(d,s,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(e.exports=i=function(){return{w:u,m:y}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}}]);
//# sourceMappingURL=408.39322133.chunk.js.map